
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Un informático de siempre… en estos tiempos modernos">
      
      
      
        <link rel="canonical" href="https://pruebadeconcepto.es/rpi_backupserver/">
      
      
        <link rel="prev" href="../rpi_airprint/">
      
      
        <link rel="next" href="../rpi_domotica/">
      
      <link rel="icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.3">
    
    
      
        <title>Instalando una RaspberryPI todo uso… en 2014 (parte 10) – práctico 4 - Servidor copias de Seguridad - Prueba de Concepto</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.c4a75a56.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#servidor-de-copias-de-seguridad" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Prueba de Concepto" class="md-header__button md-logo" aria-label="Prueba de Concepto" data-md-component="logo">
      
  <img src="../images/logo_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Prueba de Concepto
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Instalando una RaspberryPI todo uso… en 2014 (parte 10) – práctico 4 - Servidor copias de Seguridad
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_3" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_3">
          
            <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Inicio
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../gen_hello-world/" class="md-tabs__link">
        Generales
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../infv_guybrush/" class="md-tabs__link">
        Informática Viejuna
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../tec_actionsec2/" class="md-tabs__link">
        Tecnología
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../rpi_intro/" class="md-tabs__link md-tabs__link--active">
        RaspberryPi
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../about_acercademi/" class="md-tabs__link">
        Acerca de
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Prueba de Concepto" class="md-nav__button md-logo" aria-label="Prueba de Concepto" data-md-component="logo">
      
  <img src="../images/logo_white.png" alt="logo">

    </a>
    Prueba de Concepto
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Inicio
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Generales
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Generales
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gen_hello-world/" class="md-nav__link">
        Hola mundo!!
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Informática Viejuna
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Informática Viejuna
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../infv_guybrush/" class="md-nav__link">
        ¡Hola! Me llamo Guybrush Threepwood, ¡y quiero ser un pirata!
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../infv_discossd/" class="md-nav__link">
        ¿Y esto tiene discos SSD?
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Tecnología
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Tecnología
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tec_actionsec2/" class="md-nav__link">
        Envía ficheros desde Github a EC2 con actions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          RaspberryPi
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          RaspberryPi
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_intro/" class="md-nav__link">
        Introducción
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_install_i/" class="md-nav__link">
        Instalación Básica I
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_install_ii/" class="md-nav__link">
        Instalación Básica II
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_securizacion/" class="md-nav__link">
        Securización
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_backup/" class="md-nav__link">
        Copias de Seguridad
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_wordpress1/" class="md-nav__link">
        Práctico 1 - Wordpress 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_wordpress2/" class="md-nav__link">
        Práctico 1 - Wordpress 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_downmanager/" class="md-nav__link">
        Práctico 2 - Gestor de Descargas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_airprint/" class="md-nav__link">
        Práctico 3 - Servidor Impresión/AirPrint
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Práctico 4 - Servidor Copias de Seguridad
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Práctico 4 - Servidor Copias de Seguridad
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#servidor-de-copias-de-seguridad" class="md-nav__link">
    Servidor de Copias de Seguridad
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servidor-ftp" class="md-nav__link">
    Servidor FTP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servidor-rsync" class="md-nav__link">
    Servidor RSYNC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#script-de-copia-y-apagado-del-mac" class="md-nav__link">
    Script de copia y apagado del MAC
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_domotica/" class="md-nav__link">
        Práctico 5 - Domótica, Cámaras IP y RaZberry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_mediacenter/" class="md-nav__link">
        Práctico 6 - Media Center
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_emulador/" class="md-nav__link">
        Práctico 7 - Emulación de juegos
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Acerca de
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Acerca de
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../about_acercademi/" class="md-nav__link">
        Acerca de mi y mis pruebas de concepto
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../about_privacy-policy/" class="md-nav__link">
        Política de privacidad
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#servidor-de-copias-de-seguridad" class="md-nav__link">
    Servidor de Copias de Seguridad
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servidor-ftp" class="md-nav__link">
    Servidor FTP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servidor-rsync" class="md-nav__link">
    Servidor RSYNC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#script-de-copia-y-apagado-del-mac" class="md-nav__link">
    Script de copia y apagado del MAC
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Práctico 4 - Servidor Copias de Seguridad</h1>

<h2 id="servidor-de-copias-de-seguridad">Servidor de Copias de Seguridad<a class="headerlink" href="#servidor-de-copias-de-seguridad" title="Permanent link">&para;</a></h2>
<p>Si, ya sé que con nuestros MACs tenemos la estupenda utilidad de Time Machine, que funciona a las mil maravillas, e incluso si queremos tenemos también SuperDuper que es un muy buen complemento para nuestras copias en Time Machine.</p>
<p>Pero esto que os voy a contar seguramente interese a más de uno, y es que cuando por ejemplo acabas a las mil de editar un podcast, de retocar fotos o de editar video, y quieres hacer copia de seguridad de esas carpetas… seguramente que incluso esas carpetas no las tengas en copia de seguridad de Time Machine por que son grandes y tardan mucho en hacerse copia, te llenan el disco de TM en poco.. así que te toca esperarte a la copia en otro HD ó Pendrive termine para poder irte a dormir tranquilo.</p>
<p>Pues bien, vamos a ver un par de maneras de hacer <strong>copia de seguridad SOBRE nuestra RPi de una parte en concreto de nuestro dispositivos OSX</strong>.</p>
<p>Incluso se dice que si tienes un dispositivo iOS con JailBreak también es posible hacer copia de seguridad de ellos, pero esto es algo que no puedo contar pues no tengo JailBreak en ninguno de mis dispositivos.</p>
<h2 id="servidor-ftp">Servidor FTP<a class="headerlink" href="#servidor-ftp" title="Permanent link">&para;</a></h2>
<p>El protocolo de transferencia de datos <a href="http://es.wikipedia.org/wiki/File_Transfer_Protocol">FTP</a>  nos permite, mediante una infraestructura de cliente/servidor, realizar la transferencia de datos en ambas direcciones de una manera bastante rápida, tanto es así que el protocolo está optimizado para que sea rápido, <strong>pero no para que sea seguro</strong>, básicamente porqué la información viaja en claro, no está cifrada.</p>
<p>Para mejorar esto, es decir, renunciar a parte de esa velocidad pero ganar mucho en seguridad tenemos la transmisión <a href="http://es.wikipedia.org/wiki/SSH_File_Transfer_Protocol">SFTP</a> , que es algo así como montar un FTP pero sobre una capa de cifrado SSL (Secure Socket Layer).</p>
<p>En el caso de las Rpi con ARCH, al estar SSH habilitado por defecto también tenemos acceso al subsistema de sftpserver, de manera que es el propio demonio de SSH (sshd) quien invoca al servidor de ftp seguro cuando así el cliente lo solicita.</p>
<p>Y como en nuestra conexión, en el apartado de securización hemos, por un lado <strong>eliminado el acceso</strong> directo <strong>con el usuario root</strong>, y por otro <strong>activado la autenticación en dos pasos</strong> para el usuario operador, pues aquí nos pasará lo mismo, si abrimos una conexión sftp a nuestra máquina veremos como con el usuario root es imposible que obtengamos una sesión, y que cuando la abrimos con el usuario operador nos solicita lo primero el código de verificación de la autenticación en dos pasos y luego la contraseña del usuario.</p>
<p>Así pues, para esto no tenemos que hacer nada, tan sólo saber que tenemos este tipo de conexión disponible y que podemos pasar, tanto de ida como de vuelta, documentos y ficheros de todo tipo, eso sí, siempre basándonos en el perfilado del usuario con el que nos conectamos.</p>
<p>Podemos incluso utilizar un cliente de FTP para que nos haga el entorno más amigable a la par de gráfico, por ejemplo podemos emplear <a href="https://filezilla-project.org">Filezilla</a> , configurando la conexión como del tipo SFTP - SSH File Transfer Protocol y el modo de acceso Interactivo, para que veamos el mensaje del sistema en el que se nos solicita el código de verificación en dos pasos que implementamos.</p>
<p>Esto lo comento aunque no es el recurso de copia de seguridad que vamos a emplear para este fin, es "otra" forma más de poder pasar contenidos a nuestra máquina de backup.</p>
<h2 id="servidor-rsync">Servidor RSYNC<a class="headerlink" href="#servidor-rsync" title="Permanent link">&para;</a></h2>
<p>Sobre Rsync ya hablamos en el capítulo de copias de seguridad, y ahora vamos a ampliar la información por que este software también podemos explotarlo como parte servidor, esto es, activarlo de manera que otros equipos actúen como clientes y puedan hacer copia sobre nuestra RPI.</p>
<p>Para eso tan sólo tenemos que configurarlo adecuadamente y ejecutarlo de manera que se quede funcionando en la máquina en modo "demonio".</p>
<p>La configuración es sencilla, en primer lugar tenemos el fichero de configuración <code>/etc/rsyncd.conf</code></p>
<p>Aquí un ejemplo a usar:
<div class="highlight"><pre><span></span><code>uid = nobody
gid = nobody
use chroot = no
max connections = 4
syslog facility = local5
pid file = /run/rsyncd.pid
</code></pre></div>
Ahora vamos a poner a correr rsync en modo demonio y a probar a grabar desde nuestro equipo Mac</p>
<p><code>[root@Jarvis ~]# systemctl start rsyncd</code></p>
<p>En caso de que lo queramos dejar corriendo siempre que se inicie el sistema operativo de la máquina, este es el comando:</p>
<p><code>[root@Jarvis ~]# systemctl enable rsyncd</code></p>
<p>Y la línea por ejemplo para copiar un directorio sobre el home del usuario operador (el único que puede conectar y autenticar por SSH) sería:
<div class="highlight"><pre><span></span><code>Hal9000:~ $ rsync --progress -avhe ssh /Users/admin/Documents/Vehiculos/Octavia/Manuales/ operador@192.168.1.20:CopiaRemota/

Verification code:
Password:
building file list ...
3 files to consider
created directory CopiaRemota
./
A5_Octavia_OwnersManual.pdf
4.05M 100% 6.34MB/s 0:00:00 (xfer#1, to-check=1/3)
A5_Octavia_Swing_CarRadio.pdf
671.79K 100% 831.48kB/s 0:00:00 (xfer#2, to-check=0/3)
sent 4.72M bytes received 70 bytes 219.53K bytes/sec
total size is 4.72M speedup is 1.00
</code></pre></div>
Como vemos la conexión a Rsync se hace sobre SSH, es una copia por tanto segura, es más, se nos está pidiendo autenticación en dos pasos y la copia se deja bajo el usuario operador:
<div class="highlight"><pre><span></span><code>[root@Jarvis CopiaRemota]# pwd
/home/operador/CopiaRemota
[root@Jarvis CopiaRemota]# ls -l

total 4616
-rwxrwxrwx 1 operador operadores 4047332 ene 25 2012 A5_Octavia_OwnersManual.pdf
-rwxrwxrwx 1 operador operadores 671786 ene 25 2012 A5_Octavia_Swing_CarRadio.pdf
</code></pre></div>
Bien, como habíamos pensado hacer ese proceso que nos haga copia de una serie de carpetas de nuestro OSX sobre la Rpi, y luego nos apague la máquina OSX, pues no podemos estar pendientes para poder introducir el famoso código de autenticación en dos pasos ni la contraseña del usuario, vamos a hacer lo que se llama una conexión transparente mediante generando para esto nuestra huella RSA propia.</p>
<p>En nuestro equipo OSX, abrimos un terminal y nos vamos a nuestro home de usuario (recordad, la virgulilla), y dentro del home al directorio <code>.ssh</code>
<div class="highlight"><pre><span></span><code>cd ~/.ssh
ssh-keygen -t rsa

Generating public/private rsa key pair.
Enter file in which to save the key (/Users/admin/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /Users/admin/.ssh/id_rsa.
Your public key has been saved in /Users/admin/.ssh/id_rsa.pub.

The key fingerprint is:
f4:86:f3:50:3b:13:e9:e2:bf:2b:02:0e:a6:b8:3e:f3 admin@Hal9000.local

The key&#39;s randomart image is:
+--[ RSA 2048]----+
|                 |
| .               |
| . +             |
| . = o           |
| S B             |
| o . . * o       |
|.o o . . .       |
|oo . . ..        |
|oo+E . .+o       |
+-----------------+
</code></pre></div>
Respondemos a todas las preguntas que nos hace este comando con INTRO.</p>
<p>Ahora tenemos que copiar el fichero <code>id_rsa.pub</code> que hemos generado en nuestro OSX a la máquina RPI, y debe quedar en el directorio <code>/home/operador/.ssh</code>, se debe llamar <code>authorized_keys</code> y los permisos del directorio y del fichero deben excluir a grupo y otros por que de lo contrario todo esto se desactiva por temas relativos a la seguridad.</p>
<p>Para esta copia, podemos usar este comando en nuestro terminal OSX:
<div class="highlight"><pre><span></span><code>Hal9000:.ssh admin$ scp id_rsa.pub operador@192.168.1.20:id_rsa.pub

Verification code:
Password:
id_rsa.pub
</code></pre></div>
Como vemos es una copia con SSL, autenticación en dos pasos, clave, etc.</p>
<p>El fichero se ha quedado en el home del usuario operador en la PI, así que estos son los siguientes pasos a dar:
<div class="highlight"><pre><span></span><code>[operador@Jarvis ~]$ mkdir -p .ssh
[operador@Jarvis ~]$ mv ./id_rsa.pub ./.ssh/authorized_keys
[operador@Jarvis ~]$ chmod go-w . .ssh .ssh/authorized_keys
</code></pre></div>
Que pasa a partir de este punto, pues que las conexiones por SSH entre ese equipo que ha generado su clave RSA y se la ha enviado a nuestra RPI, y la RPI ya no precisan de usuario/clave ni código de verificación en dos pasos.</p>
<p>Y ahora, por ejemplo, si repetimos en nuestro OSX el comando de copia rsync sobre la RPi ya no nos pide nada y lo podemos ejecutar en modo desatendido:
<div class="highlight"><pre><span></span><code>Hal9000: ~$ rsync --progress -avhe ssh /Users/admin/Documents/Vehiculos/Octavia/Manuales/ operador@192.168.1.20:CopiaRemota/
building file list ...
3 files to consider

sent 161 bytes received 20 bytes 362.00 bytes/sec
total size is 4.72M speedup is 26072.48
</code></pre></div></p>
<h2 id="script-de-copia-y-apagado-del-mac">Script de copia y apagado del MAC<a class="headerlink" href="#script-de-copia-y-apagado-del-mac" title="Permanent link">&para;</a></h2>
<p>Y ahora, juntando todas estas piezas que hemos ido viendo podremos implementar lo siguiente, nuestra idea inicial, poder pulsar un "botón" y que se haga copia de lo que quiero y luego se apague el equipo.</p>
<p>Para esto, necesitamos hacer una simple tarea en nuestro OSx con Automator.</p>
<p>Se trata de abrir automator y crear un nuevo flujo de trabajo.</p>
<p>En primer lugar, el flujo ejecutará una secuencia de Shell Scrip, en esta secuencia es donde pegamos nuestra línea de Rsync con la que hacíamos copia de la carpeta.</p>
<p>El siguiente elemento de ese flujo es la ejecución de un script hecho en AppleScript, este ejecuta el comando <code>tell application "Finder" to shut down</code>.</p>
<p>Y listo, ahora guardamos este flujo de Automator como aplicación y la grabamos donde queramos, en al carpeta de aplicaciones, en nuestra carpeta personal, da igual, cuando ejecutemos nos hará en primer lugar la copia por rsync y al finalizar apaga el equipo al completo.</p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2019-2023 Antonio Hernan
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.efa0ade1.min.js"></script>
      
    
  </body>
</html>