{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Bienvenidos a pruebadeconcepto.es","text":"<p>Este blog est\u00e1 en proceso de migraci\u00f3n desde wordpres alojado en EC2 hacia github.com usando github pages y mkdocs.org.</p>"},{"location":"about_acercademi/","title":"Acerca de m\u00ed y mis pruebas de concepto","text":"<p>Antonio Hern\u00e1n</p> Hice de mi fascinaci\u00f3n y pasi\u00f3n por los ordenadores mi profesi\u00f3n. En general, me gusta cualquier cosa que se pueda conectar a la corriente y emita luces o sonidos. Desde hace m\u00e1s de \u00a0veinte a\u00f1os soy t\u00e9cnico de sistemas y por mis manos han pasado los sistemas operativos y plataformas hardware m\u00e1s variopintos. Inconformista por naturaleza, no me gustan las cosas tal como vienen de f\u00e1brica, siempre pienso en optimizar el rendimiento y en c\u00f3mo poder obtener un acceso al int\u00e9rprete en l\u00ednea de comandos, del cual me declara defensor frente a las denominadas \u201cmet\u00e1foras gr\u00e1ficas\u201d. Obsesionado con instalar ScummVM y juegos retro en cualquier cachivache que cae en mis manos. <p>S\u00edgueme en las redes:</p>"},{"location":"about_privacy-policy/","title":"Pol\u00edtica de Privacidad","text":""},{"location":"about_privacy-policy/#quienes-somos","title":"Quienes somos","text":"<p>La direcci\u00f3n de nuestra web es: http://pruebadeconcepto.es.</p>"},{"location":"about_privacy-policy/#que-datos-personales-recogemos-y-por-que-los-recogemos","title":"Qu\u00e9 datos personales recogemos y por qu\u00e9 los recogemos","text":""},{"location":"about_privacy-policy/#comentarios","title":"Comentarios","text":"<p>Cuando los visitantes dejan comentarios en la web, recopilamos los datos que se muestran en el formulario de comentarios, as\u00ed como la direcci\u00f3n IP del visitante y la cadena de agentes de usuario del navegador para ayudar a la detecci\u00f3n de spam.</p> <p>Una cadena an\u00f3nima creada a partir de tu direcci\u00f3n de correo electr\u00f3nico (tambi\u00e9n llamada hash) puede ser proporcionada al servicio de Gravatar para ver si la est\u00e1s usando. La pol\u00edtica de privacidad del servicio Gravatar est\u00e1 disponible aqu\u00ed: https://automattic.com/privacy/. Despu\u00e9s de la aprobaci\u00f3n de tu comentario, la imagen de tu perfil es visible para el p\u00fablico en el contexto de su comentario.</p>"},{"location":"about_privacy-policy/#medios","title":"Medios","text":"<p>Si subes im\u00e1genes a la web deber\u00edas evitar subir im\u00e1genes con datos de ubicaci\u00f3n (GPS EXIF) incluidos. Los visitantes de la web pueden descargar y extraer cualquier dato de localizaci\u00f3n de las im\u00e1genes de la web.</p>"},{"location":"about_privacy-policy/#formularios-de-contacto","title":"Formularios de contacto","text":""},{"location":"about_privacy-policy/#cookies","title":"Cookies","text":"<p>Si dejas un comentario en nuestro sitio puedes elegir guardar tu nombre, direcci\u00f3n de correo electr\u00f3nico y web en cookies. Esto es para tu comodidad, para que no tengas que volver a rellenar tus datos cuando dejes otro comentario. Estas cookies tendr\u00e1n una duraci\u00f3n de un a\u00f1o.</p> <p>Si tienes una cuenta y te conectas a este sitio, instalaremos una cookie temporal para determinar si tu navegador acepta cookies. Esta cookie no contiene datos personales y se elimina al cerrar el navegador.</p> <p>Cuando inicias sesi\u00f3n, tambi\u00e9n instalaremos varias cookies para guardar tu informaci\u00f3n de inicio de sesi\u00f3n y tus opciones de visualizaci\u00f3n de pantalla. Las cookies de inicio de sesi\u00f3n duran dos d\u00edas, y las cookies de opciones de pantalla duran un a\u00f1o. Si seleccionas \"Recordarme\", tu inicio de sesi\u00f3n perdurar\u00e1 durante dos semanas. Si sales de tu cuenta, las cookies de inicio de sesi\u00f3n se eliminar\u00e1n.</p> <p>Si editas o publicas un art\u00edculo se guardar\u00e1 una cookie adicional en tu navegador. Esta cookie no incluye datos personales y simplemente indica el ID del art\u00edculo que acabas de editar. Caduca despu\u00e9s de 1 d\u00eda.</p>"},{"location":"about_privacy-policy/#contenido-incrustado-de-otros-sitios-web","title":"Contenido incrustado de otros sitios web","text":"<p>Los art\u00edculos de este sitio pueden incluir contenido incrustado (por ejemplo, v\u00eddeos, im\u00e1genes, art\u00edculos, etc.). El contenido incrustado de otras web se comporta exactamente de la misma manera que si el visitante hubiera visitado la otra web.</p> <p>Estas web pueden recopilar datos sobre ti, utilizar cookies, incrustar un seguimiento adicional de terceros, y supervisar tu interacci\u00f3n con ese contenido incrustado, incluido el seguimiento de tu interacci\u00f3n con el contenido incrustado si tienes una cuenta y est\u00e1s conectado a esa web.</p>"},{"location":"about_privacy-policy/#analitica","title":"Anal\u00edtica","text":""},{"location":"about_privacy-policy/#con-quien-compartimos-tus-datos","title":"Con qui\u00e9n compartimos tus datos","text":"<p>No comparto datos.  </p>"},{"location":"about_privacy-policy/#cuanto-tiempo-conservamos-tus-datos","title":"Cu\u00e1nto tiempo conservamos tus datos","text":"<p>Si dejas un comentario, el comentario y sus metadatos se conservan indefinidamente. Esto es para que podamos reconocer y aprobar comentarios sucesivos autom\u00e1ticamente en lugar de mantenerlos en una cola de moderaci\u00f3n.</p> <p>De los usuarios que se registran en nuestra web (si los hay), tambi\u00e9n almacenamos la informaci\u00f3n personal que proporcionan en su perfil de usuario. Todos los usuarios pueden ver, editar o eliminar su informaci\u00f3n personal en cualquier momento (excepto que no pueden cambiar su nombre de usuario). Los administradores de la web tambi\u00e9n pueden ver y editar esa informaci\u00f3n.</p>"},{"location":"about_privacy-policy/#que-derechos-tienes-sobre-tus-datos","title":"Qu\u00e9 derechos tienes sobre tus datos","text":"<p>Si tienes una cuenta o has dejado comentarios en esta web, puedes solicitar recibir un archivo de exportaci\u00f3n de los datos personales que tenemos sobre ti, incluyendo cualquier dato que nos hayas proporcionado. Tambi\u00e9n puedes solicitar que eliminemos cualquier dato personal que tengamos sobre ti. Esto no incluye ning\u00fan dato que estemos obligados a conservar con fines administrativos, legales o de seguridad.</p>"},{"location":"gen_hello-world/","title":"Hola Mundo!!! (otra vez)","text":"<p>Y volvemos a la carga con otro blog.</p> <p>Prometo que este va a durar m\u00e1s de.. no se.. tres entradas?? esa es la media de los \u00faltimos cuatro o cinco blogs, tanto personales como las contribuciones con otros medios.</p> <p>Hace muchos a\u00f1os, cuando era podcaster, hab\u00eda unas leyes no escritas donde se defin\u00eda que un podcast tomaba tal entidad cuando ten\u00eda al menos 3 episodios emitidos (no recuerdo si contando o no con el episodio piloto, que sol\u00eda ser un desastre).</p> <p>Ahora pienso que en eso tampoco fui muy constante, mis podcast personales llegaron a poco: uno al piloto, otro a los tres episodios y el podcast de GUM (Grupo de Usuarios MAC) con el que colaboraba lo abandon\u00e9 con 4 episodios... soy un t\u00edo de records!!!</p>"},{"location":"gen_hello-world/#por-que-pruebadeconcepto","title":"\u00bfPor qu\u00e9 pruebadeconcepto?","text":"<p>Con tantos a\u00f1os en este mundillo como llevo vuelvo la vista atr\u00e1s y veo que las mejores ideas, los mejores productos, lo que m\u00e1s me ha gustado hacer y lo que m\u00e1s \u00e9xitos o satisfacciones personales me ha dado siempre ha sido cuando he estado \"cacharreando\", o dicho finamente, haciendo pruebas de concepto, incluso a veces pagadas como tales.</p> <p>En innumerables ocasiones las pruebas de tal tecnolog\u00eda, o tal producto, de esta o aquella configuraci\u00f3n han resultado soluciones que bien han valido las horas invertidas (aunque algunos jefes no lo terminaban de ver as\u00ed, pobres.. \u00bfque ser\u00e1 de ellos??) y que hemos \"estirado\" hasta la saciedad, o incluso hemos visto como fabricantes de los llamados grandes adoptaban como la soluci\u00f3n recomendada, igual o muy similar a la que nuestros \"cacharreos\" sacaban adelante.</p>"},{"location":"gen_hello-world/#y-por-que-nsupdateinfo","title":"\u00bfY por qu\u00e9 nsupdate.info?","text":"<p>Porque es gratis, sin necesidad de entrar cada dos por tres a validar nada, me permite tener esta instancia EC2 (de la free-tier por supuesto) referenciada como veis, incluso con un certificado SSL, y todo por el m\u00f3dico precio de 0\u20ac al a\u00f1o... a ver lo que dura esto arriba.</p> <p>En breve empezamos con las entradas interesantes, que esta como introducci\u00f3n ya no da para m\u00e1s.</p> <p>Para contactar conmigo antonio.hernan AT gmail.com</p>"},{"location":"infv_discossd/","title":"\u00bfY esto tiene discos SSD?","text":"<p>La muerte reciente de Eduardo Punset me ha tra\u00eddo a la cabeza cuando en mi empresa gestion\u00e1bamos uno de sus portales de ayuda. El portal iba, como solemos decir coloquialmente, como el ojete, y vino la t\u00edpica reuni\u00f3n Comerciales-Desarrollo-Sistemas para tirarnos los trastos a la cabeza y localizar al culpable.</p> <p></p> <p>Aparecieron frases c\u00e9lebres, desgastadas por el uso...</p> <p>\"En desarrollo el portal vuela...\" \"En mi entorno local del port\u00e1til va como un tiro...\" \"\u00bfY si le metemos m\u00e1s memoria al servidor? \u00bfle ponemos m\u00e1s CPU?\" \"\u00bfTienen todos los parches?\"</p> <p>T\u00edpicas todas ellas de personas con ninguna o muy poca experiencia que apenas aciertan a copiar y pegar c\u00f3digo encontrado en StackOverFlow.</p> <p>Y entonces soltaron esta, que me hizo saltar del sitio:</p> <p>\"\u00bfPero ese servidor tiene los discos SSD no?\", claro que si majadero, este y todos los de ese CPD, valen m\u00e1s sus cabinas de discos que tus dos ri\u00f1ones vendidos al mercado negro...</p> <p>Efectivamente, era un problema de codificaci\u00f3n (again), que en desarrollo o en local con apenas 10 entradas funciona todo como un avi\u00f3n, pero que en producci\u00f3n con algunas decenas de miles de entradas ese bucle que haces tray\u00e9ndote toda la informaci\u00f3n sin filtrar mata al portal al segundo usuario.</p> <p>Por supuesto que la soluci\u00f3n no sirvi\u00f3 para nada, meses despu\u00e9s con otro portal similar los mismos problemas, el c\u00f3digo era un copia/pega y segu\u00edan ah\u00ed las deficiencias de siempre, no supieron ni reutilizar el c\u00f3digo.</p> <p>Pero esta vez la reuni\u00f3n la empec\u00e9 yo y dej\u00e9 claro que los discos eran SSD, y devolv\u00ed el rev\u00e9s preguntando primero si su aplicaci\u00f3n estaba preparada para soportar tanta velocidad en disco.</p>"},{"location":"infv_guybrush/","title":"\u00a1Hola! Me llamo Guybrush Threepwood, \u00a1y quiero ser un pirata!","text":"<p>Anda que no ha llovido... y eso que Monkey Island no fue ni mucho menos el primer contacto que tuve con un ordenador, pero a buen seguro que fue el que m\u00e1s me marc\u00f3.</p> <p>No tuve la suerte de tener un ZX, ni siquiera un Amstrad, en esto fui unos meses con retraso respecto a los vecinos, un a\u00f1o todo lo m\u00e1s y entr\u00e9 directamente en el mundillo de las computadoras con un MSX, y su correspondiente unidad de cinta Computone (y ese destornillador para ajustar el azimut!!!)</p> <p></p> <p>Fui el rey del barrio, con los cartuchos que cargaban al instante, que de horas con el Kung-Fu Master!!.</p> <p>Luego siguieron equipos m\u00e1s o menos potentes, recuerdo el primer equipo con Intel, un Bondwell 38 de 1986, que ten\u00eda un disco duro de nada menos que 20MB, con eso era el rey del barrio.</p> <p>Hay sonidos y luces que no se olvidan, el arranque de esta m\u00e1quina, con el disco duro que cog\u00eda revoluciones poco a poco y parec\u00eda que la turbina de un avi\u00f3n se hab\u00eda colado en el cuarto, y los destellos y estelas de la pantalla de f\u00f3sforo verde.</p> <p>Recuerdos que est\u00e1n casi a la misma altura que los sonidos de un modem de 9600 baudios (\u00bfbaudios?, los j\u00f3venes que no diferencian un bit de un byte ni saben que eso existe..) y sus luces intermitentes con el cuarto a oscuras, que fueron la mayor\u00eda de mis \"discotecas\" de juventud.</p> <p></p> <p>Los chicos de hoy en d\u00eda, si no tienen equipos que generan miles de millones de tri\u00e1ngulos por segundo y texturas reales... pues no les vale nada.</p> <p>Nunca sabr\u00e1n la relaci\u00f3n de un pollo de goma y una polea, ni disfrutaran de esta maravilla de banda sonora tan de 8bits.</p> <p>Tranquilos, nunca es tarde, si quieres disfrutar de esta aventura gr\u00e1fica y de otras muchas contempor\u00e1neas \u00e9chale un vistazo a ScummVM\u00a0y localiza las Roms.</p> <p>Disfruta!!</p>"},{"location":"rpi_airprint/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 9) \u2013 pr\u00e1ctico 3 - Servidor AirPrint","text":""},{"location":"rpi_airprint/#servidor-de-impresion","title":"Servidor de Impresi\u00f3n","text":"<p>Vamos a instalar en nuestra RPI el software necesario para convertirla en una estaci\u00f3n de impresi\u00f3n en red, as\u00ed como en un servidor de impresi\u00f3n compatible con AirPrint.</p> <p>De esta manera, nuestra impresora que no tiene ni Wifi ni es compatible con AirPrint pasar\u00eda a serlo.</p> <p>Para todo esto vamos a emplear un software llamado CUPS, que fue inicialmente desarrollado por Easy Software Products, para ser comprado en 2002 por Apple, la cual licencio el software como GNU GPL, y empez\u00f3 a implementarlo en sus sistemas Mac OSX a partir de la versi\u00f3n 10.2.</p> <p>As\u00ed que cuando estamos imprimiendo en nuestros Mac OSX y pensamos en complejos controladores y dem\u00e1s\u2026 todo se reduce a lo mismo.. a CUPS corriendo por debajo muy bien presentado esos s\u00ed\u2026</p>"},{"location":"rpi_airprint/#instalacion","title":"Instalaci\u00f3n","text":"<p>Vamos a instalar los paquetes que se corresponden a Cups, Cups-pdf (que nos permite realizar impresiones sobre pdf) y Gutenprint (que son los drivers para casi todas las impresoras).</p> <p>Para poder hacer AirPrint necesitamos tambi\u00e9n instalar Avahi , que no es m\u00e1s que un Bonjour (esto es sonar\u00e1 m\u00e1s), esto es, sirve para anunciar los servicios que tu equipo ofrece al resto de equipos de la red.</p> <p>Instalamos todo entonces, con ayuda de <code>pacman</code> (se instala <code>python2</code> aunque ya lo ten\u00edamos instalado de antes, por sis\u00f3lo quieres probar esto de la impresi\u00f3n\u2026)</p> <pre><code>[root@Jarvis ~]# pacman -Sy cups cups-pdf gutenprint avahi pycups python2\n\n:: Sincronizando las bases de datos de paquetes...\ncore 153,6 KiB 464K/s 00:00    [###############] 100%\nextra 2031,8 KiB 1628K/s 00:01 [###############] 100%\ncommunity est\u00e1 actualizado\nalarm est\u00e1 actualizado\naur est\u00e1 actualizado\natenci\u00f3n: avahi-0.6.31-11 est\u00e1 actualizado -- re-instalando\nresolviendo dependencias...\nverificando conflictos...\nPaquetes (56): bc-1.06.95-1.1 cairo-1.12.16-1 colord-1.0.6-1 cups-filters-1.0.49-1 damageproto-1.2.1-2 dconf-0.18.0-1 elfutils-0.158-1 fixesproto-5.0-2 fontconfig-2.11.0-1 freetype2-2.5.3-2 ghostscript-9.10-3 graphite-1:1.2.4-1 harfbuzz-0.9.26-1 hicolor-icon-theme-0.13-1 jasper-1.900.1-10 js-17.0.0-1 kbproto-1.0.6-1 lcms2-2.5-2 libdrm-2.4.52-1 libgusb-0.1.6-1 libice-1.0.8-2 libpaper-1.1.24-7 libpciaccess-0.13.2-2 libsm-1.2.2-2 libvdpau-0.7-1 libx11-1.6.2-1 libxau-1.0.8-2 libxcb-1.10-1 libxdamage-1.1.4-1 libxdmcp-1.1.1-1 libxext-1.3.2-1 libxfixes-5.0.1-1 libxrender-0.9.8-1 libxshmfence-1.1-1 libxt-1.1.4-1 libxxf86vm-1.1.3-1 llvm-libs-3.4-1 mesa-10.1.0-4 mesa-libgl-10.1.0-4 nspr-4.10.4-1 openjpeg-1.5.1-2 pixman-0.32.4-1 polkit-0.112-1 poppler-0.24.5-1 qpdf-5.1.1-1 renderproto-0.11.1-2 shared-colorprofiles-0.1.5-1 wayland-1.4.0-1 xcb-proto-1.10-2 xextproto-.3.0-1 xf86vidmodeproto-2.3.1-2 xproto-7.0.25-1 avahi-0.6.31-11 cups-1.7.1-4 cups-pdf-2.6.1-2 gutenprint-5.2.9-2\n\nTama\u00f1o Total de Descarga: 52,90 MiB\nTama\u00f1o Total Instalado: 358,88 MiB\nTama\u00f1o neto a actualizar: 356,75 MiB\n:: \u00bfContinuar con la instalaci\u00f3n? [S/n] S\n</code></pre> <p>La instalaci\u00f3n es un poco larga por la cantidad de paquetes que a\u00f1ade o actualiza en el sistema, pero no debe presentar problema alguno.</p>"},{"location":"rpi_airprint/#configuracion","title":"Configuraci\u00f3n","text":"<p>El fichero de configuraci\u00f3n de cups est\u00e1 en <code>/etc/cups/cupsd.conf</code></p> <p>Lo editamos para configurar el rango de direcciones IP que podr\u00e1n hacer uso de su servicio WEB (y por tanto poder configurarlo por web desde otro equipo de la red), as\u00ed como para dar permisos a la administraci\u00f3n. <code>[root@Jarvis ~]# vi /etc/cups/cupsd.conf</code> Donde dice</p> <p><pre><code># Only listen for connections from the local machine.\nListen localhost:631\n</code></pre> Por <pre><code># Only listen for connections from the local machine.\nListen 0.0.0.0:631\n</code></pre> Y tambi\u00e9n a\u00f1adimos el acceso desde la red local mediante la modificaci\u00f3n de estas otras entradas: <pre><code># Restrict access to the server...\n\n&lt;Location /&gt;\nOrder allow,deny\n&lt;/Location&gt;\n\n# Restrict access to the admin pages...\n\n&lt;Location /admin&gt;\nOrder allow,deny\n&lt;/Location&gt;\n</code></pre> Por estas <pre><code># Restrict access to the server...\n\n&lt;Location /&gt;\nOrder allow,deny\nAllow @LOCAL\n&lt;/Location&gt;\n\n# Restrict access to the admin pages...\n\n&lt;Location /admin&gt;\nOrder allow,deny\nAllow @LOCAL\n&lt;/Location&gt;\n</code></pre></p>"},{"location":"rpi_airprint/#iniciamos-el-servicio-de-impresion","title":"Iniciamos el servicio de impresi\u00f3n","text":"<p><code>[root@Jarvis ~]# systemctl start cups</code></p> <p>Y probamos si tenemos accesos la IP de nuestra m\u00e1quina y el puerto 631 para la consola (http://192.168.1.20:631)</p>"},{"location":"rpi_airprint/#configuracion-impresora","title":"Configuraci\u00f3n impresora","text":"<p>Conectamos nuestra impresora por USB a la RPI y entramos a la url antes mencionada.</p> <p>Aqu\u00ed tenemos que ir a la pesta\u00f1a Administraci\u00f3n.</p> <p>Una vez entramos vemos Impresoras y el bot\u00f3n que dice A\u00f1adir Impresora.</p> <p>Y directamente, en impresoras locales veremos dos, una posible impresora virtual basada en PDF (cups-pdf que hemos instalado), y nuestra impresora que es bastante probable que sea reconocida autom\u00e1ticamente.</p> <p>En la siguiente p\u00e1gina podemos cambiar si queremos el nombre al servidor de impresi\u00f3n para esta impresora, pero lo m\u00e1s importante es marcar la casilla inferior que dice Compartir esta impresora.</p> <p>En la siguiente pantalla debemos escoger entre todos los modelos disponibles en nuestro en concreto, y pulsar el bot\u00f3n que est\u00e1 en la parte inferior de la pantalla que dice A\u00f1adir Impresora.</p> <p>Y ahora, ya por fin, la \u00faltima pantalla de configuraci\u00f3n, donde escogemos el comportamiento por defecto de la impresora. Cambiamos el tipo de papel de \u201cCarta/Letter\u201d a A4 que es m\u00e1s com\u00fan entre nosotros, y le indicamos que no modifique por norma las dimensiones del elemento a imprimir; pulsamos sobre Cambiar opciones predeterminadas.</p> <p>Si queremos probar que funciona, desde la pesta\u00f1a que dice Impresoras encontraremos nuestra impresora y un desplegable que dice Mantenimiento.</p> <p>En ese desplegable escogemos Imprimir p\u00e1gina de prueba y listo, veremos como la pantalla se va refrescando y nos muestra el estado de la cola de impresi\u00f3n seg\u00fan tenga esta actividad alguna.</p>"},{"location":"rpi_airprint/#compartiendo-esta-impresora-para-osx","title":"Compartiendo esta impresora para OSX","text":"<p>Si, lo s\u00e9, con OSX se puede instalar la impresora y compartirla al resto de la red Mac sin andarse con estos experimentos\u2026 Pero eso no es divertido\u2026</p> <p>Pero\u2026 espera\u2026 que aqu\u00ed tambi\u00e9n es f\u00e1cil, s\u00f3lo tenemos que entrar en nuestro OSX en las Preferencias del Sistema, ah\u00ed en las Impresoras, y una vez que estemos all\u00ed, cuando pulsemos sobre el s\u00edmbolo + encontraremos que nuestra impresora conectada a la RPI se est\u00e1 anunciando, la escogemos y dejamos que OSX termine de hacer el resto de cosas.</p> <p>Es otra forma de convertir una impresora \u201cno wifi\u201d en una estaci\u00f3n de impresi\u00f3n sin necesidad de tener un ordenador OSX encendido de continuo, con el gasto el\u00e9ctrico que eso lleva (m\u00e1s el de la impresora en Stand-by\u2026)</p>"},{"location":"rpi_airprint/#airprint","title":"AirPrint","text":"<p>Y aqu\u00ed lo divertido de todo esto, poder utilizarla como impresora AirPrint para poder imprimir cosas desde nuestros iPhones e iPads.</p> <p>La verdad es que no se me ocurren muchos ejemplos de porqu\u00e9 podamos necesitar esta funcionalidad, tan s\u00f3lo se me viene a la cabeza la impresi\u00f3n de entradas que compres en la web y cosas similares, o imprimir una receta que tengas en pdf para no tener el iPad en la cocina al lado de los fogones.. etc.</p> <p>Bien, vamos paso a paso, arrancamos el demonio de Avahi</p> <p><code>[root@Jarvis ~]# systemctl start avahi-daemon</code></p> <p>Creamos el directorio para la instalaci\u00f3n de los programas Python y descargamos el que nos genera la configuraci\u00f3n para AirPrint:</p> <pre><code>[root@Jarvis /]# mkdir /opt/airprint\n[root@Jarvis /]# cd /opt/airprint\n[root@Jarvis airprint]# wget -O airprint-generate.py --no-check-certificate https://raw.github.com/tjfontaine/airprintgenerate/master/airprint-generate.py\n\n--2014-03-29 15:11:17-- https://raw.github.com/tjfontaine/airprint-generate/master/airprint-generate.py\n\nResolviendo raw.github.com (raw.github.com)... 185.31.16.133\nConectando con raw.github.com (raw.github.com)[185.31.16.133]:443... conectado.\nPetici\u00f3n HTTP enviada, esperando respuesta... 200 OK\nLongitud: 10093 (9,9K) [text/plain]\nGrabando a: \u201cairprint-generate.py\u201d 100% [============================================================================================================&gt;]\n10.093 --.-K/s en 0,003s\n2014-03-29 15:11:18 (3,57 MB/s) - \u201cairprint-generate.py\u201d guardado [10093/10093]\n</code></pre> <p>Como no usamos Python sino que usamos Python2 tenemos que modificar este fichero que nos hemos descargado.</p> <p>Para esto, lo editamos con vi y modificamos la primera l\u00ednea, a\u00f1adiendo un 2 al final para que quede as\u00ed:</p> <pre><code>#!/usr/bin/env python2\n</code></pre> <p>Vamos a ejecutar por tanto este script en Pyhton para ver que informaci\u00f3n no genera: <pre><code>[root@Jarvis airprint]# chmod 755 airprint-generate.py\n[root@Jarvis airprint]# ./airprint-generate.py\n[root@Jarvis airprint]# mv AirPrint-Canon_MP140_series.service /etc/avahi/services\n</code></pre></p> <p>En la primera l\u00ednea le hemos dado permisos de ejecuci\u00f3n.</p> <p>En la segunda lo ejecutamos y en la tercera vemos como se nos ha generado el servicio de nuestra impresora conectada (la Canon MP140 ;)), as\u00ed que movemos este fichero de configuraci\u00f3n del servicio a la ruta adecuada.</p> <p>En caso de conectar posteriormente otra impresora pues s\u00f3lo hay que repetir este paso para poder tener otra impresora sirviendo AirPrint.</p> <p>S\u00f3lo nos queda reiniciar el demonio de Avahi y ver que reconozca nuestra impresora: <pre><code>[root@Jarvis airprint]# systemctl restart avahi-daemon\n[root@Jarvis airprint]# systemctl status avahi-daemon\n\navahi-daemon.service - Avahi mDNS/DNS-SD Stack\nLoaded: loaded (/usr/lib/systemd/system/avahi-daemon.service; disabled)\nActive: active (running) since s\u00e1b 2014-03-29 15:18:49 CET; 9s ago\nmar 29 15:18:51 Jarvis avahi-daemon[1239]: Service \"AirPrint Canon_MP140_series @ Jarvis (/services/AirPrint-\nCanon_MP140_series.service) successfully established.\n</code></pre> Y desde por ejemplo un iPad, podemos imprimir un PDF, usando el icono de compartir de Adobe Reader, veremos en Imprimir como sale nuestra \u201cimpresora AirPrint\u201d.</p> <p>O mientras estamos navegando con Safari, podemos usar el bot\u00f3n de compartir, escoger la opci\u00f3n de imprimir y ah\u00ed veremos nuestra impresora.</p> <p>No es un sistema r\u00e1pido, por que hay muchos intermediarios\u2026 mucha red, mucha conversiones, pero si tienes una impresora y no quieres invertir en una nueva con su Wifi, su AirPrint y dem\u00e1s, pues con la Rpi puedes adem\u00e1s de hacer todo lo \u201cotro\u201d que hagas con ella, usarla como centro de impresi\u00f3n.</p>"},{"location":"rpi_alternativas/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 14) \u2013 Alternativas a RaspberryPI","text":""},{"location":"rpi_alternativas/#alternativas-a-rpasberry-pi","title":"Alternativas a Rpasberry Pi","text":"<p>Existen claro est\u00e1, y cada d\u00eda hay m\u00e1s y mejores.</p> <p>Hay dos aspectos en los que es dif\u00edcil competir con la RPI, que son por un lado el precio, y por otro lado la comunidad, y es que haber colocado en circulaci\u00f3n m\u00e1s de 2,5 millones de unidades te deja una comunidad detr\u00e1s inmensa.</p>"},{"location":"rpi_alternativas/#empezamos-con-la-lista-de-competidores","title":"Empezamos con la lista de competidores.","text":"<p>MinnowBoard MAX (http://www.minnowboard.org/meet-minnowboard-max/), de las m\u00e1s recientes</p> <p></p> <p>Es la respuesta de INTEL a todo este mercado que est\u00e1 perdido frente a los micros ARM.</p> <p>Incorpora muchas (por no decir que todas) de las peticiones y sue\u00f1os de los actuales propietarios de RPI.</p> <p>M\u00e1s RAM (entre 1 y 2 GB), puerto ethernet a GigaByte, conectividad USB 3.0, Sata, posibilidad de doble core\u2026</p> <p>Lo tiene todo, eso s\u00ed, el precio de salida son los 99$ para la versi\u00f3n m\u00e1s barata, algo m\u00e1s del doble que una Rpi.</p> <p>BeagleBone Black (http://beagleboard.org/Products/BeagleBone+Black), de las primeras en atacar fuerte</p> <p></p> <p>Esta placa lleva un tiempo en el mercado y fue de las primeras que salieron apostando por ofrecer m\u00e1s hardware frente a la Rpi para ver si llamaban m\u00e1s a los futuros usuarios.</p> <p>Si bien sus diferencias de hardware tampoco son tantas y el punto fuerte en el que se diferencia de la RPI es el procesador, de la arquitectura ARM tambi\u00e9n, pero en este caso es un Cortex A8 (a 1 Ghz) que es una arquitectura ARM V7, y esto supone que se puede utilizar el tan nombrado UBUNTU.</p> <p>CubieBoard, CubieBoard 2 y ahora CubieTruck (http://www.cubietruck.com), los que m\u00e1s r\u00e1pido parece que avanzan.</p> <p></p> <p>Aqu\u00ed ya estamos hablando de palabras mayores en cuanto a hardware por que son dual cores, memoria de verdad (DDR3), mucha conectividad (Satas, ethernet a Giga), antena Wifi integrada.</p> <p>Es para mi gusto personal de las m\u00e1s avanzadas si no la m\u00e1s avanzadas de todas.</p> <p>El problema, el precio, ronda los 140 USD\u2026 y para una \u201cplaca\u201d ya me parece mucho dinero.</p> <p>Hay bastantes m\u00e1s alternativas, cada d\u00eda m\u00e1s, pero en este mensaje no pretendo analizar ninguna m\u00e1s, por que no se me da bien y por que despu\u00e9s de estar mirando p\u00e1ginas de fabricantes durante un rato los n\u00fameros te marean\u2026</p> <p>Eso si, veo que lo que se lleva o lo que parece mover a la gente hacia una u otra placa (hablando en t\u00e9rminos relativos claro\u2026 es mi percepci\u00f3n de la realidad) es que pueda o bien hacer correr el dichoso UBUNTU o que sea capaz de hacer correr una versi\u00f3n de Android igual o superior a ICS\u2026</p> <p>Met\u00e1foras que dir\u00eda otro\u2026</p> <p>Edito el mensaje para a\u00f1adir esta \u00faltima placa que est\u00e1 causando furor...</p> <p>Banana PI (http://www.bananapi.org)</p> <p></p> <p>Esta placa que muchos llaman el \"clon-chino\" de las Rpi es eso, un clon en toda regla.</p> <p>Leyendo las especificaciones se puede apreciar como ha mejorado el micro, la memoria, la conectividad de red, la GPU, el puerto de la tarjeta SD que est\u00e1 \"enrasado\" as\u00ed como un conector para discos Sata.</p> <p>\u00bfMola verdad?, el precio, casi el doble de una Rpi.</p> <p>He le\u00eddo unas cuatro reviews y en todas ellas coinciden en la escasa calidad de algunos componentes, que ese te\u00f3rico procesador no rinde tanto como cabr\u00eda esperar, etc..</p> <p>Mirad esta (http://raspi.tv/2014/banana-pi-review-first-impressions) en concreto, el apartado \"So. Should I Get One?\"</p> <p>O mirad esta otra (http://blog.pi3g.com/2014/05/bananapi-erster-eindruck-und-vergleich-mit-dem-raspberry-pi/) en alem\u00e1n, pero google translator os la acerca...</p> <p>No se adem\u00e1s si se tratar\u00eda de unidades iniciales con los controles de calidad no muy afinados, pero he le\u00eddo de dos unidades abrasadas, como si no incorporasen fusible (como si trae la Rpi) en la entrada de alimentaci\u00f3n.</p> <p>Y lo que es peor, es que por lo visto hay mucho desalmado que en vez de enviar estas \"bananas\" est\u00e1 mandando Rpi modelo A (cuyo coste de fabricaci\u00f3n es claramente inferior...).</p> <p>Recomendaci\u00f3n personal, luego haz lo que quieras... esperar\u00e9 un poco.</p> <p>Esas placas ni tienen un canal claro de distribuci\u00f3n ni cuentan con firmaware/drivers afinados para rendir todo lo que deber\u00edan (y por lo que vas a pagar)... esa tarea por otro lado, la de afinamiento, normalmente cae en manos de la comunidad... pensad 2,5 millones frente a X miles de bananas...</p> <p>Y ahora os explicar\u00e9is por que apenas se oye hablar de Cubieboard, beagles y otras... la comunidad lo es todo.</p>"},{"location":"rpi_apendice1/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 15) \u2013 Ap\u00e9ndice I","text":""},{"location":"rpi_apendice1/#reiniciar-nuestro-router","title":"Reiniciar nuestro router","text":"<p>Me ha pasado alguna vez que me encuentro el router de casa tostado.</p> <p>Da igual el modelo y el tipo de conectividad porqu\u00e9 me ha pasado siempre, con ADSL, con Fibra, routers buenos y no tan buenos, etc.</p> <p>Todos se bloquean tarde o temprano, porqu\u00e9 pierden el sincronismo con la l\u00ednea, porqu\u00e9 se les llena la tabla de NAT... mil cosas.</p> <p>Os cuento como podemos reiniciar el router usando para ello nuestra RPI, claro est\u00e1, el router tiene que estar sin conexi\u00f3n al exterior pero debe seguir sirviendo la LAN por ethernet, de otra manera no tenemos nada ya que el router estar\u00eda en un estado catat\u00f3nico y para eso no existe otra soluci\u00f3n que la intervenci\u00f3n humana y apagar/encender.</p> <p>Todos los routers, o la mayor\u00eda, tiene habilitado el protocolo para poder realizar conexiones por TELNET , son conexiones no segueras ya que la informaci\u00f3n viaja en \"plano\", no hay capa de cifrado.</p> <p>Pero no pasa nada (o casi nada) ya que esta conexi\u00f3n s\u00f3lo est\u00e1 disponible en la red interna, en nuestra LAN, no es posible acceder desde fuera.</p> <p>Lo primero que tenemos que hacer es, por un lado mirar si este protocolo est\u00e1 habilitado en nuestro router, y en segundo lugar mirar cual es el comando de reinicio del mismo, que suele ser un comando al estilo <code>reboot</code></p> <p>Ser\u00eda algo m\u00e1s o menos como esto:</p> <p>[root@Jarvis ~]# telnet 192.168.1.1</p> <p>Trying 192.168.1.1... Connected to 192.168.1.1. Escape character is '^]'. BCM963268 Broadband Router Login: USUARIOADMINISTRADOR Password: CLAVEADMINISTRADOR</p> <p>reboot</p> <p>Como v\u00e9is, en mi router, un VG8050 de FTTH el comando de reinicio es reboot.</p> <p>Para adivinar el vuestro, cuando el router os de l\u00ednea de comando, tendr\u00e9is que teclear help y mirar los comandos disponibles, no ser\u00e1 dif\u00edcil, reboot, restart o similar.</p> <p>Bien, pues ahora la parte que hacemos en la RPI, vamos a implementar un mecanismo por el que simulamos esta interacci\u00f3n con el router, de manera que lanzamos el comado de Telnet, y luego vamos esperando cadenas de texto y enviamos m\u00e1s informaci\u00f3n seg\u00fan se nos pide.</p> <p>Para esto utilizamos una maravilla llamada Expect , que nos permite dise\u00f1ar un script que haga esto que precisamente os cuento.</p> <p>Lo instalamos como es habitual, con <code>pacman</code></p> <p>[root@Jarvis ~]# pacman -S expect</p> <p>resolving dependencies... looking for inter-conflicts... Packages (2): tcl-8.6.1-1 expect-5.45-3 Total Download Size: 2.31 MiB Total Installed Size: 6.54 MiB :: Proceed with installation? [Y/n] Y :: Retrieving packages ... tcl-8.6.1-1-armv6h 2.1 MiB 2.16M/s       00:01 [###############################] 100% expect-5.45-3-armv6h 162.8 KiB 465K/s    00:00 [###############################] 100% (2/2) checking keys in keyring                 [################################] 100% (2/2) checking package integrity               [################################] 100% (2/2) loading package files                    [################################] 100% (2/2) checking for file conflicts              [################################] 100% (2/2) checking available disk space            [################################] 100% (1/2) installing tcl                           [################################] 100% (2/2) installing expect                        [################################] 100%</p> <p>El script, al que yo he llamado <code>RebotaRouter.sh</code>tiene este contenido:</p>"},{"location":"rpi_apendice1/#usrbinexpect","title":"!/usr/bin/expect","text":"<p>spawn telnet 192.168.1.1 expect \"Login:\" send USUARIOADMINISTRADOR send \"\\r\" expect \"Password:\" send CLAVEADMINISTRADOR send \"\\r\" expect -exact \" &gt; \" send \"reboot\" send \"\\r\" sleep 1 interact exit</p> <p>Tenemos que prestar atenci\u00f3n a la IP de nuestro router (en mi caso 192.68.1.1), el usuario y clave que usamos para administrar el router por http, y el comando de reinicio (reboot en mi caso).</p> <p>El c\u00f3digo es bastate legible, espera esta cadena (expect) y manda esta otra (send).</p> <p>Entre una y otra establece un retardo de 1 segunto (sleep X donde X es el n\u00famero de segundos a esperar).</p> <p>Tenemos que dar permisos de ejecuci\u00f3n a este script</p> <p>[root@Jarvis ~]# chmod 700 RebotaRouter.sh</p> <p>El permiso es 700, que es -rwx------, esto es, todos los permisos para el propietario y nada para otros y grupo, m\u00e1s que nada por que en ese fichero hemos puesto las credenciales de nuestro router al completo.</p> <p>Salida de esta ejecuci\u00f3n:</p> <p>[root@Jarvis ~]# ./rebota_router.sh</p> <p>spawn telnet 192.168.1.1 Trying 192.168.1.1... Connected to 192.168.1.1. Escape character is '^]'.</p> <p>BCM963268 Broadband Router Login: USUARIOADMINISTRADOR Password:</p> <p>reboot</p> <p>The system shell is being reset. Please wait...</p> <p>Connection closed by foreign host.</p> <p>Y ya estar\u00eda, el router se reinicia, lo primero es probar que esto es as\u00ed y que os funciona esta primera parte.</p>"},{"location":"rpi_apendice1/#validamos-nuestra-conexion","title":"Validamos nuestra conexi\u00f3n","text":"<p>Ahora vamos a hacer otro script, el cual valida que tenemos conexi\u00f3n a internet, y para esto lo mejor es descargaralgo.</p> <p>Para la descarga empleamos <code>wget</code> y nos bajamos una p\u00e1gina que sabemos que existe, activamos el par\u00e1metro de reintentos a 5, que por defecto son 20 (muchos) y comprobamos el resultado de este comando.</p> <p>Los comandos en Unx/Lnx siempre dan un retorno, <code>0</code> si todo va bien y <code>&gt;0</code>\u00a0si hay alg\u00fan problema.</p> <p>Con la variable de entorno <code>$?</code>\u00a0obtenemos el c\u00f3digo de retorno del \u00faltimo comando que hemos ejecutado.</p> <p>Sin m\u00e1s rollos, este es el script <code>RevisaRouter.sh</code></p>"},{"location":"rpi_apendice1/#usrbinbash","title":"!/usr/bin/bash","text":""},{"location":"rpi_apendice1/#comprobacion-del-estado-de-la-conexion-a-internet-router-tostado","title":"Comprobacion del estado de la conexion a internet / router tostado.","text":"<p>wget \u2014tries=5 http://www.yahoo.com &gt; /dev/null 2&gt;&amp;1 if ! [ \"$?\" -eq 0 ] then  # No hay conexion a internet.  # Reiniciamos el router  /root/RebotaRouter.sh  sleep 90 # esperamos 90 segundos al reinicio  echo \"Envio Router Comtrend \" &gt; /root/router.txt  echo \"Fecha: \" `date '+%d/%m/%Y %H:%M:%S'` &gt;&gt; /root/router.txt  echo \"Reinicio de router\" &gt;&gt; /root/router.txt  mutt -s \"Router\" tumail@gmail.com &lt; /root/router.txt fi rm -f /root/index.html &gt; /dev/null 2&gt;&amp;1</p> <p>Como v\u00e9is he puesto tambi\u00e9n una llamada a <code>mutt</code> que ya ten\u00edamos configurado de haberlo usado antes, para que nos notifique por mail que se ha producido un reinicio de la conexi\u00f3n.</p> <p>Le damos permisos como antes:</p> <p>[root@Jarvis ~]# chmod 755 RevisaRouter.sh</p> <p>Para probar que esto funciona, solt\u00e1is el cable de tel\u00e9fono del router (ADSL) o apag\u00e1is la ONT (FTTH) y ejecut\u00e1is el scrip, las luces del router os indicar\u00e1n que el reinicio se est\u00e1 produciendo.</p> <p>Si quer\u00e9is programarlo para que se ejecute cada cierto tiempo lo pod\u00e9is incluir dentro de crontab</p> <p>[root@Jarvis ~]# crontab -e</p> <p>0,10,20,30,40,50 *  *  /root/RevisaRouter.sh</p> <p>Con esa l\u00ednea nueva en crontab el script se ejecutar\u00eda siempre cada 10 minutos.</p>"},{"location":"rpi_apendice2/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 16) \u2013 Ap\u00e9ndice II","text":""},{"location":"rpi_apendice2/#xbmc-con-mariadb-para-instalacion-distribuida","title":"XBMC con MariaDB para instalaci\u00f3n distribuida","text":"<p>Como imagino que no ser\u00e9 el \u00fanico que se encuentra tarde o temprano desplazado del televisor del sal\u00f3n, os cuento la forma de adaptar vuestros XBMC para que se puedan seguir usando tanto los ficheros de media de vuestros discos duros conectados a la Pi, como la base de datos de contenidos para las marcas de cap\u00edtulos vistos, punto de reproducci\u00f3n etc.</p> <p>En principio est\u00e1 todo bastante basado en una gu\u00eda que publico Arthurbetico en NasyMas, adapt\u00e1ndolo a mi uso y necesidades por que claro, yo no tengo NAS.</p> <p>Eval\u00faa de todas maneras si esto que he hecho te sirve para algo, yo ahora mismo tengo la versi\u00f3n Frodo 12.3, la versi\u00f3n Gotham 13 est\u00e1 a pocas semanas de salir y anuncian cambios en todo esto de la \u201ccompartici\u00f3n\u201d de contenidos, lo mismo luego es mucho m\u00e1s f\u00e1cil\u2026 o no\u2026</p> <p>De lo que se trata es de instalar un motor de base de datos (MariaDB), configurar XBMC para que use este motor, y adem\u00e1s crear los \u201cScrapers\u201d de una forma determinada para que todo se comporte igual estemos ejecutando XBMC en nuestra Rpi o en nuestro iMac/MacBook o Pc con Windows (arggg).</p> <p>Debemos tener en cuenta que todos los \u201cclientes\u201d de XBMC que empleemos deber\u00e1n ser la misma versi\u00f3n, esto es, o todos con Frodo 12.3 o ninguno...</p> <p>Una implicaci\u00f3n que tiene esto es que vais a perder toda la informaci\u00f3n de vuestra base de datos de XMBC, marcadores de visto/no visto, etc.</p> <p>He probado las opciones de exportaci\u00f3n/importanci\u00f3n de datos pero no he sido capaz de hacerlo funcionar, por otro lado el cambio que os voy a comentar a continuaci\u00f3n en los scrapers no es compatible con los datos que tendr\u00edais en esas bases de datos actuales basadas en ficheros de texto y nos exigir\u00eda realizar tareas de actualizaci\u00f3n de datos en la base de datos MariaDB a manita\u2026 yo ya me he visto en estas cosas miles de veces por trabajo, pero a alguno se le puede fundir el \u201cfusible\u201d as\u00ed que mejor esto otro\u2026</p> <p>Por partes entonces, lo primero parar xbmc si lo tenemos funcionando.</p> <p>[root@Jarvis ~]# systemctl stop xbmc</p> <p>Ahora instalamos MariaDB</p> <p>[root@Jarvis ~]# pacman -S mariadb</p> <p>resolving dependencies... looking for inter-conflicts... Packages (1): mariadb-5.5.36-1 Total Download Size: 8.90 MiB Total Installed Size: 88.27 MiB :: Proceed with installation? [Y/n] Y :: Retrieving packages ... mariadb-5.5.36-1-armv6h 8.9 MiB 2.80M/s 00:03 [##########################################] 100% (1/1) checking keys in keyring                [##########################################] 100% (1/1) checking package integrity              [##########################################] 100% (1/1) loading package files                   [##########################################] 100% (1/1) checking for file conflicts             [##########################################] 100% (1/1) checking available disk space           [##########################################] 100% (1/1) installing mariadb                      [##########################################] 100%</p> <p>If you are migrating from MySQL, don't forget to run 'mysql_upgrade' after mysqld.service restart. synchronizing filesystem...</p> <p>Arrancamos MariaDB y la configuramos:</p> <p>[root@Jarvis lib]# systemctl start mysqld</p> <p>[root@Jarvis lib]# systemctl enable mysqld ln -s '/usr/lib/systemd/system/mysqld.service' '/etc/systemd/system/multi-user.target.wants/mysqld.service'</p> <p>[root@Jarvis lib]# mysql_secure_installation /usr/bin/mysql_secure_installation: line 379: find_mysql_client: command not found NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY! In order to log into MariaDB to secure it, we'll need the current password for the root user. If you've just installed MariaDB, and you haven't set the root password yet, the password will be blank, so you should just press enter here.</p> <p>Enter current password for root (enter for none): OK, successfully used password, moving on...</p> <p>Setting the root password ensures that nobody can log into the MariaDB root user without the proper authorisation.</p> <p>Set root password? [Y/n] Y New password: Re-enter new password: Password updated successfully!</p> <p>Reloading privilege tables.. ... Success!</p> <p>By default, a MariaDB installation has an anonymous user, allowing anyone to log into MariaDB without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment.</p> <p>Remove anonymous users? [Y/n] Y ... Success!</p> <p>Normally, root should only be allowed to connect from 'localhost'. This ensures that someone cannot guess at the root password from the network. Disallow root login remotely? [Y/n] Y ... Success!</p> <p>By default, MariaDB comes with a database named 'test' that anyone can access. This is also intended only for testing, and should be removed before moving into a production environment. Remove test database and access to it? [Y/n] Y</p> <ul> <li> <p>Dropping test database... ... Success!</p> </li> <li> <p>Removing privileges on test database... ... Success!</p> </li> </ul> <p>Reloading the privilege tables will ensure that all changes made so far will take effect immediately.</p> <p>Reload privilege tables now? [Y/n] Y ... Success!</p> <p>Cleaning up...</p> <p>All done! If you've completed all of the above steps, your MariaDB installation should now be secure.</p> <p>Thanks for using MariaDB!</p> <p>Bien, ahora vamos a crear un usuario dentro de nuestro gestor de base de datos, con privilegios para crear su propia base de datos.</p> <p>Recordar que la contrase\u00f1a del usuario root que hemos puesto hace un momento al configurar MariaDB (\u00f3 Mysql) es la del usuario root de la base de datos, no del sistema operativo!!.</p> <p>[root@Jarvis ~]# mysql -u root -p</p> <p>Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 141 Server version: 5.5.37-MariaDB-log MariaDB Server Copyright (c) 2000, 2014, Oracle, Monty Program Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)]&gt; create user 'xbmc' identified by 'xbmc'; MariaDB [(none)]&gt; grant all on . to 'xbmc'; MariaDB [(none)]&gt; flush privileges; MariaDB [(none)]&gt; exit Bye</p> <p>Siguiente paso, configurar XBMC para que utilice esa base de datos.</p> <p>El fichero de configuraci\u00f3n ser\u00e1 el mismo que empleemos luego en nuestros clientes xbmc en el entorno MAC.</p> <p>Debemos ejecutar la siguiente cadena de comandos:</p> <p>[root@Jarvis ~]# vi ~xbmc/.xbmc/userdata/advancedsettings.xml</p> <p>Introducir este contenido y salvar documento.</p> <p> mysql 192.168.1.20 xbmc_video 3306 xbmc xbmc mysql 192.168.1.20 xbmc_music 3306 xbmc xbmc </p> <p>Importante, cambiad la IP de vuestra m\u00e1quina en vuestra LAN.</p> <p>Como hemos editado con root, le damos el fichero al usuario xbmc:</p> <p>[root@Jarvis ~]# chown xbmc:xbmc ~xbmc/.xbmc/userdata/advancedsettings.xml</p> <p>Y ahora, por \u00faltimo antes de arrancar y empezar a configurar scrapers en XBMC nos faltan dos tareas, la primera es exportar nuestra biblioteca de medios por SAMBA.</p> <p>\u00bfPor que?, pues porqu\u00e9 as\u00ed el resto de equipos de la red van a ver los ficheros compartidos, es m\u00e1s, nuestra propia RPi va a acceder a sus propios ficheros de media por SAMBA, si, el local accediendo por SAMBA, por que as\u00ed es la \u00fanica manera de mantener un acceso \u00fanico y uniforme al fichero, todos accediendo por igual.</p> <p>Sin m\u00e1s l\u00edos, SAMBA ya hemos visto como ponerlo en marcha, basta con decir que tenemos que exportar esto:</p> <p>[root@Jarvis ~]# vi /etc/samba/smb.conf [global] workgroup = JarvisGRP security = user load printers = no</p> <p>[Videos] path = Videos public = no writable = yes browseable = yes valid users = root</p> <p>Yo tengo colgando de <code>/Videos</code> las carpetas <code>/Videos/Series</code> , <code>/Videos/Pelis</code> y <code>/Videos/Documentales</code>\u00a0.</p> <p>As\u00ed que el acceso por SAMBA smb://192.168.1.20/Videos ser\u00e1 nuestro punto de entrada al sistema de medios.</p> <p>Pod\u00e9is incluso probar que funciona, desde vuestros OSX, abriendo un nuevo finder (CMD + N) y pulsado sobre conectar a servidor (CMD +K) con ese smb://vuestraIP/vuestroShare podr\u00e9is acceder a la Rpi por SAMBA.</p> <p>Recordad activar samba en el inicio con</p> <p>[root@Jarvis ~]# systemctl restart smbd nmbd [root@Jarvis ~]# systemctl enable smbd nmbd</p> <p>La otra tarea que hace falta hacer es el arranque de MariaDB, ahora est\u00e1 puesto en autom\u00e1tico que arranque siempre cuando se inicie el sistema, pero siendo un proceso algo pesado, pues quiz\u00e1s nos sea m\u00e1s conveniente que se inicie siempre solo cuando XMBC est\u00e9 activado tambi\u00e9n para arrancar \u00bfno?, total, van a ir de la mano.</p> <p>Para esto que parece que es mucho y no es nada, editamos el fichero <code>/usr/lib/systemd/system/xbmc.service</code> para a\u00f1adir en After y Requires el servicio de base de datos:</p> <p>[Unit]</p> <p>Description = Starts instance of XBMC using xinit After = remote-fs.target mysqld.service Requires = mysqld.service</p> <p>Y en el fichero <code>/usr/lib/systemd/system/mysqld.service</code>\u00a0a\u00f1adir esto en Before:</p> <p>[Unit]</p> <p>Description=MariaDB database server After=syslog.target Before = xbmc.service</p> <p>Si tenemos los servicios de xbmc y mysqld ya activos en el inicio debemos refrescar esos demonios, ejecutando esto:</p> <p>[root@Jarvis system]# systemctl daemon-reload</p> <p>Y listo, vamos a empezar, arrancamos XBMC, se nos arrancar\u00e1 la base de datos, bien, sin problemas.</p> <p>Ahora BORRAMOS los scrapers y todo lo que tuvi\u00e9semos de antes (ojo borrar datos, no ficheros) y volvemos a empezar a crear de nuevo.</p> <p>Cuando entremos a crear los scrapers de nuevo, en la ventana en la que escogemos la ruta debemos desplazarnos hasta que encontremos una que nos indica acceso por Samba o por SMB, esa es la nuestra, tan s\u00f3lo seguir los pasos de la pantalla, poner usuarios y claves donde nos lo pida y listo.</p> <p>No es muy complicado y ya lo hemos hecho una vez, a ver si puedo poner unas capturas de pantalla.</p> <p>Al terminar todo habremos reconstruido nuestra base de datos pero utilizando una base de datos a la que podemos atacar desde el exterior, en nuestra LAN.</p> <p>La parte de OSX, pues muy f\u00e1cil, instalamos XBMC (misma versi\u00f3n que en la RPI, recordad) y generamos el fichero advancedsettings.xml tal y como tenemos en nuestra RPI, el mismo contenido.</p> <p>Este fichero est\u00e1 en <code>/Users/TUUAURIO/Library/Application Support/XBMC/userdata</code>\u00a0y si no existe lo deb\u00e9is crear.</p> <p>Cuando os arranque XBMC de vuestro OSX es crear los scrapers tal y como hemos hecho en la RPi (acceso \u00fanico por samba. genial verdad?!!) y listo, ya ver\u00e9is como las marcas de visto/no visto se sincronizan y los puntos de reproducci\u00f3n tambi\u00e9n.</p> <p>Pendiente dejo lo de las capturas\u2026 que ando con l\u00edo.</p>"},{"location":"rpi_apendice3/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 17) \u2013 Ap\u00e9ndice III","text":""},{"location":"rpi_apendice3/#administrar-por-consola-web-nuestra-raspberry","title":"Administrar por consola WEB nuestra Raspberry","text":"<p>He dejado un poco para el final esta parte del tutorial.</p> <p>Espero que por lo menos lo que hay\u00e1is le\u00eddo hasta ahora os haya dejado algo de poso.</p> <p>A la respuesta de si se puede administrar la Raspberry de una forma m\u00e1s amigable, hasta ahora os he contestado que NO.</p> <p>Mentira\u2026 pero como dicen los padres\u2026 era por vuestro bien.</p> <p>Existe un software, desde hace muuuchooo tiempo que se llama Webmin</p> <p>Es una interfaz basada en web que nos permite administrar sistemas Unix (desde grandes a peque\u00f1os) sin ni siquiera tocar la l\u00ednea de comando (os estoy viendo\u2026 algunos dais saltos de alegr\u00eda\u2026)</p> <p>\u00bfSe puede hacer lo mismo con Webmin que con la l\u00ednea de comandos?, en principio si, pero no, la l\u00ednea es mucho m\u00e1s potente, de eso no hay duda, pero digamos que podr\u00e9is hacer un 90% con Webmin.</p> <p>Existe otro riesgo potencial y es que los sistemas operativos evolucionan m\u00e1s y mejor que Webmin (que ha mejorado mucho desde la \u00faltima vez que lo vi, har\u00e1 como unos 15 a\u00f1os) y podr\u00e9is encontrar que algo falla o que no se ejecuta bien en la m\u00e1quina por que el componente Webmin que interact\u00faa con esa parte de la m\u00e1quina est\u00e1 desactualizado.</p> <p>Esto en el caso de ARCH, que como os dije es una Rolling Release, pues ya v\u00e9is, actualizaciones casi a diario del sistema, vosotros decid\u00eds.</p> <p>Eso s\u00ed, si alguien os ve alguna vez esta consola y os pregunta, por favor, no le dig\u00e1is que os lo he contado yo, quiero mantener mi ya de por s\u00ed maltrecha reputaci\u00f3n intacta.</p>"},{"location":"rpi_apendice3/#instalacion-de-webmin","title":"Instalaci\u00f3n de Webmin","text":"<p>Os recomiendo que antes de instalar Webmin ejecut\u00e9is el comando de actualizaci\u00f3n completa de m\u00e1quina</p> <p>[root@Jarvis ~]# pacman -Suy</p> <p>:: Synchronizing package databases... core 154.6 KiB 522K/s 00:00     [############################################] 100% extra 2.0 MiB 2.16M/s 00:01     [############################################] 100% community 2.2 MiB 2.19M/s 00:01 [############################################] 100% alarm is up to date aur is up to date :: Starting full system upgrade... resolving dependencies... looking for inter-conflicts... Packages (2): mesa-10.1.2-1 mesa-libgl-10.1.2-1 Total Download Size: 1.82 MiB Total Installed Size: 12.63 MiB Net Upgrade Size: 0.01 MiB :: Proceed with installation? [Y/n]</p> <p>\u2026</p> <p>[root@Jarvis ~]# sync; reboot</p> <p>Y despu\u00e9s de reiniciar tambi\u00e9n es una buena idea \u201capagar\u201d los servicios que teng\u00e1is corriendo en la m\u00e1quina para evitar conflictos de ficheros abiertos.</p> <p>[root@Jarvis ~]# systemctl stop xbmc mysqld smbd nmbd</p> <p>Instalamos el paquete de Webmin, que como siempre, gracias a pacman es muy f\u00e1cil</p> <p>[root@Jarvis ~]# pacman -S webmin</p> <p>resolving dependencies... looking for inter-conflicts... Packages (2): perl-perl4-corelibs-0.003-2 webmin-1.680-1 Total Download Size: 11.69 MiB Total Installed Size: 57.01 MiB :: Proceed with installation? [Y/n] Y :: Retrieving packages ... perl-perl4-corelibs-0.003-2-any 36.5 KiB 269K/s 00:00 [############################################] 100% webmin-1.680-1-armv6h 11.7 MiB 3.56M/s 00:03          [############################################] 100% (2/2) checking keys in keyring                        [############################################] 100% (2/2) checking package integrity                      [############################################] 100% (2/2) loading package files                           [############################################] 100% (2/2) checking for file conflicts                     [############################################] 100% (2/2) checking available disk space                   [############################################] 100% (1/2) installing perl-perl4-corelibs                  [############################################] 100% (2/2) installing webmin                               [############################################] 100%</p> <p>Note: ==&gt; It is not allowed to install 3rd party modules, or delete existing modules. ==&gt; Please write your own PKGBUILDS for 3rd party modules and additional themes.</p> <p>Setup: ==&gt; To make webmin start at boot time, add webmin to rc.conf daemons ==&gt; Point your web browser to http://localhost:10000 to use webmin. ==&gt; The access is restricted to localhost, if you want to connect from other locations ==&gt; change /etc/webmin/miniserv.conf to something like that: allow=127.0.0.1  ==&gt; If you want to have ssl encryption please install 'perl-net-ssleay' additional. <p>synchronizing filesystem...</p>"},{"location":"rpi_apendice3/#configuracion-de-webmin","title":"Configuraci\u00f3n de Webmin","text":"<p>Como pod\u00e9is leer en el mensaje post-instalaci\u00f3n el acceso a la m\u00e1quina para administrarla con webmin es por http al puerto 1000, este valor se puede cambiar y poner otro que no sea tan est\u00e1ndar, aunque siendo webmin un tanto \u201ccoladero\u201d os dar\u00e1 igual.</p> <p>M\u00e1s, la conexi\u00f3n es en plano, http, no hay cifrado a no ser que instal\u00e9is las librer\u00edas de perl para ssl como os indica este mismo mensaje, pero bueno\u2026 como webmin es un \u201ccoladero\u201d\u2026</p> <p>As\u00ed que s\u00f3lo os queda modificar este fichero /etc/webmin/miniserv.conf para a\u00f1adir la direcci\u00f3n IP desde la que podr\u00e9is acceder a administrar el equipo, vamos, la direcci\u00f3n o direcciones ip de vuestra red LOCAL (tu mac, tu iphone, tu ipad) que podr\u00e1n acceder, que nadie abra Webmin al exterior en el router, por si no os lo he dicho, webmin es un \u201ccoladero\u201d.</p> <p>En caso contrario, no a\u00f1adir vuestras IPs de red local, no podr\u00e9is hacer nada pues Webmin por defecto solo admite conexiones procedente de 127.0.0.1 (localhost).</p> <p>En mi caso esa l\u00ednea se queda tal que as\u00ed, con la direcci\u00f3n de mi iMac y del iPhone</p> <p>allow=127.0.0.1 192.168.1.11 192.168.1.18</p> <p>Lo activamos para que se arranque al inicio del sistema y lo arrancamos para poder entrar</p> <p>[root@Jarvis ~]# systemctl enable webmin ln -s '/usr/lib/systemd/system/webmin.service' '/etc/systemd/system/multi-user.target.wants/webmin.service'</p> <p>[root@Jarvis ~]# systemctl start webmin</p> <p>Y como es l\u00f3gico no funciona\u2026 (la l\u00ednea de comandos si\u2026 Webmin 0 - Linea de Comandos 1 mu ha ha ha), el log <code>/var/log/webmin/miniserv.err</code> nos indica que le falta un paquete del int\u00e9rprete de Perl para PAM (recordar, los m\u00f3dulos de autenticaci\u00f3n, como el google_authenticator que montamos).</p> <p>Esto pasa por no leer la documentaci\u00f3n de instalaci\u00f3n (http://www.webmin.com/udownload.html) que lo dice muy clarito en sus requisitos.</p> <p>Por si acaso, vamos a instalar las perl-net-ssl por si acaso decidimos montar el acceso por SSL.</p> <p>[root@Jarvis ~]# pacman -S perl-net-ssleay</p> <p>resolving dependencies... looking for inter-conflicts... Packages (1): perl-net-ssleay-1.58-1 Total Download Size: 0.17 MiB Total Installed Size: 0.67 MiB :: Proceed with installation? [Y/n] Y :: Retrieving packages ... perl-net-ssleay-1.58-1-armv6h 172.1 KiB 486K/s 00:00 [############################################] 100% (1/1) checking keys in keyring                       [############################################] 100% (1/1) checking package integrity                     [############################################] 100% (1/1) loading package files                          [############################################] 100% (1/1) checking for file conflicts                    [############################################] 100% (1/1) checking available disk space                  [############################################] 100% (1/1) installing perl-net-ssleay                     [############################################] 100%</p> <p>synchronizing filesystem...</p> <p>Y ahora vamos con ese m\u00f3dulo para PAM en perl que hay que compilarlo (Webmin 0 - Linea de Comandos 2)</p> <p>Nos creamos un directorio temporal, descargamos los fuentes desde CPAN y compilamos siguiente las instrucciones de su README.</p> <p>[root@Jarvis ~]# mkdir ~/Builds [root@Jarvis ~]# cd ~/Builds/</p> <p>[root@Jarvis Builds]# wget http://search.cpan.org/CPAN/authors/id/N/NI/NIKIP/Authen-PAM-0.16.tar.gz</p> <p>--2014-05-06 21:18:41-- http://search.cpan.org/CPAN/authors/id/N/NI/NIKIP/Authen-PAM-0.16.tar.gz Resolving search.cpan.org (search.cpan.org)... 199.15.176.161 Connecting to search.cpan.org (search.cpan.org)|199.15.176.161|:80... connected. HTTP request sent, awaiting response... 302 Found Location: http://www.cpan.org/authors/id/N/NI/NIKIP/Authen-PAM-0.16.tar.gz [following]</p> <p>--2014-05-06 21:18:41-- http://www.cpan.org/authors/id/N/NI/NIKIP/Authen-PAM-0.16.tar.gz Resolving www.cpan.org (www.cpan.org)... 212.117.177.118, 2a01:608:2:4::2, 2607:f238:3::91:1 Connecting to www.cpan.org (www.cpan.org)|212.117.177.118|:80... connected. HTTP request sent, awaiting response... 200 OK</p> <p>Length: 45922 (45K) [application/x-gzip] Saving to: 'Authen-PAM-0.16.tar.gz' 100%[======================================================================================&gt;] 45,922 --.-K/s in 0.1s 2014-05-06 21:18:42 (341 KB/s) - 'Authen-PAM-0.16.tar.gz' saved [45922/45922]</p> <p>[root@Jarvis Builds]# tar -xvzf Authen-PAM-0.16.tar.gz</p> <p>Authen-PAM-0.16/ Authen-PAM-0.16/PAM_config.h.in Authen-PAM-0.16/META.yml Authen-PAM-0.16/configure.ac Authen-PAM-0.16/test.pl Authen-PAM-0.16/Changes Authen-PAM-0.16/d/ Authen-PAM-0.16/d/PAM.pm Authen-PAM-0.16/PAM.xs Authen-PAM-0.16/MANIFEST Authen-PAM-0.16/PAM.pm.in Authen-PAM-0.16/typemap Authen-PAM-0.16/configure Authen-PAM-0.16/PAM/ Authen-PAM-0.16/PAM/FAQ.pod Authen-PAM-0.16/pam.cfg.in Authen-PAM-0.16/README Authen-PAM-0.16/Makefile.PL</p> <p>[root@Jarvis Builds]# cd Authen-PAM-0.16</p> <p>[root@Jarvis Authen-PAM-0.16]# perl Makefile.PL Checking if your kit is complete... Looks good checking for gcc... cc</p> <p>\u2026</p> <p>root@Jarvis Authen-PAM-0.16]# make cp PAM.pm blib/lib/Authen/PAM.pm cp PAM/FAQ.pod blib/lib/Authen/PAM/FAQ.pod /usr/bin/perl /usr/share/perl5/core_perl/ExtUtils</p> <p>\u2026</p> <p>[root@Jarvis Authen-PAM-0.16]# make test PERL_DL_NONLAZY=1 /usr/bin/perl \"-Iblib/lib\" \"-Iblib/arch\" test.pl 1..10 ok 1</p> <p>---- The remaining tests will be run for service 'login', user 'root' and ---- device '/dev/pts/0'. ok 2 ok 3 ok 4 ok 5 ok 6 ok 7 ok 8 ---- Now, you may be prompted to enter the password of 'root'.</p> <p>Password: not ok 9 (7 - Authentication failure) ---- The failure of test 9 could be due to your PAM configuration ---- or typing an incorrect password. ok 10 ok 11</p> <p>[root@Jarvis Authen-PAM-0.16]# make install Files found in blib/arch: installing files in blib/lib into architecture dependent library tree Installing /usr/lib/perl5/site_perl/auto/Authen/PAM/PAM.so Installing /usr/lib/perl5/site_perl/auto/Authen/PAM/PAM.bs Installing /usr/lib/perl5/site_perl/Authen/PAM.pm Installing /usr/lib/perl5/site_perl/Authen/PAM/FAQ.pod Installing /usr/share/man/man3/Authen::PAM.3pm Installing /usr/share/man/man3/Authen::PAM::FAQ.3pm Appending installation info to /usr/lib/perl5/core_perl/perllocal.pod</p> <p>Reiniciamos webmin para que se cargue con los cambios y librer\u00edas nuevas</p> <p>[root@Jarvis ~]# systemctl restart webmin</p> <p>Y nueva prueba, por lo menos ahora al arrancar el log nos dice que ha cargado el m\u00f3dulo de PAM, que ya es algo</p> <p>[06/May/2014:21:26:45 +0200] miniserv.pl started [06/May/2014:21:26:45 +0200] Using MD5 module Digest::MD5 [06/May/2014:21:26:45 +0200] PAM authentication enabled</p> <p>Y probamos a entrar a la url de gesti\u00f3n por Webmin, eso si, recordad que ahora estamos con SSL y por tanto ser\u00e1 algo as\u00ed como https://192.168.1.20:10000</p> <p>Deber\u00e9is aceptar el certificado para poder entrar.</p>"},{"location":"rpi_apendice3/#y-asi-es-webmin","title":"Y as\u00ed es Webmin","text":"<p>*Nota del 2020: las capturas de pantalla... se perdieron, pero como webmin sigue siendo un coladero, tampoco importa.</p> <p>La p\u00e1gina inicial de login, seg\u00fan la documentaci\u00f3n, debemos entrar con usuario UID 0 (root) o con un usuario con privilegios para ejecutar sudo.</p> <p>(http://i59.tinypic.com/3462qee.png)</p> <p>Y no te deja entrar si no entras con root directamente, fant\u00e1stico coladero (Webmin 0 - Linea de Comandos 3)</p> <p>Una vez accedemos se nos muestra una pantalla de resumen con el estado de nuestra m\u00e1quina</p> <p>(http://i57.tinypic.com/2mccdg8.png)</p> <p>Y este men\u00fa en la izquierda podremos seleccionar lo que queremos hacer en nuestra m\u00e1quina RPi</p> <p>(http://i62.tinypic.com/qyedkz.png)</p> <p>Os recomiendo entra en la configuraci\u00f3n de webmin y cambiar el idioma</p> <p>(http://i62.tinypic.com/4revmg.png)</p> <p>As\u00ed como a\u00f1adir m\u00f3dulos adicionales de servicios que teng\u00e1is en marcha, como podr\u00eda ser SAMBA.</p> <p>(http://i60.tinypic.com/24o65ax.png)</p> <p>Otra opci\u00f3n importante a activar es la autenticaci\u00f3n en dos pasos, esto ya lo hemos visto y bueno, por si no os lo he dicho, webmin es un \u201ccoladero\u201d, as\u00ed que siempre viene bien un poco m\u00e1s de seguridad.</p> <p>(http://i62.tinypic.com/ztamg1.png)</p> <p>Y de aqu\u00ed en adelante, pues ya es investigar, yo es que no pierdo mucho el tiempo con estas herramientas.</p>"},{"location":"rpi_backup/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 5) \u2013 Copias de Seguridad","text":""},{"location":"rpi_backup/#copias-de-seguridad","title":"Copias de seguridad","text":"<p>En este punto tenemos nuestra m\u00e1quina lista y preparada para empezar a meter contenido en ella.</p> <p>Instalar programas, activar funcionalidades, en definitiva, para empezar el cacharreo, as\u00ed que toca pensar en tener\u00a0como m\u00ednimo un punto de restauraci\u00f3n para no tener que volver a realizar todos los trabajos que hemos hecho hasta\u00a0ahora.</p> <p>Adem\u00e1s de todo esto, la copia de seguridad nos va a aportar un plus de tranquilidad, y ya no tendremos tanto miedo\u00a0por tocar este o aquel fichero de configuraci\u00f3n y llevarnos la sorpresa de que nuestra m\u00e1quina no se comporta como\u00a0quer\u00edamos o que simplemente no arranca.</p> <p>Os cuento como hago yo las copias de seguridad, y como siempre digo, esto es s\u00f3lo una parte, y como yo lo hago,\u00a0tomadlo como una base si quer\u00e9is pero no como un dogma.</p> <p>Por desgracia para nosotros los Maqueros, aqu\u00ed no disponemos de nada similar al fant\u00e1stico TimeMachine, as\u00ed que\u00a0debemos implementarlo todo con otros programas y mecanismos (programaci\u00f3n de tareas), adem\u00e1s las copias\u00a0completas ser\u00e1n algo m\u00e1s manuales y a m\u00e1quina parada.</p> <p>Distinguiremos dos tipos de copias de seguridad, las copias en fr\u00edo, o copias completas, donde la m\u00e1quina est\u00e1 parada\u00a0y no se realizan por tanto modificaciones en su contenido, es m\u00e1s, para estas copias deberemos retirar la tarjeta SD\u00a0de la m\u00e1quina.</p> <p>Y las copias en caliente, que realizaremos con la m\u00e1quina en funcionamiento, aunque en ocasiones podamos llegar a\u00a0sufrir algo de degradaci\u00f3n en el rendimiento de nuestra m\u00e1quina por en consumo de disco/cpu de la operaci\u00f3n de\u00a0copia. Estas copias en caliente ser\u00e1n complemento de las anteriores.</p> <p>Explicado un poco mejor, partimos de una copia en fr\u00edo, la cual no es m\u00e1s que un espejo o snapshot de la actual\u00a0informaci\u00f3n de nuestra tarjeta SD, y que se realiza con no mucha asiduidad, ya que implica la parada de la m\u00e1quina.</p> <p>Tenemos por otro lado que a diario, o incluso varias veces a lo largo del d\u00cca, se realizan copias en caliente, las cuales\u00a0adem\u00e1s son incrementales, esto es, se copia todo y luego se copia \u00fanicamente lo que se modifica (realmente se\u00a0copian los bloques de los ficheros que cambian, es la llamada tecnolog\u00eda delta</p> <p>Para restaurar nuestra m\u00e1quina en el \u00faltimo momento antes de un error debemos restaurar la tarjeta con la \u00faltima\u00a0copia de seguridad completa en fr\u00edo que tengamos y luego a\u00f1adirle la informaci\u00f3n del incremental de que\u00a0disponemos.</p>"},{"location":"rpi_backup/#copia-completa-sd-copia-en-frio","title":"Copia completa SD (copia en fr\u00edo)","text":"<p>No se si record\u00e1is la utilidad que os coment\u00e9 en el momento de pasar la imagen del sistema operativo a la SD, Pi\u00a0Filler\u00a0, como os dije ese fabricante tiene otra utilidad llamada Pi Copier\u00a0que hace la operaci\u00f3n inversa, pasar el contenido de la tarjeta a un fichero en\u00a0nuestro disco duro, incluso hace una compresi\u00f3n del fichero de volcado si as\u00ed se lo indicamos.</p> <p>Ambos programas, Pi Filler y Pi Copier est\u00e1n hechos en AppleScript y son f\u00e1cilmente editables, para que ve\u00e1is si\u00a0quer\u00e9is lo que realmente hacen.</p> <p>El uso de Pi Copier es muy sencillo pues s\u00f3lo hay que seleccionar nuestra tarjeta SD e indicar un fichero de destino,\u00a0marcando si queremos que Adem\u00e1s la copia sea posteriormente comprimida y listo,a esperar el resultado.</p> <p>Es posible que queramos hacerlo manualmente, total es hacer la operaci\u00f3n inversa a la de carga de la SD con la\u00a0imagen original.</p> <p>Para esto, volveremos a usar el comando dd cambiando como es l\u00f3gico los par\u00e1metros de entrada y salida de la\u00a0informaci\u00f3n.</p> <p>Este ser\u00eda el comando para volcar nuestra tarjeta SD en nuestra carpeta Descargas:</p> <pre><code>sudo dd bs=1m if=/dev/rdisk1 | gzip &gt; ~/downloads/2014-04-26_Jarvis.img.gz\n</code></pre> <p>El par\u00e1metro <code>if</code> indica que nuestro origen ser\u00e1 el disco (completo, no particiones) que corresponde a nuestra tarjeta\u00a0SD (en mi caso es este, <code>/dev/rdisk1</code> pues monto con un USB porta SD, recordad como vimos como localizar nuestro\u00a0dispositivo en el mensaje de instalaci\u00f3n de la SD).</p> <p>Y \u00bfel par\u00e1metro de salida?, no est\u00e1, se omite, por que la salida del comando, salida est\u00e1ndar o a pantalla se est\u00e1\u00a0enviando a un comando mediante el uso de ese <code>|</code>, esto es, la salida est\u00e1ndar del comando <code>dd</code> se est\u00e1 empleando\u00a0como entrada est\u00e1ndar del comando <code>gzip</code>\u00a0( es la versi\u00f3n GNU\u00a0de nuestro conocido Zip), y la salida generada por gzip es enviada a un fichero\u00a0mediante el uso de <code>&gt;</code> el cual se encuentra en la carpeta de Descargas (Downloads, recordad que el terminal del\u00a0sistema operativo lo ve todo en ingl\u00e9s...) de la carpeta HOME del usuario, la cual viene indicada por el uso de nuestra\u00a0amiga la virgulilla <code>~</code>.</p> <p>Importante, el tama\u00f1o del fichero de destino, en caso de no comprimirlo es el mismo que el tama\u00f1o de la tarjeta SD,\u00a0est\u00e9 esta llena o no, si nuestra tarjeta es de 32Gb nuestra imagen en disco ser\u00e1 de esos 32Gb, pues la copia es\u00a0literal, as\u00ed pues, imprescindible comprimirla a no ser que dispongamos de Terabytes libres para regalar.</p>"},{"location":"rpi_backup/#copias-incrementales-copia-en-caliente","title":"Copias incrementales (copia en caliente)","text":"<p>Bien, pues ahora tenemos un punto de partida para poder restaurar nuestra m\u00e1quina, a trav\u00e9s de esas im\u00e1genes\u00a0completas de tarjeta. Estas copias, por lo que tardan y por que debemos detener la m\u00e1quina no las haremos con\u00a0mucha frecuencia, yo en mi caso particular las hago una vez al mes... mes arriba mes abajo XD.</p> <p>Para las copias en caliente yo empleo dos m\u00e9todos, uso Rsync\u00a0y Dump casi indistintamente, si bien rsync es bastante m\u00e1s frecuente y me\u00a0fuerzo a usarlo bastante m\u00e1s regularmente pues es posible hacerlo incluso volcando sobre equipos que est\u00e9n en\u00a0nuestra red (p.e. un NAS)</p> <p>Os voy a contar como opero con Rsync, para tratar de no hacer este tutorial demasiado extenso y dejamos por ahora\u00a0el tema de dump para futuras revisiones de este texto. Adem\u00e1s, como veremos un poco m\u00e1s adelante, el uso de\u00a0rsync nos va a venir muy bien para utilizar nuestra m\u00e1quina como centro de respaldo de nuestros equipos Apple, algo\u00a0as\u00ed como una peque\u00f1a Time Capsule.</p> <p>Necesitamos un pendrive de al menos 4Gb (f\u00e1cil y barato hoy en d\u00eda), el pendrive lo conectamos a uno de los dos\u00a0puertos USB y ser\u00e1 nuestra unidad de respaldo.</p> <p>Este unidad la vamos a montar de manera fija, por tanto no dependeremos de la posibilidad de automontaje que\u00a0luego m\u00e1s adelante veremos.</p> <p>En primer lugar, despu\u00e9s de conectar el pendrive a la m\u00e1quina, debemos identificar que dispositivo se corresponde\u00a0con nuestro pendrive:</p> <p>Con el siguiente comando vemos como el dispositivo est\u00e1 conectado a la m\u00e1quina y que es identificado por esta (en\u00a0mi caso un lector de tarjeta Micro-SD):</p> <pre><code>[root@Jarvis log]# lsusb\n\nBus 001 Device 004: ID 1058:1103 Western Digital Technologies, Inc. My Book Studio\nBus 001 Device 005: ID 05e3:0715 Genesys Logic, Inc. USB 2.0 microSD Reader\nBus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. SMSC9512/9514 Fast Ethernet Adapter\nBus 001 Device 002: ID 0424:9512 Standard Microsystems Corp. SMC9512/9514 USB Hub\nBus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub\n</code></pre> <p>Y la mejor manera de ver cual es el dispositivo de nuestro pendrive es guiarnos por la salida del comando fdisk y por\u00a0las capacidades de los \"discos\":</p> <pre><code>[root@Jarvis ~]# fdisk -l\n\nDisk /dev/sdb: 3.7 GiB, 3965190144 bytes, 7744512 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: dos\nDisk identifier: 0x00000000\nDevice Boot Start End Blocks Id System\n/dev/sdb1 8192 7744511 3868160 b W95 FAT32\n</code></pre> <p>Nuestro pendrive es la unidad <code>/dev/sdb</code> y la partici\u00f3n es la 1 (\u00fanica partici\u00f3n por otro lado), est\u00e1 formateado\u00a0sistema de ficheros Fat32, as\u00ed que vamos a hacer lo propio que es crear unas particiones m\u00e1s acordes con el sistema\u00a0operativo con el que estamos tratando y a formatear estas particiones.</p> <p>En concreto crearemos dos, una la vamos a emplear ahora en este paso de copias de seguridad y la otra partici\u00f3n la\u00a0utilizaremos en el siguiente mensaje...</p> <p>Es posible usar el \u201cdisco\u201d en Fat32, y as\u00ed podremos compartir este pendrive entre sistemas, pero esto lo veremos en\u00a0otra ocasi\u00f3n ya que necesitar\u00edamos modificar las opciones de montaje del dispositivo (no vale emplear el defaults en\u00a0fstab) y podemos tener algunos problemas de permisos, por no decir que tendremos la limitaci\u00f3n de tama\u00f1o m\u00e1ximo\u00a0de archivo que tiene Fat32 respecto a ext4.</p> <pre><code>[root@Jarvis ~]# fdisk /dev/sdb\n\nWelcome to fdisk (util-linux 2.24.1).\nChanges will remain in memory only, until you decide to write them.\nBe careful before using the write command.\n\nOrden (m para obtener ayuda): p\nDisk /dev/sdb: 7,5 GiB, 8017412096 bytes, 15659008 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: dos\nDisk identifier: 0xc3072e18\nDisposit. Inicio Start Final Blocks Id System\n/dev/sdb1 2048 15659007 7828480 83 Linux\nOrden (m para obtener ayuda): d\nSelected partition 1\nPartition 1 has been deleted.\n\nOrden (m para obtener ayuda): n\nPartition type:\np primary (0 primary, 0 extended, 4 free)\ne extended\n\nSelect (default p): p\nN\u00famero de partici\u00f3n (1-4, default 1): 1\nFirst sector (2048-15659007, default 2048):\nLast sector, +sectors or +size{K,M,G,T,P} (2048-15659007, default 15659007): +3G\nCreated a new partition 1 of type 'Linux' and of size 3 GiB.\n\nOrden (m para obtener ayuda): n\nPartition type:\np primary (1 primary, 0 extended, 3 free)\ne extended\n\nSelect (default p): p\nN\u00famero de partici\u00f3n (2-4, default 2): 2\nFirst sector (6293504-15659007, default 6293504):\nLast sector, +sectors or +size{K,M,G,T,P} (6293504-15659007, default 15659007):\nCreated a new partition 2 of type 'Linux' and of size 4,5 GiB.\n\nOrden (m para obtener ayuda): p\nDisk /dev/sdb: 7,5 GiB, 8017412096 bytes, 15659008 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: dos\nDisk identifier: 0xc3072e18\nDisposit. Inicio Start Final Blocks Id System\n/dev/sdb1 2048 6293503 3145728 83 Linux\n/dev/sdb2 6293504 15659007 4682752 83 Linux\n\nOrden (m para obtener ayuda): w\nThe partition table has been altered.\nCalling ioctl() to re-read partition table.\nSyncing disks.\n</code></pre> <p>Ahora creamos el FileSystem en esa partici\u00f3n de disco (de tipo ext4 ), y el\u00a0directorio donde montaremos el disco:</p> <pre><code>[root@Jarvis ~]# mkfs -t ext4 /dev/sdb1\n\nmke2fs 1.42.8 (20-Jun-2013)\nFilesystem label=\nOS type: Linux\nBlock size=4096 (log=2)\nFragment size=4096 (log=2)\nStride=0 blocks, Stripe width=0 blocks\n242400 inodes, 967808 blocks\n48390 blocks (5.00%) reserved for the super user\nFirst data block=0\nMaximum filesystem blocks=994050048\n30 block groups\n32768 blocks per group, 32768 fragments per group\n8080 inodes per group\nSuperblock backups stored on blocks:\n32768, 98304, 163840, 229376, 294912, 819200, 884736\nAllocating group tables: done\nWriting inode tables: done\nCreating journal (16384 blocks): done\nWriting superblocks and filesystem accounting information: done\n\n[root@Jarvis /]# mkdir /BCK\n</code></pre> <p>Y por \u00faltimo, configuramos el punto de montaje, para lo que debemos editar nuestro fichero <code>/etc/fstab</code> (con VI por\u00a0supuesto) y a\u00f1adir la siguiente l\u00ednea:</p> <pre><code>/dev/sdb1 /BCK ext4 defaults 0 0\n</code></pre> <p>Para a\u00f1adir esa l\u00ednea, despu\u00e9s de haber tecleado <code>vi /etc/fstab</code>\u00a0pulsamos las teclas SHIFT + G (que nos lleva al final\u00a0del fichero) y una vez all\u00ed pulsamos la tecla o (o min\u00fascula) para a\u00f1adir una nueva l\u00ednea a continuaci\u00f3n de la actual(\u00faltima en nuestro caso) y as\u00ed entramos en modo edici\u00f3n, aqu\u00ed podemos teclear la informaci\u00f3n o usar copiar y pegar\u00a0de la que os he puesto si es que el nombre del dispositivo coincide.</p> <p>En caso de no realizar un nuevo particionamiento y aprovechar lo que tenemos en el pendrive (p.e. Fat32), la l\u00ednea\u00a0que debemos crear en <code>/etc/fstab</code>\u00a0es la siguiente:</p> <pre><code>/dev/sdb1 /BCK vfat user,rw,umask=111,dmask=000 0 0\n</code></pre> <p>En los siguientes arranques de la m\u00e1quina ese punto de montaje ya estar\u00e1 presente, y si queremos activarlo ahora,\u00a0sin tener que reiniciar recurriremos al comando mount el cual nos montar\u00e1 los recursos pendientes de montaje tal y\u00a0como aparecen en nuestro <code>/etc/fstab</code></p> <pre><code>[root@Jarvis /]# mount -a\n[root@Jarvis /]# df -kh\n\nFilesystem Size Used Avail Use% Mounted on\n/dev/sdb1 3.6G 7.4M 3.4G 1% /BCK\n</code></pre> <p>Con la infraestructura necesaria para estas copias incrementales ya operativa vamos a ver los comandos y scripts\u00a0necesarios para hacerla funcionar.</p> <p>Lo primero es instalar rsync que por defecto no est\u00e1 incluido en la instalaci\u00f3n base, para esto:</p> <pre><code>sudo pacman -S rsync\n</code></pre> <p>El comando para hacer una copia completa de toda nuestra tarjeta sobre el directorio <code>/BCK/Copias</code> del pendrive es\u00a0este:</p> <pre><code>rsync -aAXv /* /BCK --exclude={/dev/*,/proc/*,/sys/*,/tmp/*,/run/*,/mnt/*,/media/*,/lost+found,/BCK/*}\n</code></pre> <p>Los par\u00e1metros empleados, -aAX son para que la copia sea lo m\u00e1s literal posible en cuanto a permisos, ACLs, etc, as\u00ed\u00a0como para que el copiado se comporte de manera recursiva.</p> <p>En las exclusiones ponemos todos los directorios de los que cuelga el sistema \u201cen vuelo\u201d, esto es, en <code>/proc</code> por\u00a0ejemplo tenemos los procesos que est\u00e1n corriendo, en <code>/tmp</code> los temporales que se pierden tras cada reinicio, etc.</p> <p>Y por supuesto, debemos excluir la propia carpeta de copias, que en este caso est\u00e1 montada bajo <code>/</code> y ser\u00eda tomada en\u00a0cuenta por el <code>/*</code>.</p> <p>Si el comando finaliza bien podemos incorporarlo en un fichero de shell script y programarlo mediante crontab\u00a0para su ejecuci\u00f3n.</p> <p>Para esto, con el usuario root ejecutamos: <pre><code>mkdir -p /home/operador/scripts\nmkdir -p /home/operador/logs\nchown operador:operadores /home/operador/scripts\nvi /home/operador/scripts/CopiaSeg.sh\n</code></pre></p> <p>El primer comando,<code>mkdir -p</code> crea el directorio scripts, el modificador -p lo que indica es que se cree toda la estructura de directorios que haga falta.</p> <p>El segundo comando,<code>chown</code>\u00a0es de Change Owner, esto es, cambiar de propietario, el directorio que hemos creado es\u00a0propiedad del usuario root, lo cambiamos para que sea propiedad del usuario operador y del grupo operadores.</p> <p>El contenido del fichero que estamos editando con VI ser\u00e1 este: <pre><code>#!/bin/bash\n\nrsync -aAXv /* /BCK --exclude={/dev/*,/proc/*,/sys/*,/tmp/*,/run/*,/mnt/*,/media/*,/lost+found,/BCK/*} &gt; /dev/null 2&gt;/home/operador/logs/CopiaSeg.log\n\nESC + :wq!\n</code></pre></p> <p>Le damos permisos de ejecuci\u00f3n al script con el comando chmod: <pre><code>chmod u+x /home/operador/scripts/CopiaSeg.sh\n</code></pre></p> <p>Y por \u00faltimo editamos el crontab del usuario root para ponerlo que se ejecute a diario, todos los d\u00edas de la semana a\u00a0las 23:00 horas. <pre><code>crontab -e\n\n0 23 * * * /home/operador/scripts/CopiaSeg.sh\n</code></pre></p> <p>Esto es una aproximaci\u00f3n digamos que \u201cdecente\u201d de un sistema de copias de seguridad, menos es nada, y por lo\u00a0menos desde estas copias podr\u00e9is volver a poner el sistema en marcha.</p> <p>En cuando que pueda pondr\u00e9 en la secci\u00f3n \u201cAnexos\u201d de este mensaje alg\u00fan script algo m\u00e1s elaborado respecto a las\u00a0copias de seguridad, para poder tener copias por semanas, manteniendo al menos un mes, etc\u2026 vamos, algo un poco\u00a0mejor que todo esto.</p>"},{"location":"rpi_backupserver/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 10) \u2013 pr\u00e1ctico 4 - Servidor copias de Seguridad","text":""},{"location":"rpi_backupserver/#servidor-de-copias-de-seguridad","title":"Servidor de Copias de Seguridad","text":"<p>Si, ya s\u00e9 que con nuestros MACs tenemos la estupenda utilidad de Time Machine, que funciona a las mil maravillas, e incluso si queremos tenemos tambi\u00e9n SuperDuper que es un muy buen complemento para nuestras copias en Time Machine.</p> <p>Pero esto que os voy a contar seguramente interese a m\u00e1s de uno, y es que cuando por ejemplo acabas a las mil de editar un podcast, de retocar fotos o de editar video, y quieres hacer copia de seguridad de esas carpetas\u2026 seguramente que incluso esas carpetas no las tengas en copia de seguridad de Time Machine por que son grandes y tardan mucho en hacerse copia, te llenan el disco de TM en poco.. as\u00ed que te toca esperarte a la copia en otro HD \u00f3 Pendrive termine para poder irte a dormir tranquilo.</p> <p>Pues bien, vamos a ver un par de maneras de hacer copia de seguridad SOBRE nuestra RPi de una parte en concreto de nuestro dispositivos OSX.</p> <p>Incluso se dice que si tienes un dispositivo iOS con JailBreak tambi\u00e9n es posible hacer copia de seguridad de ellos, pero esto es algo que no puedo contar pues no tengo JailBreak en ninguno de mis dispositivos.</p>"},{"location":"rpi_backupserver/#servidor-ftp","title":"Servidor FTP","text":"<p>El protocolo de transferencia de datos FTP\u00a0 nos permite, mediante una infraestructura de cliente/servidor, realizar la transferencia de datos en ambas direcciones de una manera bastante r\u00e1pida, tanto es as\u00ed que el protocolo est\u00e1 optimizado para que sea r\u00e1pido, pero no para que sea seguro, b\u00e1sicamente porqu\u00e9 la informaci\u00f3n viaja en claro, no est\u00e1 cifrada.</p> <p>Para mejorar esto, es decir, renunciar a parte de esa velocidad pero ganar mucho en seguridad tenemos la transmisi\u00f3n SFTP , que es algo as\u00ed como montar un FTP pero sobre una capa de cifrado SSL (Secure Socket Layer).</p> <p>En el caso de las Rpi con ARCH, al estar SSH habilitado por defecto tambi\u00e9n tenemos acceso al subsistema de sftpserver, de manera que es el propio demonio de SSH (sshd) quien invoca al servidor de ftp seguro cuando as\u00ed el cliente lo solicita.</p> <p>Y como en nuestra conexi\u00f3n, en el apartado de securizaci\u00f3n hemos, por un lado eliminado el acceso directo con el usuario root, y por otro activado la autenticaci\u00f3n en dos pasos para el usuario operador, pues aqu\u00ed nos pasar\u00e1 lo mismo, si abrimos una conexi\u00f3n sftp a nuestra m\u00e1quina veremos como con el usuario root es imposible que obtengamos una sesi\u00f3n, y que cuando la abrimos con el usuario operador nos solicita lo primero el c\u00f3digo de verificaci\u00f3n de la autenticaci\u00f3n en dos pasos y luego la contrase\u00f1a del usuario.</p> <p>As\u00ed pues, para esto no tenemos que hacer nada, tan s\u00f3lo saber que tenemos este tipo de conexi\u00f3n disponible y que podemos pasar, tanto de ida como de vuelta, documentos y ficheros de todo tipo, eso s\u00ed, siempre bas\u00e1ndonos en el perfilado del usuario con el que nos conectamos.</p> <p>Podemos incluso utilizar un cliente de FTP para que nos haga el entorno m\u00e1s amigable a la par de gr\u00e1fico, por ejemplo podemos emplear Filezilla , configurando la conexi\u00f3n como del tipo SFTP - SSH File Transfer Protocol y el modo de acceso Interactivo, para que veamos el mensaje del sistema en el que se nos solicita el c\u00f3digo de verificaci\u00f3n en dos pasos que implementamos.</p> <p>Esto lo comento aunque no es el recurso de copia de seguridad que vamos a emplear para este fin, es \u201cotra\u201d forma m\u00e1s de poder pasar contenidos a nuestra m\u00e1quina de backup.</p>"},{"location":"rpi_backupserver/#servidor-rsync","title":"Servidor RSYNC","text":"<p>Sobre Rsync ya hablamos en el cap\u00edtulo de copias de seguridad, y ahora vamos a ampliar la informaci\u00f3n por que este software tambi\u00e9n podemos explotarlo como parte servidor, esto es, activarlo de manera que otros equipos act\u00faen como clientes y puedan hacer copia sobre nuestra RPI.</p> <p>Para eso tan s\u00f3lo tenemos que configurarlo adecuadamente y ejecutarlo de manera que se quede funcionando en la m\u00e1quina en modo \u201cdemonio\u201d.</p> <p>La configuraci\u00f3n es sencilla, en primer lugar tenemos el fichero de configuraci\u00f3n <code>/etc/rsyncd.conf</code></p> <p>Aqu\u00ed un ejemplo a usar:</p> <p>uid = nobody gid = nobody use chroot = no max connections = 4 syslog facility = local5 pid file = /run/rsyncd.pid</p> <p>Ahora vamos a poner a correr rsync en modo demonio y a probar a grabar desde nuestro equipo Mac</p> <p>[root@Jarvis ~]# systemctl start rsyncd</p> <p>En caso de que lo queramos dejar corriendo siempre que se inicie el sistema operativo de la m\u00e1quina, este es el comando:</p> <p>[root@Jarvis ~]# systemctl enable rsyncd</p> <p>Y la l\u00ednea por ejemplo para copiar un directorio sobre el home del usuario operador (el \u00fanico que puede conectar y autenticar por SSH) ser\u00eda:</p> <p>Hal9000:~ $ rsync --progress -avhe ssh /Users/admin/Documents/Vehiculos/Octavia/Manuales/ operador@192.168.1.20:CopiaRemota/</p> <p>Verification code: Password: building file list ... 3 files to consider created directory CopiaRemota ./ A5_Octavia_OwnersManual.pdf 4.05M 100% 6.34MB/s 0:00:00 (xfer#1, to-check=1/3) A5_Octavia_Swing_CarRadio.pdf 671.79K 100% 831.48kB/s 0:00:00 (xfer#2, to-check=0/3) sent 4.72M bytes received 70 bytes 219.53K bytes/sec total size is 4.72M speedup is 1.00</p> <p>Como vemos la conexi\u00f3n a Rsync se hace sobre SSH, es una copia por tanto segura, es m\u00e1s, se nos est\u00e1 pidiendo autenticaci\u00f3n en dos pasos y la copia se deja bajo el usuario operador:</p> <p>[root@Jarvis CopiaRemota]# pwd /home/operador/CopiaRemota [root@Jarvis CopiaRemota]# ls -l</p> <p>total 4616 -rwxrwxrwx 1 operador operadores 4047332 ene 25 2012 A5_Octavia_OwnersManual.pdf -rwxrwxrwx 1 operador operadores 671786 ene 25 2012 A5_Octavia_Swing_CarRadio.pdf</p> <p>Bien, como hab\u00edamos pensado hacer ese proceso que nos haga copia de una serie de carpetas de nuestro OSX sobre la Rpi, y luego nos apague la m\u00e1quina OSX, pues no podemos estar pendientes para poder introducir el famoso c\u00f3digo de autenticaci\u00f3n en dos pasos ni la contrase\u00f1a del usuario, vamos a hacer lo que se llama una conexi\u00f3n transparente mediante generando para esto nuestra huella RSA propia.</p> <p>En nuestro equipo OSX, abrimos un terminal y nos vamos a nuestro home de usuario (recordar, la virgulilla), y dentro del home al directorio .ssh</p> <p>cd ~/.ssh ssh-keygen -t rsa</p> <p>Generating public/private rsa key pair. Enter file in which to save the key (/Users/admin/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /Users/admin/.ssh/id_rsa. Your public key has been saved in /Users/admin/.ssh/id_rsa.pub.</p> <p>The key fingerprint is: f4:86:f3:50:3b:13:e9:e2:bf:2b:02:0e:a6:b8:3e:f3 admin@Hal9000.local</p> <p>The key's randomart image is: +--[ RSA 2048]----+ |                 | | .               | | . +             | | . = o           | | S B             | | o . . * o       | |.o o . . .       | |oo . . ..        | |oo+E . .+o       | +-----------------+</p> <p>Respondemos a todas las preguntas que nos hace este comando con INTRO.</p> <p>Ahora tenemos que copiar el fichero id_rsa.pub que hemos generado en nuestro OSX a la m\u00e1quina RPI, y debe quedar en el directorio /home/operador/.ssh, se debe llamar authorized_keys y los permisos del directorio y del fichero deben excluir a grupo y otros por que de lo contrario todo esto se desactiva por temas relativos a la seguridad.</p> <p>Para esta copia, podemos usar este comando en nuestro terminal OSX:</p> <p>Hal9000:.ssh admin$ scp id_rsa.pub operador@192.168.1.20:id_rsa.pub</p> <p>Verification code: Password: id_rsa.pub</p> <p>Como vemos es una copia con SSL, autenticaci\u00f3n en dos pasos, clave, etc.</p> <p>El fichero se ha quedado en el home del usuario operador en la PI, as\u00ed que estos son los siguientes pasos a dar:</p> <p>[operador@Jarvis ~]$ mkdir -p .ssh [operador@Jarvis ~]$ mv ./id_rsa.pub ./.ssh/authorized_keys [operador@Jarvis ~]$ chmod go-w . .ssh .ssh/authorized_keys</p> <p>Que pasa a partir de este punto, pues que las conexiones por SSH entre ese equipo que ha generado su clave RSA y se la ha enviado a nuestra RPI, y la RPI ya no precisan de usuario/clave ni c\u00f3digo de verificaci\u00f3n en dos pasos.</p> <p>Y ahora, por ejemplo, si repetimos en nuestro OSX el comando de copia rsync sobre la RPi ya no nos pide nada y lo podemos ejecutar en modo desatendido:</p> <p>Hal9000: ~$ rsync --progress -avhe ssh /Users/admin/Documents/Vehiculos/Octavia/Manuales/ operador@192.168.1.20:CopiaRemota/ building file list ... 3 files to consider</p> <p>sent 161 bytes received 20 bytes 362.00 bytes/sec total size is 4.72M speedup is 26072.48</p>"},{"location":"rpi_backupserver/#script-de-copia-y-apagado-del-mac","title":"Script de copia y apagado del MAC","text":"<p>Y ahora, juntando todas estas piezas que hemos ido viendo podremos implementar lo siguiente, nuestra idea inicial, poder pulsar un \u201cbot\u00f3n\u201d y que se haga copia de lo que quiero y luego se apague el equipo.</p> <p>Para esto, necesitamos hacer una simple tarea en nuestro OSx con Automator.</p> <p>Se trata de abrir automator y crear un nuevo flujo de trabajo.</p> <p>En primer lugar, el flujo ejecutar\u00e1 una secuencia de Shell Scrip, en esta secuencia es donde pegamos nuestra l\u00ednea de Rsync con la que hac\u00edamos copia de la carpeta.</p> <p>El siguiente elemento de ese flujo es la ejecuci\u00f3n de un script hecho en AppleScript, este ejecuta el comando tell application \"Finder\" to shut down.</p> <p>Y listo, ahora guardamos este flujo de Automator como aplicaci\u00f3n y la grabamos donde queramos, en al carpeta de aplicaciones, en nuestra carpeta personal, da igual, cuando ejecutemos nos har\u00e1 en primer lugar la copia por rsync y al finalizar apaga el equipo al completo.</p>"},{"location":"rpi_domotica/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 11) \u2013 pr\u00e1ctico 5 - Dom\u00f3tica","text":""},{"location":"rpi_domotica/#pequena-central-domotica","title":"Peque\u00f1a central dom\u00f3tica","text":"<p>Aunque la m\u00e1quina por hardware es peque\u00f1a, no lo es m\u00e1s que otras centralitas de dom\u00f3tica que actualmente se encuentran en el mercado.</p> <p>Por ejemplo una Vera Lite del fabricante Mi Casa Verde apenas tiene 100 Mb de memoria y est\u00e1 basada es una placa que m\u00e1s que un \u201cordenador\u201d es un router al que se le han a\u00f1adido algunas funcionalidad m\u00e1s, de hecho el fabricante anuncia como que corre con Linux 2.6 (el \u00faltimo kernel 2.6 que se lanz\u00f3 es de octubre de 2010\u2026 muy al d\u00eda tampoco est\u00e1n).</p> <p>En el caso de los Home Center de Fibaro, el modelo Lite est\u00e1 basado al igual que nuestras Rpi en arquitectural ARM, en concreto un Cortext A8, que es un procesador ligeramente superior al que incorporan las Rpi.</p> <p>Con las RPI tambi\u00e9n tenemos que tener en cuenta las posibilidades de ampliaci\u00f3n a trav\u00e9s del puerto GPIO, y la expansi\u00f3n hacia sistemas bien consolidados como son los Arduinos.</p> <p>En este sentido, en la \u201cdomotizaci\u00f3n\u201d de los elementos de la vida cotidiana, como puede por ejemplo un simple acuario, Arduido barre, haced la prueba y buscar en google acuario + arduino y ya ver\u00e9is lo que sale, aut\u00e9nticos sistemas dom\u00f3ticos para el control hasta del m\u00e1s m\u00ednimo detalle del sistema.</p> <p>Estos sistemas basados en Arduino est\u00e1n empezando a pasarse a Raspberry, dejando la \u201cl\u00f3gica\u201d del proceso en manos de la RPI y el trabajo m\u00e1s \u201cmec\u00e1nico\u201d o \u201cel\u00e9ctrico\u201d en manos de las placas Arduino.</p> <p>En este sentido tenemos una placa, que se incorpora a nuestra Rpi en el puerto GPIO llamada RaZberry.</p> <p>Esta placa en su \u00faltima versi\u00f3n de software, la 1.5 permite incluso la ejecuci\u00f3n de c\u00f3digo Java a trav\u00e9s de sus APIs para la gesti\u00f3n de la red y componentes Z-wave que tengamos establecida.</p> <p>Pero primero, antes de ir a esto que es algo m\u00e1s complejo, vamos a probar con cosas m\u00e1s sencillas</p>"},{"location":"rpi_domotica/#gestion-de-camaras-ip","title":"Gesti\u00f3n de c\u00e1maras IP","text":"<p>Podemos gestionar una o varias c\u00e1maras IP que tengamos en nuestra red mediante el uso de llamadas http.</p> <p>Los c\u00f3digos Http a emplear, por lo menos en el caso de las c\u00e1maras Foscam, es relativamente est\u00e1ndar, los c\u00f3digos los vais a encontrar en el documento que os adjunto a este mensaje.</p> <p>Vamos a hacer un peque\u00f1o script que nos maneje una o varias c\u00e1maras, nos modifique el punto o preset en el que la c\u00e1mara est\u00e1 situado, tome una instant\u00e1nea de ese punto, vuelva al origen y nos mande todas esas fotos a nuestro correo electr\u00f3nico.</p> <p>Esto no es por capricho, a mi me surg\u00eda la necesidad de poder saber si mi c\u00e1mara estaba operativa en casa, si estaba bien enfocada donde le hab\u00eda dicho, y como estaba el resto de la sala, no pod\u00eda cada X tiempo andar entrado en aplicaciones como CamViewer para mirar con el consumo de datos tan grande que tiene esa aplicaci\u00f3n.</p> <p>As\u00ed que me implement\u00e9 este proceso. Creo que a trav\u00e9s de un NAS y la Surveillance Station se puede hacer algo similar, pero en cuanto que hay m\u00e1s de una c\u00e1mara hay que andar pagando licencias, en este caso es gratis\u2026</p> <p>Lo primero, para poder recibir correos electr\u00f3nicos en nuestro m\u00f3vil por ejemplo, es instalar Mutt , que es un cliente de correo, que nos permite en modo texto \u00f3 l\u00ednea de comandos enviar correos interactuando con el smtp, incluso con documentos adjuntos.</p> <p>[root@Jarvis ~]# pacman -S mutt</p> <p>resolviendo dependencias... verificando conflictos... Paquetes (2): mime-types-9-1 mutt-1.5.23-1 Tama\u00f1o Total de Descarga: 1,15 MiB Tama\u00f1o Total Instalado: 6,40 MiB :: \u00bfContinuar con la instalaci\u00f3n? [S/n] S :: Recuperando paquetes ... mime-types-9-1-any 14,6 KiB 176K/s 00:00        [######################################################] 100% mutt-1.5.23-1-armv6h 1166,8 KiB 1321K/s 00:01   [######################################################] 100% (2/2) verificando llaves en el llavero          [######################################################] 100% (2/2) verificando la integridad de los paquetes [######################################################] 100% (2/2) cargando los archivos del paquete...      [######################################################] 100% (2/2) verificando conflictos entre archivos     [######################################################] 100% (2/2) verificando el espacio disponible en disco[######################################################] 100% (1/2) instalando mime-types                     [######################################################] 100% (2/2) instalando mutt                           [######################################################] 100% ==&gt; For GPG support, add the following to your muttrc: ==&gt; source /etc/Muttrc.gpg.dist</p> <p>Dependencias opcionales para mutt smtp-forwarder: to send mail</p> <p>Ahora vamos a configurarlo, la configuraci\u00f3n se hace a nivel de usuario, y b\u00e1sicamente lo que vamos a configurar es el uso de un servicio smtp, y nada m\u00e1s.</p> <p>Si tenemos una cuenta de correo en Gmail por ejemplo, de las que usan autenticaci\u00f3n en dos pasos recordad que la contrase\u00f1a del servicio smtp debemos generarla para poder usarla, ya que de otra manera nada de nada, nos dar\u00e1 error de conexi\u00f3n todo el tiempo.</p> <p>As\u00ed pues, para configurar editamos el fichero <code>~/.muttrc</code></p> <p>[root@Jarvis ~]# vi .muttrc set from = \"antonio.hernan@gmail.com\" set realname = \"Antonio J. Hernan\" set imap_user = \"antonio.hernan@gmail.com\" set imap_pass = \"mcabbahyqm\" set folder = \"imaps://imap.gmail.com:993\" set spoolfile = \"+INBOX\" set postponed =\"+[Gmail]/Drafts\" set header_cache =~/.mutt/cache/headers set message_cachedir =~/.mutt/cache/bodies set certificate_file =~/.mutt/certificates set smtp_url = \"smtp://antonio.hernan@smtp.gmail.com:587/\" set smtp_pass = \"mcadahyqm\" set move = no set imap_keepalive = 900</p> <p>Si ejecutamos el comando:</p> <p>[root@Jarvis ~]# mutt -s \"Prueba Jarvis\u201d antonio.hernan@gmail.com</p> <p>Entramos en el \u201ccliente en modo texto\u201d de env\u00edo de mail, y el resultado final es que nos llegar\u00e1 un mail a nuestra cuenta.</p> <p>Bien pues ahora que podemos enviar correos f\u00e1cilmente por la l\u00ednea de comandos, vamos con el script de vigilancia, que como ver\u00e9is es muy sencillo pero que podemos ir complicando todo lo que queremos seg\u00fan vayamos incorporando nuevas c\u00e1maras o queramos establecer m\u00e1s puntos de control sobre las c\u00e1maras actuales.</p> <p>[root@Jarvis ~]# cat patrol.sh</p>"},{"location":"rpi_domotica/#usrbinbash","title":"!/usr/bin/bash","text":""},{"location":"rpi_domotica/#mandamos-a-preset-1-esperamos-y-tomamos-imagen","title":"Mandamos a Preset 1, esperamos y tomamos imagen.","text":"<p>wget -O - http://192.168.1.27:6159/decoder_control.cgi?command=31\\&amp;user=operador\\&amp;pwd=CLAVE sleep 10 wget -O /root/preset1.jpg http://192.168.1.27:6159/snapshot.cgi?resolution=32\\&amp;user=operador\\&amp;pwd=CLAVE</p>"},{"location":"rpi_domotica/#mandamos-a-preset-2-esperamos-y-tomamos-imagen","title":"Mandamos a Preset 2, esperamos y tomamos imagen.","text":"<p>wget -O - http://192.168.1.27:6159/decoder_control.cgi?command=33\\&amp;user=operador\\&amp;pwd=CLAVE sleep 10 wget -O /root/preset2.jpg http://192.168.1.27:6159/snapshot.cgi?resolution=32\\&amp;user=operador\\&amp;pwd=CLAVE</p>"},{"location":"rpi_domotica/#mandamos-a-preset-3-esperamos-y-tomamos-imagen","title":"Mandamos a Preset 3, esperamos y tomamos imagen.","text":"<p>wget -O - http://192.168.1.27:6159/decoder_control.cgi?command=35\\&amp;user=operador\\&amp;pwd=CLAVE sleep 10 wget -O /root/preset3.jpg http://192.168.1.27:6159/snapshot.cgi?resolution=32\\&amp;user=operador\\&amp;pwd=CLAVE</p>"},{"location":"rpi_domotica/#mandamos-a-preset-1-sin-esperar","title":"Mandamos a Preset 1, sin esperar","text":"<p>wget -O - http://192.168.1.27:6159/decoder_control.cgi?command=31\\&amp;user=operador\\&amp;pwd=CLAVE</p>"},{"location":"rpi_domotica/#componemos-el-envio-de-correo-con-las-imagenes-tomadas","title":"Componemos el envio de correo con las imagenes tomadas","text":"<p>echo \"Envio Camara Foscam\" &gt; /root/patrol.txt echo \"Fecha: \" `date '+%d/%m/%Y %H:%M:%S'` &gt;&gt; /root/patrol.txt echo \"\" &gt;&gt; /root/patrol.txt mutt -s \"Foscam\" antonio.hernan@gmail.com &lt; /root/patrol.txt -a /root/preset.jpg rm -f /root/patrol.txt &gt; /dev/null 2&gt;&amp;1 rm -f /root/preset.jpg &gt; /dev/null 2&gt;&amp;1</p> <p>Y ahora tan s\u00f3lo nos falta dar permisos de ejecuci\u00f3n a dicho script</p> <p>[root@Jarvis ~]# chmod 700 patrol.sh</p> <p>Y si queremos que se ejecute siguiendo alguna condici\u00f3n de hora, programarlo con el correspondiente crontab -e.</p> <p>Como veis es muy sencillo, el comando 31 lleva al preset 1, el 33 al preset 2, el 35 al preset 3, etc.</p> <p>Todo est\u00e1 explicado en el manual que os adjunto.</p> <p>Hay mucho m\u00e1s comandos que se pueden emplear, como los que activa y desactiva en sensor de movimiento, el sensor de voz, la luz infrarroja, la grabaci\u00f3n sobre ftp y un largo etc, esto que os he puesto tan s\u00f3lo es un esqueleto b\u00e1sico.</p>"},{"location":"rpi_domotica/#razberry-y-modulos-z-wave","title":"RaZberry y m\u00f3dulos Z-Wave","text":"<p>RaZberry es una placa hija para conectar en nuestras RaspBerryPI, en su puerto GPIO.</p> <p>Una vez conectado y configurados nos permite crear nuestra red mallada con nuestros dispositivos Z-Wave.</p> <p></p> <p>Una vez que tengamos funcionando nuestra Rpi+RaZberry podremos establecer comunicaci\u00f3n con los m\u00f3dulos a trav\u00e9s de sus APIs y Cgis, de manera que ser\u00e1 muy similar a lo que hemos visto hace un momento con la c\u00e1mara IP, o podremos instalar algunos de los productos que hoy en d\u00eda est\u00e1n en desarrollo para tener una central de dom\u00f3tica algo m\u00e1s completa, como son Z-Way y todo lo que se est\u00e1 moviendo a trav\u00e9s de OpenRemote.</p> <p>Para poder en marcha esta RazBerry, por desgracia nuestra, todo lo que el fabricante ha puesto a disposici\u00f3n de su p\u00fablico est\u00e1 basado en Debian, por tanto si no tenemos una RaspBerryPi que corra con raspbmc, raspbian y openelec no podremos usar los instaladores que nos da el fabricante y tendremos que hacerlo mediante este m\u00e9todo que os cuento a continuaci\u00f3n.</p> <p>1.- Crear los directorios donde vamos a instalar y el fichero de testigo de la versi\u00f3n</p> <p>[root@Jarvis ~]# mkdir -p /opt/z-way-server [root@Jarvis ~]# mkdir -p /etc/z-way [root@Jarvis ~]# echo \"v1.5.0\" &gt; /etc/z-way/VERSION</p> <p>2.- Instalamos las librer\u00edas de Yajl (otro gestor m\u00e1s Json, vamos intercambio de datos entre procesos basados en ficheros\u2026)</p> <p>[root@Jarvis ~]# pacman -S yajl</p> <p>resolviendo dependencias... verificando conflictos... Paquetes (1): yajl-2.0.4-2 Tama\u00f1o Total de Descarga: 0,03 MiB Tama\u00f1o Total Instalado: 0,18 MiB :: \u00bfContinuar con la instalaci\u00f3n? [S/n] S :: Recuperando paquetes ... yajl-2.0.4-2-armv6h 30,6 KiB 205K/s 00:00        [######################################################] 100% (1/1) verificando llaves en el llavero           [######################################################] 100% (1/1) verificando la integridad de los paquetes  [######################################################] 100% (1/1) cargando los archivos del paquete...       [######################################################] 100% (1/1) verificando conflictos entre archivos      [######################################################] 100% (1/1) verificando el espacio disponible en disco [######################################################] 100% (1/1) instalando yajl                            [######################################################] 100%</p> <p>3.- Descargamos los drivers y programas para RaZberry/ZWay</p> <p>[root@Jarvis ~]# cd ~Descargas [root@Jarvis Descargas]# wget http://razberry.z-wave.me/z-way-server-RaspberryPiXTools-v1.5.0.tgz --2014-03-30 18:24:25-- http://razberry.z-wave.me/z-way-server-RaspberryPiXTools-v1.5.0.tgz Resolviendo razberry.z-wave.me (razberry.z-wave.me)... 46.20.244.36 Conectando con razberry.z-wave.me (razberry.z-wave.me)[46.20.244.36]:80... conectado. Petici\u00f3n HTTP enviada, esperando respuesta... 200 OK Longitud: 8552999 (8,2M) [application/x-gzip] Grabando a: \u201cz-way-server-RaspberryPiXTools-v1.5.0.tgz\u201d 100%[=================================================================================================================&gt;] 8.552.999 2,63MB/s en 3,1s 2014-03-30 18:24:28 (2,63 MB/s) - \u201cz-way-server-RaspberryPiXTools-v1.5.0.tgz\u201d guardado [8552999/8552999]</p> <p>4.- Descompresi\u00f3n de los ficheros</p> <p>[root@Jarvis Descargas]# cd /opt [root@Jarvis opt]# tar -xvzf ~/Descargas/z-way-server-RaspberryPiXTools-v1.5.0.tgz</p> <p>5.- Ahora vamos a \u201cenga\u00f1ar\u201d a Z-Way por que espera una versi\u00f3n un tanto antiguo de una librer\u00eda y le vamos a enga\u00f1ar con la nueva\u2026</p> <p>[root@Jarvis ~]# cd /usr/lib [root@Jarvis lib]# ln -s /usr/lib/libarchive.so.13.1.2 /usr/lib/libarchive.so.12</p> <p>Con esto, omitimos el error que nos dar\u00eda en el arranque, algo as\u00ed como:</p> <p>/opt/z-way-server/z-way-server: error while loading shared libraries: libarchive.so.12: cannot open shared object file: No such file or directory</p> <p>6.- Eliminamos la carga de ttyAMA0</p> <p>Debemos editar el fichero de arranque del sistema /boot/cmdline.txt, importante tener prevista una copia de seguridad por si lo hacemos mal, el sistema es posible que no arranque.</p> <p>Lo que vamos a hacer es evitar que el sistema operativo trate de hacer uso de la UART, esto es, trate de activar para su uso propio el puerto GPIO, aqu\u00ed os cuentan con m\u00e1s detalle lo que es esto.</p> <p>Tenemos que eliminar de este fichero el texto que dice:</p> <p>console=ttyAMA0,115200 kgdboc=ttyAMA0,115200</p> <p>El fichero quedar\u00eda tal que as\u00ed una vez modificado:</p> <p>[operador@Jarvis boot]$ cat cmdline.txt ipv6.disable=1 avoid_safe_mode=1 selinux=0 plymouth.enable=0 smsc95xx.turbo_mode=N dwc_otg.lpm_enable=0 console=tty1 root=/dev/mmcblk0p5 rootfstype=ext4 elevator=noop rootwait</p> <p>[operador@Jarvis boot]$</p> <p>7.- Preparamos el proceso de arranque y parada de ZWay.</p> <p>Como est\u00e1 pensado para distribuciones Debian, los scripts de arranque y parada de todo esto est\u00e1n bajo el init de SystemV, deber\u00edamos transformar esto para que puedan operar bajo SystemD que es lo que emplea ArchLinux.</p> <p>En primer lugar modificamos el proceso de arranque/parada manual, de manera que desde el home del usuario root podamos arrancar y parar el proceso a petici\u00f3n:</p> <p>Editamos el fichero (nuevo) /root/Z-Way</p> <p>[root@Jarvis ~]# vi ~/Z-Way</p>"},{"location":"rpi_domotica/#binsh","title":"!/bin/sh","text":"<p>PATH=/bin:/usr/bin:/sbin:/usr/sbin NAME=z-way-server DAEMON_PATH=/opt/z-way-server PIDFILE=/run/$NAME.pid LOGFILE=/var/log/$NAME.log</p>"},{"location":"rpi_domotica/#adding-z-way-libs-to-library-path","title":"adding z-way libs to library path","text":"<p>export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/z-way-server/libs case \"$1\" in  start)   echo -n \"Starting Z-Way: \"   cd $DAEMON_PATH   nohup $DAEMON_PATH/z-way-server &amp; &gt; /dev/null 2&gt;&amp;1   echo \"done.\"   cd ~   ps -e | grep 'z-way-server' | awk '{print $1}' &gt; $PIDFILE   ;;  stop)   echo -n \"Stopping Z-Way: \"   kill -9 `cat $PIDFILE`   rm $PIDFILE   echo \"done.\"   ;;  *)   echo \"Usage: ~/Z-Way {start|stop}\"   exit 1   ;; esac exit 0</p> <p>Ahora vamos a crearnos una unidad para carga en SystemD que simular\u00e1 lo que hace un tiempo ten\u00edamos como los rc.local, que era un script donde el usuario pod\u00eda libremente meter todo lo que quisiese que se ejecutase al finalizar el arranque de la m\u00e1quina.</p> <p>Esto nos pude venir muy bien para otras cosas\u2026 ;)</p> <p>Editamos el fichero <code>/usr/lib/systemd/system/rc-local.service</code>\u00a0y le ponemos este contenido:</p> <p>[root@Jarvis ~]# vi /usr/lib/systemd/system/rc-local.service</p> <p>[Unit] Description=/etc/rc.local Compatibility After=syslog.target network.target</p> <p>[Service] Type=forking ExecStart=/etc/rc.local start ExecStop=/etc/rc.local stop</p> <p>[Install] WantedBy=multi-user.target</p> <p>Creamos el fichero <code>/etc/rc.local</code>\u00a0, para poner la ejecuci\u00f3n del arranque de Z-Way</p> <p>[root@Jarvis ~]# vi /etc/rc.local</p>"},{"location":"rpi_domotica/#usrbinbash_1","title":"!/usr/bin/bash","text":"<p>/root/Z-Way $1 &gt;&gt; /var/log/local.log 2&gt;&amp;1</p> <p>Y damos permisos de ejecuci\u00f3n a los scripts creados, as\u00ed como habilitar el arranque del servicio rc.local.</p> <p>[root@Jarvis ~]# chmod a+x /etc/rc.local [root@Jarvis ~]# chmod a+x /usr/lib/systemd/system/rc-local.service [root@Jarvis ~]# systemctl enable rc-local ln -s '/usr/lib/systemd/system/rc-local.service' '/etc/systemd/system/multi-user.target.wants/rc-local.service'</p> <p>Y si reincidamos el equipo veremos como Z-Way se carga al arrancar a trav\u00e9s de estos scripts, tenemos acceso al servidor web, tenemos en /var/log los ficheros de lo correspondientes, etc.</p>"},{"location":"rpi_domotica/#jugando-un-poco-con-z-wave","title":"Jugando un poco con Z-Wave","text":"<p>*Nota del 2020... las capturas de im\u00e1genes ya no est\u00e1n disponibles</p> <p>Si, digo jugando por que no me ha dado tiempo a hacer mucho m\u00e1s.</p> <p>Tan s\u00f3lo tengo un m\u00f3dulo prestado, un Wall Plug de Fibaro con el que he podido hacer alguna prueba y ver hasta donde podemos llegar.</p> <p>Una vez iniciado el sistema podemos entrar en la URL de administraci\u00f3n de ese Z-Way (http://192.168.1.20:8083/expert).</p> <p>Aqu\u00ed veremos que tenemos un dispositivo funcionando, es nuestra RazBerry, y yendo a la pesta\u00f1a de red, y aqu\u00ed en el elemento administraci\u00f3n de red podemos incluir nuevos m\u00f3dulos.</p> <p>Yo como os dec\u00eda he probado con un Wall Plug de Fibaro, y no conectaba ni a tiros, y parece ser que todo es por lo mismo\u2026 el m\u00f3dulo estaba dado de alta en otra red y hasta que no lo resetee al completo no enlaz\u00f3 (en el caso de este m\u00f3dulo, pulsar el bot\u00f3n de enlace hasta que el anillo de color cambia a amarillo, soltar el bot\u00f3n y hacer un click r\u00e1pido, el anillo se pone rojo y ya est\u00e1, como sali\u00f3 de f\u00e1brica).</p> <p>Una vez respetado, el enlace es casi instant\u00e1neo y se ve que se detecta perfectamente.</p> <p>(http://i58.tinypic.com/16bwun7.png)</p> <p>Este m\u00f3dulo lo podemos usar como Switch (enciede/apaga) y como Sensor/Medidor (consumo).</p> <p>As\u00ed que si entramos a las opciones de dispositivo tipo Interruptor vemos esto:</p> <p>(http://i62.tinypic.com/2wd0wfs.png)</p> <p>Y si entramos a las opciones de dispositivo tipo medidores veremos el resto de la informaci\u00f3n que nos aporta:</p> <p>(http://i60.tinypic.com/2s6rn0l.png)</p> <p>Para los que est\u00e9n acostumbrados o hayan visto la interfaz de usuario de otros productos como los de Vera Lite, o los nuevos Home Center de Fibaro\u2026 pues este \u201cUI\u201d es una casta\u00f1a de mucho cuidado, pero quiz\u00e1s podamos enfocar todo esto desde otro punto de vista, como hemos hecho con las c\u00e1maras y pensar en montar nuestro propio sistema dom\u00f3tico en \u201cscracth\u201d, tirando nosotros el c\u00f3digo por que al fin y al cabo no es m\u00e1s que una API a la que le puedes hacer peticiones seg\u00fan el tipo de m\u00f3dulo, y esperar respuesta de esas peticiones (igual que hacemos con las c\u00e1maras).</p> <p>Aqu\u00ed (http://docs.zwayhomeautomation.apiary.io) encontrar\u00e9is ejemplos de esa API por si alguien se anima.</p> <p>Yo no descarto controlar las dos o tres cosas que inicialmente pienso domotizar con un sistema como este, y luego ya veremos si doy el salto a una centralita m\u00e1s potente, que parece que es el camino a seguir.</p>"},{"location":"rpi_downmanager/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 8) \u2013 pr\u00e1ctico 2 - Gestor de Descargas","text":""},{"location":"rpi_downmanager/#gestor-de-descargas","title":"Gestor de descargas","text":"<p>No debemos perder de vista que el gasto energ\u00e9tico de estas m\u00e1quinas es m\u00ednimo, se puede situar en casi todos los casos por debajo de los 5W.</p> <p>Esto lo hace que sean ideales para tener como m\u00e1quinas que est\u00e9n permanentemente conectadas a la red con el prop\u00f3sito de descargar y compartir contenidos, bien sea por redes P2P como por servicio de descarga directa.</p> <p>En cualquier caso, necesitaremos conectar a la m\u00e1quina una unidad de disco externo por los puertos USB, y este disco que se conecte no puede tener un consumo elevado pues la m\u00e1quina no podr\u00e1 con ello.</p> <p>Todo lo que sea m\u00e1s grande de un pendrive es necesario que est\u00e9 autoalimentado (con su propio adaptador de corriente) o bien que este conectado a un HUB o regleta USB que est\u00e9 a su vez autoalimentada.</p> <p>Configuraciones para la descarga y los discos hay muchas, podemos emplear los discos de un NAS para dejar all\u00ed los datos, de otra unidad remota en red, etc. pero la configuraci\u00f3n de un disco USB para este fin quiz\u00e1s sea la m\u00e1s sencilla.</p>"},{"location":"rpi_downmanager/#infraestructura-previa","title":"Infraestructura previa","text":"<p>Como he dicho necesitamos un disco externo para guardar todo lo que descarguemos, las descargas en curso, etc.</p> <p>El proceso para particionar ese disco que conectemos (que con suerte nos vendr\u00e1 de tienda con formato NTFS o HFS+) es igual que el que hemos seguido para particionar las tarjetas SD.</p> <p>Localizamos la unidad/dispositivo.</p> <p>Ejecutamos el comando <code>fdisk</code> para ese <code>/dev/sd_loquesea</code></p> <p>Y borramos las particiones que tenga para crear otra nueva, d\u00e1ndole todo el espacio disponible en el disco o bien creando varias particiones por, por ejemplo, tama\u00f1o en Gb.</p> <p>Terminado el particionamiento, como hemos visto antes, creamos el sistema de ficheros ext4 y lo montamos modificando el fichero <code>/etc/fstab</code>\u00a0.</p> <p>Como le\u00e9is he pasado un poco de puntillas por este paso inicial, pero es algo que ya llevo contadas al menos un par de veces\u2026 mirad atr\u00e1s que si no la gu\u00eda saldr\u00e1 kilom\u00e9trica.</p> <p>En mi caso, para hacer estas pruebas he seguido usando el pendrive de pasos anteriores, el que est\u00e1 montado sobre <code>/BCK</code> y <code>/srv</code>.</p> <p>Lo \u00fanico que yo creo es una estructura de directorios para tenerlo todo organizado, pero como siempre digo, esto es como yo lo hago, que no es ni la mejor ni la \u00fanica manera.</p> <pre><code>[root@Jarvis ~]# mkdir -p /srv/downloads/Torrent/Finalizadas\n[root@Jarvis ~]# mkdir -p /srv/downloads/Torrent/EnCurso\n[root@Jarvis ~]# mkdir -p /srv/downloads/Directas\n</code></pre>"},{"location":"rpi_downmanager/#descarga-p2p","title":"Descarga P2P","text":"<p>Para la gesti\u00f3n de descargas de la red Torrent (\u00bfAun existe algo en las redes Emule??) el cliente que por lo menos a mi me resulta m\u00e1s f\u00e1cil de instalar, configurar y que menos recursos consume en el sistema es Transmission.</p> <p>Adem\u00e1s, este cliente tambi\u00e9n est\u00e1 disponible en el mismo \u201cformato\u201d para nuestros Mac OSX por lo que es posible que a muchos les suene.</p> <p>Los pasos de instalaci\u00f3n son extremadamente simples, no as\u00ed la configuraci\u00f3n que tiene un punto delicado que ahora os cuento.</p> <p>Para instalar, lo de siempre, <code>pacman</code>\u00a0\u2026</p> <pre><code>[root@Jarvis srv]# pacman -S transmission-cli\nresolviendo dependencias...\nverificando conflictos...\nPaquetes (2): libevent-2.0.21-3 transmission-cli-2.82-1\nTama\u00f1o Total de Descarga: 0,66 MiB\nTama\u00f1o Total Instalado: 3,92 MiB\n:: \u00bfContinuar con la instalaci\u00f3n? [S/n] S\n:: Recuperando paquetes ...\nlibevent-2.0.21-3-armv6h 183,7 KiB 536K/s 00:00 [################] 100%\ntransmission-cli-2.82-1-armv6h 491,8 KiB 700K/s 00:01 [################] 100%\n(2/2) verificando llaves en el llavero [################] 100%\n(2/2) verificando la integridad de los paquetes [################] 100%\n(2/2) cargando los archivos del paquete... [################] 100%\n(2/2) verificando conflictos entre archivos [################] 100%\n(2/2) verificando el espacio disponible en disco [################] 100%\n(1/2) instalando libevent [################] 100%\nDependencias opcionales para libevent\npython2: to use event_rpcgen.py\n(2/2) instalando transmission-cli [################] 100%\n</code></pre> <p>Este paquete, adem\u00e1s de instalar el producto nos crea un usuario:</p> <pre><code>[root@Jarvis srv]# tail -1 /etc/passwd\ntransmission:x:169:169:Transmission BitTorrent Client:/var/lib/transmission:/bin/false\n</code></pre> <p>Nos ha creado un usuario transmission, incluso un grupo transmission y su home de usuario en <code>/var/lib/transmission</code></p> <p>Es precisamente en esa ruta donde se guarda el fichero de configuraci\u00f3n de Transmission y el que debemos modificar.</p> <p>El \u201cproblema\u201d de este fichero es que se carga en memoria cuando se arranca el cliente, y si realizamos alguna modificaci\u00f3n sobre el los cambios no se ver\u00e1n reflejados en los siguientes arranques\u2026 y esto puede mosquear un poco y volverte algo loco, haces cambios y luego no los ves ah\u00ed donde hab\u00edas tocado\u2026 XD</p> <p>Arrancamos el cliente, porqu\u00e9 hasta que no se hace el primer arranque no se genera el fichero de configuraci\u00f3n, y acto seguido lo paramos para poder modificarlo sin problemas.</p> <pre><code>[root@Jarvis srv]# systemctl start transmission\n[root@Jarvis srv]# systemctl stop transmission\n</code></pre> <p>Ahora en el home del usuario transmission (recordar nuestra amiga la virgulilla <code>~transmission</code> ) se ha generado un directorio <code>.config</code> <pre><code>[root@Jarvis srv]# cd ~transmission/.config/transmission-daemon/\n[root@Jarvis srv]# vi settings.json\n</code></pre></p> <p>Los par\u00e1metros que podemos configurar son muchos y no tienen mucha p\u00e9rdida pero os cuento m\u00e1s o menos lo que suelo modificar yo (atenci\u00f3n con las , al final de cada l\u00ednea!!):</p> <p><code>\"download-dir\": \u201c/srv/downloads/Torrent/Finalizadas\u201d,</code>\u00a0 Directorio donde se quedan los ficheros cuando se ha terminado la descarga.</p> <p><code>\"download-queue-enabled\": true,</code>\u00a0 Habilitamos la cola de descargas.</p> <p><code>\"download-queue-size\": 10,</code>\u00a0 Y el tama\u00f1o de la cola de descargas, este es el valor de las descargas simult\u00e1neas.</p> <p><code>\"incomplete-dir\": \"/Descargas/Torrent/EnCurso\",</code>\u00a0 Directorio para las descargas en curso.</p> <p><code>\"incomplete-dir-enabled\": true,</code>\u00a0 Y activaci\u00f3n para este directorio (\u00bfun poco rid\u00edculo no?).</p> <p>Como sabr\u00e9is, y si no os lo cuento yo ahora mismo, el cliente de Transmission es por web, y estos son los par\u00e1metros que yo modifico para poder tener acceso a esa web con usuario/clave</p> <p><code>\"rpc-authentication-required\": true,</code>\u00a0 L\u00f3gico, lo activamos.</p> <p><code>\"rpc-enabled\": true,</code> Y lo volvemos a activar\u2026</p> <p><code>\"rpc-password\": \"{4c5248273881de992229dca1f72c531b0129db34pRnyy6th\",</code> Es la clave de acceso, la primera vez se pone en texto en \u201cclaro\u201d entre las \u201d.</p> <p><code>\"rpc-port\": 9091,</code> Puerto de escucha del cliente web</p> <p><code>\"rpc-url\": \"/transmission/\",</code>Prefijo para componer la URL de acceso a este cliente web.</p> <p><code>\"rpc-username\": \"operador\",</code> Y el usuario con el que nos vamos a conectar.</p> <p><code>\"rpc-whitelist-enabled\": false,</code> para que no valide la lista \u201cblanca\u201d de direcciones IP desde las que podemos administrar.</p> <p>As\u00ed, con todos estos par\u00e1metros vemos por ejemplo que la url de administraci\u00f3n de ese transmission ser\u00e1 http://IP_De_Tu_Rpi:9091/transmission</p> <p>En cuando a la clave, se pone en claro la primera vez, pero cuando arranquemos luego transmission, se cifra y aparecer\u00e1 un chorro de n\u00fameros y letras.</p> <p>Y el resto de par\u00e1metros, pues si queremos esos ya podemos cambiarlos por el cliente web, por que haciendo estos cuatro cambios que os digo ya tendr\u00edais todo salvo la configuraci\u00f3n de velocidades m\u00e1xima/m\u00ednima, el scheduler para las zonas horarias en las que poder tener distinta velocidad, etc.</p> <p>Arrancamos el cliente y lo fijamos para que en los sucesivos rearranques del servidor se active. <pre><code>[root@Jarvis srv]# systemctl start transmission\n[root@Jarvis srv]# systemctl enable transmission\n</code></pre></p>"},{"location":"rpi_downmanager/#descarga-directa-megaconz","title":"Descarga directa mega.co.nz","text":"<p>Para la descarga desde servicios directos podemos emplear software como Jdownloader2, y ah\u00ed tendr\u00edamos todas las posibilidades de hostings disponibles.</p> <p>A mi, personalmente no me gusta mucho, el tema de la resoluci\u00f3n de Capchas no termina de ir bien o debes buscar alg\u00fan servicio de resoluci\u00f3n de capuchas que tambi\u00e9n te llevan un tiempo y al final terminas haci\u00e9ndolo todo a mano o buscado los enlaces en mega.co.nz que no tiene capchas, y encima da una velocidad de descarga de esc\u00e1ndalo.</p> <p>No tenemos cliente nativo de Mega para las Rpi, as\u00ed que toca buscar alguna soluci\u00f3n que ya lo haya implementado. Hay pocas por no decir que s\u00f3lo hay una megatools .</p> <p>Este software no es m\u00e1s que una capa sobre la propia Api de Mega que nos permite realizar casi todas las tareas que queramos con nuestra cuenta de Mega, aunque la funci\u00f3n que nos interesa es la de descarga de enlaces p\u00fablicos.</p> <p>Por otro lado, este software se encuentra en estos momentos \u201ccongelado\u201d por las cl\u00e1usulas relativas a la privacidad que la Api de Mega te obliga a \u201cacatar\u201d si las quieres usar.</p> <p>En cualquier caso, la parte de descargas de enlaces p\u00fablicos que es lo que vamos a usar funcionan correctamente. Este software no lo vamos a encontrar en los repositorios oficiales y por tanto esta vez no vamos a emplear pacman.</p> <p>Debemos descargar los fuentes del software y compilarlo.</p> <p>No os asust\u00e9is por que esto es de lo m\u00e1s normal y no todos los productos deben existir en formato paquete en repositorio para poder ser instalado.</p> <p>Necesitamos por tanto los fuentes del software que descargamos as\u00ed:</p> <pre><code>[root@Jarvis ~]# cd /root/Descargas\n[root@Jarvis Descargas]# wget http://megatools.megous.com/builds/megatools-1.9.91.tar.gz\n--2014-03-28 18:58:33-- http://megatools.megous.com/builds/megatools-1.9.91.tar.gz\nResolviendo megatools.megous.com (megatools.megous.com)... 77.93.202.41\nConectando con megatools.megous.com (megatools.megous.com)[77.93.202.41]:80... conectado.\nPetici\u00f3n HTTP enviada, esperando respuesta... 200 OK\nLongitud: 450518 (440K) [application/x-gzip]\nGrabando a: \u201cmegatools-1.9.91.tar.gz\u201d\n100%[=============================================&gt;] 450.518 830KB/s en 0,5s\n2014-03-28 18:58:34 (830 KB/s) - \u201cmegatools-1.9.91.tar.gz\u201d guardado [450518/450518]\n</code></pre> <p>Y los compiladores para generar el programa ejecutable, que se obtienen as\u00ed: <pre><code>[root@Jarvis Descargas]# pacman -S make gcc glib-networking curl fuse pkg-config\natenci\u00f3n: make-4.0-2 est\u00e1 actualizado -- re-instalando\natenci\u00f3n: gcc-4.8.2-7 est\u00e1 actualizado -- re-instalando\nresolviendo dependencias...\nverificando conflictos...\nPaquetes (9): gcc-4.8.2-7 make-4.0-2 gnutls-3.2.12.1-1 gsettings-desktop-schemas-3.10.1-1 libproxy-0.4.11-2\nlibtasn1-3.4-1 nettle-2.7.1-1 p11-kit-0.20.2-1 glib-networking-2.38.2-1 curl-7.35.0-1 fuse-2.9.3-2\npkg-config-0.28-1\nTama\u00f1o Total Instalado: 65,97 MiB\nTama\u00f1o neto a actualizar: 0,00 MiB\n:: \u00bfContinuar con la instalaci\u00f3n? [S/n] S\n(2/2) verificando llaves en el llavero [################] 100%\n(2/2) verificando la integridad de los paquetes [################] 100%\n(2/2) cargando los archivos del paquete... [################] 100%\n(2/2) verificando conflictos entre archivos [################] 100%\n(2/2) verificando el espacio disponible en disco [################] 100%\n(1/2) reinstalando make [################] 100%\n(2/2) reinstalando gcc [################] 100%\n\u2026\n</code></pre></p> <p>Descomprimimos los fuentes: <pre><code>[root@Jarvis Descargas]# tar -xvzf megatools-1.9.91.tar.gz\nmegatools-1.9.91/\nmegatools-1.9.91/Makefile.in\n\n\u2026\n\nmegatools-1.9.91/m4/lt~obsolete.m4\nmegatools-1.9.91/install-sh\n</code></pre></p> <p>Y ahora la secuencia de comandos de configuraci\u00f3n, compilaci\u00f3n e instalaci\u00f3n son los siguientes: <pre><code>[root@Jarvis ~]# cd ~/Descargas/megatools-1.9.91\n[root@Jarvis megatools-1.9.91]# ./configure\n[root@Jarvis megatools-1.9.91]# make\n[root@Jarvis megatools-1.9.91]# make install\n</code></pre> Llegados a este \u00faltimo punto, si no hemos encontrado errores (que aparecen en grande en la pantalla\u2026) tendremos</p> <p>en la ruta <code>/usr/local/bin</code>instalados los programas.</p> <p>Si queremos podemos eliminar la descarga de fuentes de megatools que no nos har\u00e1n falta m\u00e1s: <pre><code>[root@Jarvis megatools-1.9.91]# cd ~/Descargas\n[root@Jarvis Descargas]# rm -fr megatools-1.9.91*\n</code></pre> Ahora hacemos una prueba de descarga, necesitamos un enlace v\u00e1lido a mega.co.nz para probarlo.</p> <p>Por ejemplo este: https://mega.co.nz/#!fNQkWTDR!vXyDZ1EbBVvYzBLVCqCzUfVi2CVW-uhfmKevIxn9ZWU</p> <p>El comando que ejecutar\u00edamos es: <pre><code>[root@Jarvis Descargas]# megadl 'https://mega.co.nz/#!fNQkWTDR!vXyDZ1EbBVvYzBLVCqCzUfVi2CVW-uhfmKevIxn9ZWU'\n\nTrue Detective 1x01 [josele].avi: 2% - 15,2 MiB of 622,0 MiB\n</code></pre></p>"},{"location":"rpi_downmanager/#automatizacion-de-descargas","title":"Automatizaci\u00f3n de descargas","text":"<p>Llegados a este punto podemos descargar tanto de la red Torrent como de las descargas directas de Mega.</p> <p>Ahora queremos automatizar las descargas, para la parte Torrent lo vemos ahora despu\u00e9s.</p> <p>Para la parte de Mega la forma de automatizarlo exige un poco de programaci\u00f3n.</p> <p>Esto que os pongo a continuaci\u00f3n es un peque\u00f1o script, hecho de una manera un tanto improvisada pero que cumple con su cometido.</p> <p>Lee de un fichero los enlaces que le digamos uno a uno, los descarga y una vez que esta descarga ha finalizado los borra del fichero y sigue con el siguiente.</p> <pre><code>#!/usr/bin/perl\n# Gestion de fichero de\n# Variables de entorno\n\n$FICENTRADA=\"~/enlaces.txt\";\n$FICTMP=\"/tmp/enlaces.tmp\";\n$EXEMEGA=\"/usr/local/bin/megadl\";\n\n# Bucle de ejecucion\n# Filtrado previo\n\nsystem(\"cat ${FICENTRADA} 2&gt;/dev/null | grep '^http' &gt; ${FICTMP}; mv ${FICTMP} ${FICENTRADA} 2&gt;/dev/null\");\n@ENLACES=\\`cat ${FICENTRADA} 2&gt;/dev/null | grep '^http'\\`;\nif (@ENLACES)\n {\n  foreach(@ENLACES)\n  {\n  $ENLACE=$_; chomp($ENLACE);\n\n  # Ejecutamos la descarga y esperamos a que termine\n  @SALIDA=\\`${EXEMEGA} --no-progress '${ENLACE}' 2&gt;/dev/null\\`;\n  system(\"grep -v '${ENLACE}' ${FICENTRADA} &gt; ${FICTMP}; mv ${FICTMP} ${FICENTRADA}\");\n  }\n }\nelse\n { print \"\\\\n No existen enlaces por descargar\\\\n\"; }\n</code></pre> <p>Por supuesto que esto se puede superar, no es dif\u00edcil\u2026</p> <p>El proceso se programar para que se inicie su ejecuci\u00f3n cada X horas, s\u00f3lo algunos d\u00edas de la semana, etc. Recordar que antes os cont\u00e9 como funciona crontab y que es muy f\u00e1cil establecer un patr\u00f3n de comportamiento de un programa, es darle vueltas a como queremos que nos funcione.</p> <p>Imaginad que s\u00f3lo quer\u00e9is que est\u00e9 descargando de lunes a viernes por la noche, y que los ficheros de descarga se los hab\u00e9is dejado a \u00faltima hora del d\u00eda\u2026 No se, es un ejemplo, yo de hecho lo hago as\u00ed, se ejecuta s\u00f3lo por las noches y coge los enlaces que le he ido dejando a lo largo del d\u00eda.</p> <p>El fichero de enlaces se modifica (edit\u00e1ndolo) para a\u00f1adir nuevas Urls de nuevos ficheros a descargar.</p> <p>Y para hacerlo, desde nuestro MacOSX de una manera bastate c\u00f3moda y r\u00e1pida, sin tener que andar con terminales, usaremos la conexi\u00f3n a trav\u00e9s de SAMBA, os lo cuento un poco m\u00e1s adelante.</p>"},{"location":"rpi_downmanager/#uso-de-feeds-rss-para-gestion-de-series","title":"Uso de Feeds RSS para gesti\u00f3n de series","text":"<p>Una de las opciones de descarga m\u00e1s interesantes es la gesti\u00f3n desasistida de nuevos contenidos, en concreto de las series, no tener que preocuparnos cuando aparece un nuevo episodio, etc.</p> <p>Para esto, el montaje que tenemos hecho con trasmission es perfectamente v\u00e1lido, pero adem\u00e1s tenemos que a\u00f1adir alg\u00fan que otro componente m\u00e1s, en este caso se llama FlexGet , y por supuesto necesitaremos los correspondientes Feeds de los que obtener la informaci\u00f3n, como por ejemplo showrss.info\u00a0.</p> <p>Empezamos, paramos transmission si es que no lo hab\u00edamos hecho ya: <pre><code>[root@Jarvis ~]# systemctl stop transmission\n</code></pre> Instalamos FlexGet, recurrimos a pacmac y no os asust\u00e9is por la cantidad de dependencias que encuentra pacman por satisfacer y cosas a instalar.</p> <p>Hay una dependencia que en el listado os saldr\u00eda al final como opcional pero que aqu\u00ed va a ser necesaria, para poder comunicar con python al rpc de transmission, as\u00ed que esta a la a\u00f1adimos a mano en la l\u00ednea de comando de pacman. <pre><code>[root@Jarvis ~]# pacman -S flexget python2-transmissionrpc\nresolviendo dependencias...\nverificando conflictos...\nPaquetes (23): libyaml-0.1.5-1 python2-2.7.6-3 python2-beautifulsoup4-4.3.2-1 python2-certifi-1.0.0-1 python2-dateutil-2.1-2.1-8\npython2-feedparser-5.1.3-2 python2-html5lib-0.999-3 python2-jinja-2.7.2-1 python2-jsonschema-2.3.0-1\npython2-markupsafe-0.19-1\npython2-progressbar-2.3-4 python2-pynzb-0.1.0-2 python2-pyrss2gen-1.1-2 python2-requests-2.2.1-1\npython2-rpyc-3.2.3-1\npython2-setuptools-3.3-1 python2-six-1.6.1-1 python2-sqlalchemy-0.9.3-1 python2-tmdb3-0.6.17-1 python2-\ntvrage-0.3.0-1\npython2-yaml-3.10-3 sqlite-3.8.4.1-1 flexget-1.2.58-1\nTama\u00f1o Total de Descarga: 12,67 MiB\nTama\u00f1o Total Instalado: 82,94 MiB\n:: \u00bfContinuar con la instalaci\u00f3n? [S/n] s\n:: Recuperando paquetes ...\n</code></pre> Ahora nos vamos a registrar en la p\u00e1gina de los rss, que es algo sencillo, sin correos ni nada de por medio.</p> <p>All\u00ed pues puedes configurar si quieres un RSS para todas tus series filtrados por HD o no HD, si quieres un RSS para una serie en concreto\u2026 es darle vueltas por que no es nada complicado, tan s\u00f3lo hay que echarle unos minutillos de tiempo.</p>"},{"location":"rpi_downmanager/#vamos-a-editar-la-configuracion-de-flexget","title":"Vamos a editar la configuraci\u00f3n de FlexGet.","text":"<p>El fichero de configuraci\u00f3n es bastante cr\u00edtico, en el sentido de que cada l\u00ednea de texto que aparece en el debe estar convenientemente escrita en cuanto a posici\u00f3n de espacios se refiere.</p> <p>Ahora en cuanto ve\u00e1is un ejemplo lo ver\u00e9is m\u00e1s claro.</p> <p>Configuramos\u2026 <pre><code>[root@Jarvis ~]# mkdir ~/.flexget\n[root@Jarvis .flexget]# vi config.yml\n\ntasks:\nrss:\nrss: http://showrss.info/feeds/699.rss\nall_series: yes\nquality: 720p+\ntransmission:\nhost: 192.128.1.20\nport: 9091\nusername: 'operador'\npassword: 'operador'\nratio: -1\npath: /srv/downloads/Torrent/EnCurso/\nsort-files:\nfind:\npath: /srv/downloads/Torrent/EnCurso/\nregexp: '.*\\\\.(avi|mkv|mp4)$'\nrecursive: yes\naccept_all: yes\nseen: local\nthetvdb_lookup: yes\nall_series:\nparse_only: yes\nmove:\nto: /srv/downloads/Torrent/Finalizadas/{{ tvdb_series_name }}/\nfilename: '{{ tvdb_series_name }} - {{ series_id }} - {{ tvdb_ep_name }}{{ location | pathext }}'\n</code></pre> El fichero b\u00e1sico no tiene mucha complejidad, la URL de nuestro FEED, las claves y url de nuestro transmission, rutas donde llegan los ficheros, la conexi\u00f3n al repositorio de thetvdb para que ponga el nombre a las series y por \u00faltimo que mueva el contenido descargado a la ruta definitiva.</p> <p>Ahora s\u00f3lo nos faltan dos cosas por hacer.</p> <p>La primera es arrancar y dejar arrancando transmission: <pre><code>[root@Jarvis ~]# systemctl start transmission\n[root@Jarvis ~]# systemctl enable transmission\n</code></pre> Y automatizar flexget para que se ejecute cada cierto tiempo y mire lo que hay para descargar, lo que se est\u00e1 descargando y lo que se ha finalizado de descargar\u2026</p> <p>Y para esto lo mejor es emplear <code>crontab -e</code>\u00a0del cual ya hemos hablado.</p> <p>Una \u00faltima nota, si queremos probar si nuestra configuraci\u00f3n es correcta antes de poner todo esto en marcha: <pre><code>[root@Jarvis .flexget]# flexget --test --logfile /var/log/flexget.log execute\n2014-03-29 10:15 WARNING details sort-files Task didn't produce any entries. This is likely due to a misconfigured or non-functional input.\n2014-03-29 10:15 VERBOSE details sort-files Summary - Accepted: 0 (Rejected: 0 Undecided: 0 Failed: 0)\n2014-03-29 10:15 INFO transmission rss Trying to connect to transmission...\n2014-03-29 10:15 INFO transmission rss Successfully connected to transmission.\n2014-03-29 10:15 VERBOSE details rss Produced 14 entries.\n2014-03-29 10:15 VERBOSE task rss REJECTED: \\`True Detective 1x08 Form and Void\\` by quality plugin because hdtv h264 does not match quality requirement [&lt;Requirements(720p+)&gt;]\n2014-03-29 10:15 VERBOSE task rss REJECTED: \\`True Detective 1x07 After You've Gone\\` by quality plugin because hdtv h264 does not match quality requirement [&lt;Requirements(720p+)&gt;]\n2014-03-29 10:15 VERBOSE task rss REJECTED: \\`True Detective 1x06 Haunted Houses\\` by quality plugin because hdtv h264 does not match quality requirement [&lt;Requirements(720p+)&gt;]\n2014-03-29 10:15 VERBOSE task rss REJECTED: \\`True Detective 1x05 The Secret Fate Of All Life\\` by quality plugin because hdtv h264 does not match quality requirement [&lt;Requirements(720p+)&gt;]\n2014-03-29 10:15 VERBOSE task rss REJECTED: \\`True Detective 1x04 Who Goes There?\\` by quality plugin because hdtv h264 does not match quality requirement [&lt;Requirements(720p+)&gt;]\n2014-03-29 10:15 VERBOSE task rss REJECTED: \\`True Detective 1x03 The Locked Room\\` by quality plugin because hdtv h264 does not match quality requirement [&lt;Requirements(720p+)&gt;]\n2014-03-29 10:15 VERBOSE task rss REJECTED: \\`True Detective 1x02\\` by quality plugin because hdtv h264 does not match quality requirement [&lt;Requirements(720p+)&gt;]\n2014-03-29 10:15 VERBOSE task rss ACCEPTED: \\`True Detective 1x02 720p\\` by series plugin because choosing best available quality\n2014-03-29 10:15 VERBOSE task rss ACCEPTED: \\`True Detective 1x05 The Secret Fate Of All Life 720p\\` by series plugin because choosing best available quality\n2014-03-29 10:15 VERBOSE task rss ACCEPTED: \\`True Detective 1x07 After You've Gone 720p\\` by series plugin because choosing best available quality\n2014-03-29 10:15 VERBOSE task rss ACCEPTED: \\`True Detective 1x08 Form and Void 720p\\` by series plugin because choosing best available quality\n2014-03-29 10:15 VERBOSE task rss ACCEPTED: \\`True Detective 1x04 Who Goes There? 720p\\` by series plugin because choosing best available quality\n2014-03-29 10:15 VERBOSE task rss ACCEPTED: \\`True Detective 1x06 Haunted Houses 720p\\` by series plugin because choosing best available quality\n2014-03-29 10:15 VERBOSE task rss ACCEPTED: \\`True Detective 1x03 The Locked Room 720p\\` by series plugin because choosing best available quality\n2014-03-29 10:15 VERBOSE details rss Summary - Accepted: 7 (Rejected: 7 Undecided: 0 Failed: 0)\n2014-03-29 10:15 INFO transmission rss Would add magnet:?xt=urn:btih:2DB3E1CAA8CDE3D9651C7B539CA887F714322E35&amp;dn=True+Detective+S01E08+720p+HDTV+x264+2HD&amp;tr=udp://tracker.openbittorrent.com:80&amp;tr=udp://tracker.to transmission\n2014-03-29 10:15 INFO transmission rss Would add magnet:?xt=urn:btih:41AFF51BA027C488280E248511A9C13C11A9FA11&amp;dn=True+Detective+S01E07+720p+HDTV+x264+KILLERS&amp;tr=udp://tracker.openbittorrent.com:80&amp;tr=udp://tracker.to transmission\n2014-03-29 10:15 INFO transmission rss Would add magnet:?xt=urn:btih:5D7AF918D4CA00709DB6F6E924217E57A6143BD0&amp;dn=True+Detective+S01E06+720p+HDTV+x264+2HD&amp;tr=udp://tracker.openbittorrent.com:80&amp;tr=udp://tracker.to transmission\n2014-03-29 10:15 INFO transmission rss Would add magnet:?xt=urn:btih:7D1795E2E575AA68F57E674F6DD594E847A6A851&amp;dn=True+Detective+S01E05+720p+HDTV+x264+KILLERS&amp;tr=udp://tracker.openbittorrent.com:80&amp;tr=udp://tracker.to transmission\n2014-03-29 10:15 INFO transmission rss Would add magnet:?xt=urn:btih:ABE95E4C2BF49C1FD99EBA0DBE0591B965439042&amp;dn=True+Detective+S01E04+720p+HDTV+x264+KILLERS&amp;tr=udp://tracker.openbittorrent.com:80&amp;tr=udp://tracker.to transmission\n2014-03-29 10:15 INFO transmission rss Would add magnet:?xt=urn:btih:A7D60019E259A95921B1310509783DE7AC80ECD9&amp;dn=True+Detective+S01E03+720p+HDTV+x264+KILLERS&amp;tr=udp://tracker.openbittorrent.com:80&amp;tr=udp://tracker.to transmission\n2014-03-29 10:15 INFO transmission rss Would add magnet:?xt=urn:btih:C6545AC26191F13DF03B06FC42DC485BA92384C4&amp;dn=True+Detective+S01E02+720p+HDTV+x264+KILLERS&amp;tr=udp://tracker.openbittorrent.com:80&amp;tr=udp://tracker.to transmission\n2014-03-29 10:15 INFO manager Removed test database\n</code></pre></p>"},{"location":"rpi_downmanager/#exportacion-samba","title":"Exportaci\u00f3n SAMBA","text":"<p>Ahora vamos a exportar el contenido de algunas de nuestras carpetas para hacerlos visibles en nuestros escritorios MAC Osx.</p> <p>Hay otras alternativas de conexi\u00f3n, como NFS , depende de para que algunas son m\u00e1s robustas y otras my f\u00e1ciles de configurar.</p> <p>Si bien a d\u00eda de hoy parece que Samba (http://es.wikipedia.org/wiki/Samba_(programa)) ha cogido mucha fuerza y es dif\u00edcil encontrar un dispositivo que no pueda realizar una conexi\u00f3n con este protocolo.</p> <p>Vamos a exportar una serie de directorios de nuestra RPI para montarlos luego en el MAC y poder hacer operativas tales como el uso de Hazel, Automator, o simplemente visualizar los ficheros e incluso reproducirlos en nuestro MAC Osx.</p> <p>Primero, tenemos que instalar Samba <pre><code>[root@Jarvis ~]# pacman -S samba\n\nresolviendo dependencias...\nverificando conflictos...\n\nPaquetes (16): cifs-utils-6.2-1 gamin-0.1.10-8 iniparser-3.1-4 ldb-1.1.16-1 libbsd-0.6.0-2 libcap-ng-0.7.3-1 libcups-1.7.1-4 libjpeg-turbo-1.3.0-4 libpng-1.6.10-1 libtiff-4.0.3-4 libwbclient-4.1.6-1\nsmbclient-4.1.6-1 talloc-2.1.0-1 tdb-1.2.12-1 tevent-0.9.21-2 samba-4.1.6-1\nTama\u00f1o Total de Descarga: 10,25 MiB\nTama\u00f1o Total Instalado: 53,20 MiB\n:: \u00bfContinuar con la instalaci\u00f3n? [S/n]\n:: Recuperando paquetes ...\nlibjpeg-turbo-1.3.0-4-armv6h 240,1 KiB 416K/s   00:01 [################] 100%\n\u2026\n\n(15/16) instalando smbclient                          [################] 100%\n(16/16) instalando samba                              [################] 100%\n</code></pre> Y lo configuramos, el fichero de configuraci\u00f3n de ejemplo de samba es una locura\u2026 recurrimos a una plantilla: <pre><code>[root@Jarvis ~]# vi /etc/samba/smb.conf\n[global]\nworkgroup = JarvisGRP\nsecurity = user\nload printers = no\n\n[DescargasDirectas]\npath = /srv/downloads/Directas\npublic = no\nwriteable = yes\nbrowseable = yes\nvalid users = root\n</code></pre> Arrancamos samba y lo dejamos corriendo como proceso en arranque de m\u00e1quina: <pre><code>[root@Jarvis ~]# systemctl start smbd nmbd\n[root@Jarvis ~]# systemctl enable smbd nmbd\nln -s '/usr/lib/systemd/system/samba.service' '/etc/systemd/system/multi-user.target.wants/samba.service'\n</code></pre> Y como tenemos la seguridad por usuario, debemos crear el usuario en las tablas de usuarios propias de samba, as\u00ed que: <pre><code>[root@Jarvis ~]# smbpasswd -a root\nNew SMB password:\nRetype new SMB password:\nAdded user root.\n</code></pre> Para conectarnos desde nuestros Mac Osx a esta carpeta compartida, tenemos que abrir una nueva ventana de Finder CMD+N y a continuaci\u00f3n conectarnos al servidor CMD+K</p> <p>En la conexi\u00f3n del servidor pondremos:</p> <p><code>smb://192.168.1.20/DescargasDirectas</code></p> <p>Nos pedir\u00e1 usuario y clave, que ser\u00e1n el usuario que hemos configurados en <code>smb.conf</code> y la clave la que hemos generado con <code>smbpasswd</code>\u00a0y a partir de ese momento se comportar\u00e1 como una carpeta local al sistema Osx.</p>"},{"location":"rpi_emulador/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 13) \u2013 pr\u00e1ctico 7 - Emulador de Videojuegos","text":""},{"location":"rpi_emulador/#emulacion-de-juegos","title":"Emulaci\u00f3n de Juegos","text":"<p>Pues s\u00ed, se trata de convertir nuestra RPI en una especie de moderna/vieja videoconsola o maquina recreativa.</p> <p>No vamos a obtener el rendimiento de las consolas actuales ni mucho menos, pero si que tenemos potencia para poder hacer correr todo este llamado \u201cAbandonWare\u201d, que son los juegos de los finales de los 80 y principio de los 90 que a muchos nos entretuvieron durante un buen pu\u00f1ado de horas.</p> <p>Podemos hacerlo de dos maneras, montando los distintos emuladores uno a uno\u2026 en algunos casos hay incluso que compilar y entras en una espiral de dependencias/compilaciones que te hace perder mucho tiempo para lo que obtienes\u2026 y la otra forma es usando (sin que sirva de precedente) una imagen que ya lo trae todo y es \u201cReady tu Play\u201d, esta distribuci\u00f3n es PiMame</p> <p>(*Nota 2020 .. las capturas de este post.. tambi\u00e9n est\u00e1n perdidas)</p>"},{"location":"rpi_emulador/#scumm-vm-en-arch-para-juegos-tipo-lucas","title":"Scumm VM en ARCH para juegos tipo \u201cLucas\u201d","text":"<p>La SCUMM es una especie de motor gr\u00e1fico y lenguaje de programaci\u00f3n que se cre\u00f3 en 1985 para el juego Maniac Mansion .</p> <p>Desde entonces los juegos de LucasFilms Games lo adoptan como \u201cFramework\u201d de desarrollo.</p> <p>Vamos a instalar una m\u00e1quina virtual para SCUMM, llamada SCUMMVM, la cual es multiplataforma y corre pr\u00e1cticamente en cualquier hardware, de hecho es una premisa de todo inform\u00e1tico de bien, tratar de instalar la ScummVM y hacer correr el Monkey Island en todo aquello que pase por sus manos y tenga una pantalla.</p> <p>As\u00ed que instalamos, como veis, ya existe como paquete \u201coficial\u201d en los repositorios de ARCH, lo que confirma mis palabras anteriores\u2026</p> <p>[root@Jarvos ~]# pacman -S scummvm</p> <p>resolviendo dependencias... verificando conflictos... Paquetes (9): faad2-2.7-4 fluidsynth-1.1.6-2 glu-9.0.0-2 jack-0.124.1-1 json-c-0.11-1 libasyncns-0.8-5 libpulse-5.0-1 libtheora-1.1.1-3 scummvm-1.6.0-2</p> <p>Tama\u00f1o Total de Descarga: 7,31 MiB Tama\u00f1o Total Instalado: 27,55 MiB :: \u00bfContinuar con la instalaci\u00f3n? [S/n] (6/9) instalando fluidsynth             [########################################################################] 100%</p> <p>To use FluidSynth as a daemon copy the service file from: /usr/lib/systemd/system/fluidsynth.service</p> <p>to: /etc/systemd/system/multi-user.target.wants/</p> <p>and then edit accordingly. PulseAudio output when running as a daemon is known to be problematic. See the following bulletin board post: https://bbs.archlinux.org/viewtopic.php?id=135092</p> <p>Estos mensajes tan \u201cfeos\u201d que vemos durante la instalaci\u00f3n son por la instalaci\u00f3n de un sintetizador, y que bueno, es claro, te indica que si quieres tener la posibilidad de arrancarlo y pararlo como el resto del sistema pues que te lo hagas tu.</p> <p>Pero la realidad es que est\u00e1 todo hecho y con un entable y un start a trav\u00e9s de systemctl solucionado, y as\u00ed lo hacemos:</p> <p>[root@Jarvis ~]# systemctl enable fluidsynth ln -s '/usr/lib/systemd/system/fluidsynth.service' '/etc/systemd/system/multi-user.target.wants/fluidsynth.service'</p> <p>[root@Jarvis ~]# systemctl start fluidsynth</p>"},{"location":"rpi_emulador/#cargando-monkey-island","title":"Cargando Monkey Island","text":"<p>Vamos con un cl\u00e1sico, Monkey Island.</p> <p>Yo este juego lo tengo original, pero por desgracia a d\u00eda de hoy imposible jugarlo por que era para MsDOS, est\u00e1 en disquetes y por que hace a\u00f1os que perd\u00ed la ruleta de los c\u00f3digos de bloqueo (si que chula, con sus piratas\u2026 snifff)</p> <p>Para la Rom, hablamos en privado.</p> <p>[root@Jarvis ~]# scummvm</p> <p>WARNING: FSNode::createReadStream: '.scummvmrc' does not exist! Default configuration file missing, creating a new one</p> <p>Y ya est\u00e1, ahora solo hay que cargar las ROM y a jugar.</p> <p>Eso s\u00ed, necesitar\u00e9is conectar un rat\u00f3n para poder manejarlo y un teclado.</p> <p>Para a\u00f1adir el nuevo juego:</p> <p>(http://i58.tinypic.com/2a5eps6.jpg)</p> <p>Dentro navegamos por la estructura de directorios hasta que nos metamos dentro del directorio que tiene nuestro juego:</p> <p>(http://i57.tinypic.com/iypr8j.jpg)</p> <p>Y el sistema nos reconocer\u00e1 el juego sin problemas:</p> <p>(http://i62.tinypic.com/2qjkepz.jpg)</p> <p>Y listo, a disfrutarlo, aqu\u00ed ten\u00e9is una mini gu\u00eda de los comandos de teclado de Scumm VM (salvar partida, cargar partida, etc.)</p> <p>En esa gu\u00eda anuncian CTRL+F5 como el comando para sacar a mitad de juego el men\u00fa que nos interesa\u2026 el de cargar/salvar salir, etc. En el caso de los teclados de Apple, por lo menos en el que se conecta por USB la combinaci\u00f3n de teclas a utilizar es CTRL+FN+F5, tenedlo en cuenta, que si no te quedas como atrapado dentro del juego ;)</p> <p>Como podr\u00e9is comprobar, no hay sonido\u2026 el sonido es algo pu\u00f1etero en las Rpi, vamos a ver si lo conseguimos activar.</p> <p>1.- Acutalizamos/completamos la instalaci\u00f3n de Alsa</p> <p>[root@Jarvis ~]# pacman -S alsa-firmware alsa-lib alsa-plugins alsa-utils</p> <p>atenci\u00f3n: alsa-lib-1.0.27.2-1 est\u00e1 actualizado -- re-instalando resolviendo dependencias... verificando conflictos... Paquetes (4): alsa-firmware-1.0.27-2 alsa-lib-1.0.27.2-1 alsa-plugins-1.0.27-2 alsa-utils-1.0.27.2-1 Tama\u00f1o Total de Descarga: 2,98 MiB Tama\u00f1o Total Instalado: 15,56 MiB Tama\u00f1o neto a actualizar: 14,12 MiB :: \u00bfContinuar con la instalaci\u00f3n? [S/n] S :: Recuperando paquetes ...</p> <p>alsa-firmware-1.0.27-2-any 2,0 MiB 1480K/s 00:01     [#########################################################################] 100% alsa-plugins-1.0.27-2-armv6h 50,4 KiB 245K/s 00:00   [#########################################################################] 100% alsa-utils-1.0.27.2-1-armv6h 905,8 KiB 1201K/s 00:01 [#########################################################################] 100% (4/4) verificando llaves en el llavero               [#########################################################################] 100% (4/4) verificando la integridad de los paquetes      [#########################################################################] 100% (4/4) cargando los archivos del paquete...           [#########################################################################] 100% (4/4) verificando conflictos entre archivos          [#########################################################################] 100% (4/4) verificando el espacio disponible en disco     [#########################################################################] 100% (1/4) instalando alsa-firmware                       [#########################################################################] 100% (2/4) reinstalando alsa-lib                          [#########################################################################] 100% (3/4) instalando alsa-plugins                        [#########################################################################] 100%</p> <p>Dependencias opcionales para alsa-plugins libpulse: PulseAudio plugin[instalado] jack: Jack plugin[instalado] ffmpeg: libavcodec resampling plugin, a52 plugin libsamplerate: libsamplerate resampling plugin[instalado] speex: libspeexdsp resampling plugin (4/4) instalando alsa-utils</p> <p>2.- Activamos el m\u00f3dulo de sonido</p> <p>[root@Jarvis ~]# modprobe snd-bcm2835</p> <p>3.- Creamos el fichero de configuraci\u00f3n del m\u00f3dulo <code>/etc/modules-load.d/snd-bcm2835.conf</code></p> <p>[root@Jarvis ~]# echo \"snd-bcm2835\" &gt;&gt; /etc/modules-load.d/snd-bcm2835.conf</p> <p>4.- Arrancamos el \u201cmezclador\u201d para ver que no est\u00e9 silencioado</p> <p>[root@Jarvis ~]# alsamixer</p> <p>5.- Podemos hacer un test de altavoces</p> <p>[root@Jarvis ~]# speaker-test -c 2 speaker-test 1.0.27.2 Playback device is default Stream parameters are 48000Hz, S16_LE, 2 channels Using 16 octaves of pink noise Rate set to 48000Hz (requested 48000Hz) Buffer size range from 256 to 16384 Period size range from 256 to 16384 Using max buffer size 16384 Periods = 4</p> <p>6.- Y salvamos los cambios</p> <p>[root@GumPI ~]# alsactl store</p> <p>Y ahora, si entramos a ScummVM y vamos a opciones podremos activar el sonido por Midi en los ajustes y tener sonido\u2026 o no\u2026 por que no he podido hacer m\u00e1s pruebas, pero cuando lo consiga aqu\u00ed os actualizo la gu\u00eda.</p>"},{"location":"rpi_emulador/#instalacion-de-imagen-de-pimame","title":"Instalaci\u00f3n de Imagen de PiMAME","text":"<p>Tenemos que pasar la imagen del sistema operativo que nos descargamos a una tarjeta SD.</p> <p>Recordad que en los primeros mensajes de este hilo se trataba en profundidad esto.</p> <p>La imagen la obtenemos de la p\u00e1gina del proyecto</p> <p>Y una vez cargada esta distribuci\u00f3n es de las \u201ctodo hecho\u201d, colocar en la ranura y encender.</p> <p>Nos aparece un men\u00fa para elegir el emulador que queramos y listo, a elegir las Roms y a jugar.</p> <p>Para pasar las Roms, lo m\u00e1s sencillo es hacerlo con un cliente SFTP y pasar los ficheros a la Raspberry.</p> <p>El usuario de conexi\u00f3n es pi, y la clave es raspberry.</p> <p>El lugar donde dejar las Roms es <code>/home/pi/pimame/roms</code></p> <p>Si quer\u00e9is m\u00e1s informaci\u00f3n (de hecho es TODA la informaci\u00f3n) de esta distribuci\u00f3n, aqu\u00ed est\u00e1 pimame.org</p>"},{"location":"rpi_install_i/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 2) - Instalaci\u00f3n b\u00e1sica (I)","text":""},{"location":"rpi_install_i/#por-donde-empiezo","title":"\u00bfPor donde empiezo?","text":"<p>Lo primero que deber\u00edas pensar es \u00bfque voy a hacer con esto?. No es lo mismo tratar de montar un servidor de WordPress, que un centro multimedia, que un gestor de descargas u otra cosa. Tambi\u00e9n tienes que pensar en la cantidad de tiempo que le quieres dedicar y lo que quieres profundizar en la tarea. Lo mismo que antes, no es lo mismo querer poner una imagen de las del tipo \"todo hecho\" y no perder m\u00e1s que 5 minutos configurando, que hacer una instalaci\u00f3n desde base e ir creando tu, t\u00fa propio entorno. Si quieres, para empezar puedes probar las distribuciones ya hechas y ver que por lo menos esto funciona, y luego ya puedes seguir leyendo el resto donde usar\u00e9 una distribuci\u00f3n algo m\u00e1s compleja.</p>"},{"location":"rpi_install_i/#alternativas","title":"\u00bfAlternativas?","text":"<p>Un mont\u00f3n!!!, y cada d\u00eda m\u00e1s. Tienes distribuciones basadas en BSD, alguna versi\u00f3n de Android y otra muchas basadas en diferentes distribuciones\u00a0de Linux, como son Debian, Arch Linux y Fedora (algo me dejo seguro...) No busques la famosa Ubuntu por que como tal no existe, Cannonical hace tiempo que estableci\u00f3 su m\u00ednimo de\u00a0hardware para las distribuciones de Ubuntu basadas en procesadores ARM\u00a0en los\u00a0micros ARM v7, nuestra Pi es un ARM v6, no hay mucho que hacer.</p> <p>Cada distribuci\u00f3n tiene sus pros y sus contras, e incluso con el tiempo te vuelves un poco \"fan\" de alguna en concreto\u00a0que seguro que no es la mejor en su campo, pero que es con la que mejor te \u00a0desenvuelves. En mi caso, y la que vais a ver a lo largo de todo este texto es ARCH Linux, en su distribuci\u00f3n para microprocesadores ARM (el de\u00a0nuestra Pi, un v6). Para la descarga de la imagen ISO original, nada mejor que la p\u00e1gina de la Fundaci\u00f3n.</p>"},{"location":"rpi_install_i/#y-eso-de-noobs","title":"\u00bfY eso de NOOBS?","text":"<p>Pues esto es relativamente reciente, de Septiembre-Octubre de 2013. (recordad... esto se escribi\u00f3 en 2014!!). Consiste en que te descargas una imagen muy peque\u00f1a, y una vez puesta en la Pi, conectada a red y conectada\u00a0a un teclado y video por HDMI, arranca y se empieza a descargar la imagen definitiva. Algo as\u00ed como los ejecutables de instalaci\u00f3n que se emplean en Windows (argggg), que ocupa muy poco y que\u00a0cuando los ejecutas te das cuenta que se pone a descargar el software real y se pega la tira de tiempo descargando y\u00a0venga a bajar megas y megas. Tambi\u00e9n tienes la opci\u00f3n de utilizar una imagen NOOB que tiene las distribuciones casi completas y no necesita de esta\u00a0descarga. Es una facilidad, muy acertada, que nos dan ahora por si no quieres complicaciones de ning\u00fan tipo. No es que no recomiende su uso, pero a mi estas cosas no me gustan, las cosas que vienen ya hechas o que te lo\u00a0hacen todo ellos y yo no somos muy amigos. No digo que no funcione, por que lo he probado y funciona bastante bien, pero as\u00ed no aprendes nada.</p>"},{"location":"rpi_install_i/#entonces-arch-linuxpor-que","title":"\u00bfEntonces ARCH Linux?\u00bfPor qu\u00e9?","text":"<p>Bien, ARCH es una distribuci\u00f3n que con su sistema de liberaci\u00f3n de paquetes me tiene encantado, es lo que se llama\u00a0un Rolling Release, esto es, seg\u00fan sale un nuevo parche para un componente este se libera y te lo\u00a0individualmente. No tienes por tanto que aguantarte con un problema en un componente como pasa con otras distribuciones,\u00a0llamadas Point Release, que sacan versiones estables cada cierto tiempo (en el caso de Debia hablamos de a\u00f1os...). Por otro lado, esas versiones estables suelen implicar la reinstalaci\u00f3n completa de la tarjeta, mientras que con una\u00a0rolling release instalas la base y luego a base de actualizaciones te mantienes al d\u00eda, bueno, casi, esto es como dir\u00eda\u00a0un f\u00edsico te\u00f3rico, en condiciones ideales de temperatura, presi\u00f3n y en vac\u00edo... Tampoco pens\u00e9is que ARCH es un mundo ideal, son famosas sus meteduras de pata, como cuando dieron el paso\u00a0definitivo para abandonar Init de BSD por systemd, o cuando cambiaron en verano de 2013 el punto de montaje de\u00a0binarios... y m\u00e1s recientemente con los cambios en la distribuci\u00f3n de las particiones del disco (tarjeta SD m\u00e1s bien). En cualquiera de esos casos, si no andas un poco pendiente te puedes encontrar con un sistema in\u00fatil que no arranca. Pero tranquilos, que el apartado de backup / restauraci\u00f3n est\u00e1 un poco m\u00e1s abajo para que durm\u00e1is mejor.</p>"},{"location":"rpi_install_i/#previos-a-la-instalacion","title":"Previos a la instalaci\u00f3n","text":"<p>Nos descargamos la \u00faltima imagen, desde\u00a0aqu\u00ed\u00a0a nuestro equipo. Tenemos nuestra Pi desconectada del adaptador de corriente, conectada a nuestro router por un cable ethernet, y\u00a0nada m\u00e1s, no necesitamos video por el momento, ni siquiera teclado rat\u00f3n, vamos a hacerlo todo por SSH</p> <p>Vas a necesitar acceso a la URL de administraci\u00f3n de tu router, por que necesitas saber que direcci\u00f3n IP ha asignado\u00a0tu DHCP a la MAC de la Pi, eso si no eres como yo, que tengo muy restringida la asignaci\u00f3n de IPs en mi DHCP y soy\u00a0de los que asigna las IPs a mano, para tal MAC tal IP y ni una m\u00e1s. Necesitas tambi\u00e9n un lector de tarjetas SD, si es que tu equipo no tiene uno integrado, como pasa en muchos\u00a0port\u00e1tiles Mac y en los iMac. Yo he usado normalmente un adaptador USB que es como un pendrive, al que se le coloca la SD en un extremo, es\u00a0quiz\u00e1s algo m\u00e1s lento que un lector de tarjetas en condiciones, pero es mucho m\u00e1s c\u00f3modo de usar por sus\u00a0dimensiones. Y necesitas un software para pasar esa imagen Iso que te descargas a la tarjeta SD, yo uso Pi Filler, aunque si no lo quieres usar no te preocupes por que ahora te voy a contar como\u00a0hacerlo usando el Terminal, que no dista mucho a como este programilla lo hace.</p> <p>De este mismo desarrollador ten\u00e9is Pi Copier, que te vuelca (y comprime si lo\u00a0quieres) el contenido de la tarjeta SD a tu disco duro. Una buena opci\u00f3n a estudiar, sobre todo al principio cuando es\u00a0muy f\u00e1cil entre prueba y prueba cargarte toda la instalaci\u00f3n y tener que volver a empezar.</p>"},{"location":"rpi_install_i/#ahora-si-que-si-empezamos","title":"Ahora si que s\u00ed, empezamos","text":"<p>Vamos a pasar la imagen de nuestro sistema operativo, descargado en nuestro disco duro a la tarjeta SD. Antes de continuar, descomprime el .zip del fichero de la imagen, que sin eso no hacemos nada. Ahora, SIN haber puesto la tarjeta SD en el equipo ejectutamos Pi Filler, escogemos la imagen a instalar y nos indica\u00a0que debemos introducir la tarjeta SD, nos la reconocer\u00e1 y nos pregunta cual es (s\u00f3lo te puedes fiar por el nombre,\u00a0cuidado con esto que puedes borrar algo que no es...), una vez aceptadas las pantallas se pone a volcar la imagen en\u00a0la tarjeta y despu\u00e9s de un buen rato, m\u00ednimo media hora, ya estar\u00e1 lista para su uso.</p> <p>Si quieres hacer este mismo proceso por ti mismo, con el terminal de OSX los pasos a dar son estos:</p> <ul> <li>En primer lugar, abre el terminal, bien por que lo ejecutas a partir de tus aplicaciones o bien por que lo inicias desde\u00a0una b\u00fasqueda de Spotligth (CMD + Espacio, teclear terminal y aceptar con intro)</li> <li>Conectas la tarjeta SD al sistema.</li> <li>Identificamos cual es la tarjeta SD que hemos puesto</li> </ul> <pre><code>/dev/disk0 (internal, physical):\n   #:                       TYPE NAME                    SIZE       IDENTIFIER\n   0:      GUID_partition_scheme                        *1.0 TB     disk0\n   1:                        EFI EFI                     209.7 MB   disk0s1\n   2:                 Apple_APFS Container disk1         1000.0 GB  disk0s2\n\n/dev/disk1\n#: TYPE NAME\n0: FDisk_partition_scheme *32.0 GB\n1: DOS_FAT 32.0 GB\n</code></pre> <ul> <li>Como v\u00e9is, en mi caso mi SD es el disco que est\u00e1 en <code>/dev/disk1</code>. El tama\u00f1o de la tarjeta SD es una muy buena pista para identificarla.</li> <li>Ahora bien, por si ten\u00e9is alguna duda, ejecuntado este comando podr\u00e9is ver donde est\u00e1 montada la tarjeta en el\u00a0sistema de ficheros:</li> </ul> <pre><code>df -kh\nFilesystem Size Used Avail Capacity Mounted on \n/dev/disk0s2 233Gi 208Gi 25Gi 90% /\n...\n/dev/disk1s2 32Gi 17Mi 31Mi 1% /Volumes/Untitled\n</code></pre> <p>Todas las unidades externas en OSX se montan en <code>/Volumes</code>, y ese Untitled que aparece ah\u00ed es el nombre de nuestra tarjeta, que seguramente si est\u00e1 nueva sea ese. El disco es <code>/dev/disk1</code> y <code>s2</code> es el n\u00famero de la partici\u00f3n del disco (la s es de slice), por tanto nuestro disco es <code>/dev/disk1</code>, de la partici\u00f3n nos olvidamos por que al volcar la imagen de la distribuci\u00f3n se crea su propia tabla de particiones (que luego vamos a modificar, por supuesto).</p> <ul> <li>Ahora tenemos que desmontar la tarjeta SD, pero no expulsarla!!. Esto es, vamos a ver c\u00f3mo desaparece la unidad de nuestro escritorio, pero el dispositivo sigue conectado al equipo. <pre><code>sudo diskutil unmountDisk /dev/disk1\n</code></pre></li> </ul> <p>sudo es el comando para la ejecuci\u00f3n de comandos bajo otro usuario, su es de switch user y do de hacer, esto es, hacer con otro usuario. Aqu\u00ed en este comando que os he puesto es ejecutar con el usuario administrador el comando diskutil. Os va a pedir una clave antes de continuar, es la clave del usuario administrador de vuestro equipo.</p> <ul> <li>El comando para grabar la imagen en ese dispositvo es este: <pre><code>sudo dd bs=1m if=&lt;ficheroimagen.img&gt; of=/dev/disk1\n</code></pre></li> </ul> <p>El comando dd toma su nombre de Dataset Definition, y sirve para la manipulaci\u00f3n de la informaci\u00f3n a bajo nivel, para transferir datos, manipular raw data/devices (si, este RAW significa lo mismo que el RAW de las c\u00e1maras de fotos tan de moda \u00faltimamente, acceso en \"crudo\") y realizar algunas conversiones predefinidas. Los par\u00e1metros que pasamos al comando son bs=1m, que indica que use bloques de 1m para la lectura y escritura, if que le indica al comando el fichero (con ruta completa si es necesario) de origen, y of que le indica el destino de los datos, en nuestro caso el dispositivo de la tarjeta SD. Deb\u00e9is reemplazar  por el nombre y ruta de vuestro fichero de imagen, si por ejemplo lo ten\u00e9is en vuestras descargas de usuario tendr\u00e9is dos opciones para hacerlo. <p>La primera es cambiar el directorio actual de trabajo del terminal, en los sistemas OSX, aunque en el navegador de carpetas lo ve\u00e1is todo en castellano, en realidad todo eso \"por debajo\" no son m\u00e1s que carpetas del sistema operativo BSD, que est\u00e1n en ingl\u00e9s. Vuestra carpeta de descargas de usuario estar\u00e1 en <code>~/Downloads</code> El s\u00edmbolo <code>~</code> (si, el gorrinillo de encima de las \u00d1 o virgulilla) se corresponde al caracter ASCII 126 y es un car\u00e1cter reservado que viene a indicar o contener la ruta del directorio HOME del usuario. En los equipos con Windows (arggg) se obtiene manteniendo pulsada la tecla ALT y tecleando 126 en el teclado num\u00e9rico. En los equipos con OSX se obtiene manteniendo pulsada la tecla ALT y pulsando la tecla \u00d1. En mi caso, que mi usuario se llama Nono, mi carpeta de descargas estar\u00e1 en la ruta <code>/Users/Nono/Downloads</code> \u00f3 bien en la ruta <code>~/Downloads</code>.</p> <ul> <li>As\u00ed que, ejecutamos esto para cambiar al directorio <pre><code>cd ~/Downloads\n</code></pre></li> </ul> <p>El comando cd es Change Dir, cambia de directorio, y nos lleva al mismo sitio donde tenemos descargada nuestra\u00a0imagen, si este fichero se llama, por ejemplo <code>archlinux-hf-2013-07-22.img</code>, el comando dd que tenemos que ejecutar\u00a0es este:</p> <pre><code>sudo dd bs=1m if=archlinux-hf-2013-07-22.img of=/dev/disk1\n</code></pre> <p>Si no queremos hacer cambios de directorios y ejecutar el comando dd buscando el fichero de imagen como ruta\u00a0absoluta a nuestras descargas, estemos posicionados donde estemos en el terminal, el comando dd a ejecutar es:</p> <pre><code>sudo dd bs=1m if=~/Downloads/archlinux-hf-2013-07-22.img of=/dev/disk1\n</code></pre> <p>En OSX tenemos posibilidad de acceder al dispositivo tambi\u00e9n por un puntero al mismo en modo RAW, que ya que\u00a0estamos usando dd, que como os he contado es experto en estos desempe\u00f1os, podemos hacer uso de el.</p> <p>Hay quien\u00a0dice que con este tipo de acceso se pueden llegar a tener un 20% m\u00e1s de rendimiento, yo no apreci\u00e9 tanto, aunque si\u00a0que se nota algo.. Para esto, en vez de utilizar el dispositivo /dev/disk1 usamos el de acceso raw /dev/rdisk1, esa r ese raw. Por tanto, el comando dd \"definitivo\" ser\u00eda este:</p> <pre><code>sudo dd bs=1m if=archlinux-hf-2013-07-22.img of=/dev/rdisk1\n</code></pre> <ul> <li>Tan s\u00f3lo resta esperar a la finalizaci\u00f3n del comando dd y expulsar la tarjeta SD del sistema, para la expulsi\u00f3n el\u00a0comando es este:     <pre><code>sudo diskutil eject /dev/disk1\n</code></pre></li> </ul>"},{"location":"rpi_install_i/#encendemos-nuestra-pi-por-primera-vez","title":"Encendemos nuestra Pi por primera vez","text":"<p>Quitamos la SD del equipo y/o adaptador y la ponemos en la ranura de la Pi, conectamos el cable ethernet y le\u00a0ponemos corriente. La m\u00e1quina empieza a arrancar, si la tuvi\u00e9semos conectada por HDMI a un monitor o a nuestra televisi\u00f3n (el arranque\u00a0de un linux en un plasma de 50\" es espectacular XD) ver\u00edamos todo el proceso de arranque, carga de drivers,\u00a0montaje de file system, etc. Tenemos que identificar la direcci\u00f3n IP que nos ha dado el router, ser\u00e1 alguna de nuestra red local, algo en plan\u00a0192.168.1.XXX</p> <p>Vamos a realizar una conexi\u00f3n por el protocolo SSH, esto es, una conexi\u00f3n que lleva una capa de cifrado y se\u00a0comunica al puerto 22 de nuestra Pi, que por defecto en esta distribuci\u00f3n viene abierto, y que un poco m\u00e1s adelante\u00a0podr\u00e9is ver como securizar convenientemente en caso de que lo consider\u00e9is oportuno. Para realizar esta conexi\u00f3n podemos emplear nuestro propio terminal en OSX, pues disponemos de cliente nativo de\u00a0SSH, o bien podemos emplear alg\u00fan tipo de software, de los denominados de terminal, que nos aporte alg\u00fan valor\u00a0a\u00f1adido, como un historial de comandos o una gesti\u00f3n de conexiones.</p> <p>Yo uso habitualmente iTerm2, pero pod\u00e9is usar el terminal del propio Osx para esto, el comando a ejecutar es este:</p> <pre><code>ssh root@192.168.1.20\n</code></pre> <p>Una anotaci\u00f3n sobre las conexiones SSH, cuando realizamos una conexi\u00f3n por primera vez a un sistema nos suele\u00a0aparecer un mensaje en el terminal tal que as\u00ed:</p> <pre><code>The authenticity of host '192.168.1.20 (192.168.1.20)' can't be established.\nRSA key fingerprint is 91:2d:b5:60:8a:17:60:4e:62:37:d2:ce:ea:94:7f:65.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added '192.168.1.20' (RSA) to the list of known hosts.\n</code></pre> <p>Tenemos que decir yes, que aceptamos que se guarde la huella RSA para ese servidor en nuestra lista de equipos conocidos. Y esta informaci\u00f3n se guarda en el fichero known_hosts que tenemos en el directorio <code>.ssh</code> de nuestro home de usuario <code>~/.ssh</code>. \u00bfPor que os cuento esto?, pues por que esa IP, nombre de m\u00e1quina y huella de clave RSA se almacenan ah\u00ed donde os digo y en caso de hacer una reinstalaci\u00f3n de la tarjeta SD (lo har\u00e1s tarde o temprano.. al tiempo) esta informaci\u00f3n cambia. Cuando trat\u00e9is de hacer una conexi\u00f3n SSH a la nueva/reci\u00e9n formateada Pi se har\u00e1 un lio tremendo entre lo antiguo y lo nuevo y ver\u00e9is como directamente la conexi\u00f3n SSH se cierra. Es m\u00e1s, es posible que os llegue a salir un aviso en pantalla acerca de un posible ataque del tipo \u201cMan in the Middle\u201d, como esto:</p> <pre><code>@@@@@@@@@@@\nWARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!\n@@@@@@@@@@@\nIT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!\nSomeone could be eavesdropping on you right now (man-in-the-middle attack)!\nIt is also possible that a host key has just been changed.\nThe fingerprint for the RSA key sent by the remote host is\n32:e5:d9:77:59:79:f3:83:3f:d6:19:76:b7:00:f4:c1.\nPlease contact your system administrator.\nAdd correct host key in /Users/Nono/.ssh/known_hosts to get rid of this message.\nOffending RSA key in /Users/Nono/.ssh/known_hosts:1\nRSA host key for 192.168.1.20 has changed and you have requested strict checking.\nHost key verification failed.\n</code></pre> <p>\u00bfSoluci\u00f3n?, modificar o eliminar este fichero, si eliminar, no pasa nada, se volver\u00e1 a generar y llenar de contenido en las siguientes conexiones. As\u00ed que, si reinstalas tu Pi y ves que no puedes conectar con ella por SSH, y que esta conexi\u00f3n se cierra al instante  prueba esto:</p> <pre><code>rm ~/.ssh/known_hosts\n</code></pre> <p>El comando <code>rm</code> toma su nombre de Remove, elimina ese fichero, es un comando PELIGROSO ya que no tiene marcha\u00a0atr\u00e1s, no existe un unrm... lo que borres borrado est\u00e1, adem\u00e1s este comando puede tomar a trav\u00e9s de sus\u00a0par\u00e1metros un mont\u00f3n de opciones que hagan que su comportamiento sea letal, como <code>-fr</code> (f = force r=recursive,\u00a0borra recursivamente sin confirmaci\u00f3n), todo un HitParade entre los becarios de administraci\u00f3n de sistemas, y que\u00a0tire la primera piedra el que nunca se le haya escapado uno y la haya liado parda... Si te da miendo usar este comando puedes tratar de mover el fichero, si mover, por que en Unix/Linux no existe un\u00a0comando que renombre elementos, existe un comando que los mueve.</p> <pre><code>mv ~./ssh/known_hosts ~./ssh/known_hosts.old\n</code></pre> <p>El comando mv es de Move, y lo que hace es que mueve el fichero known_hosts a otro destino, que es el fichero\u00a0known_hosts.old. Retomamos nuestra instalaci\u00f3n, perd\u00f3n por la dispersi\u00f3n, pero creo que es bueno ir de vez en cuando soltando cosas\u00a0de estas en plan culturilla general, que son las que m\u00e1s te hacen aprender. Hemos abierto una conexi\u00f3n SSH, hemos autorizado a que se almacene en local la huella de la clave RSA de nuestra\u00a0PI y nos est\u00e1 pidiendo la clave del usuario root, que es el que hemos configurador en la conexi\u00f3n. \u00bfQue clave?, la de por defecto, luego la cambiamos, es root</p>"},{"location":"rpi_install_i/#pantalla-negra-letras-blancas-tu-tienes-el-poder","title":"Pantalla negra letras blancas, tu tienes el poder","text":"<pre><code>[root@alarmpi ~]#\n</code></pre> <p>Con estos caracteres tu Pi te da la bienvenida al mundo del cacharreo. \u00bfDecepcionado verdad?, espera, que te explico la cantidad de informaci\u00f3n que te est\u00e1 dando con esa l\u00ednea\u00a0aparentemente tan simple. root = nos informa del usuario con el que estamos interactuando en esta sesi\u00f3n, en breve vemos como crear m\u00e1s\u00a0usuarios y esta informaci\u00f3n te ser\u00e1 de utilidad, as\u00ed sabes que estas ejecutando y con que usuario. alarmpi = el nombre de nuestra m\u00e1quina, as\u00ed sabes a que m\u00e1quina te has conectado. \u00bfPero si s\u00f3lo tengo una?, si, tu\u00a0si, pero yo a d\u00eda de hoy administro administraba entorno a los 200 servidores, vital saber el cual est\u00e1s. En breve\u00a0vemos como cambiar el nombre a nuestra m\u00e1quina, ante todo personalidad propia!!. ~ = nuestra amiga la virgulilla aparece de nuevo, nos indica que estamos en el directorio HOME de este usuario. Si\u00a0hacemos referencia en un cd (change directory, cambio de directorio) a ~ nos llevar\u00e1 a este directorio o bien lo\u00a0emplear\u00e1 para componer la ruta relativa us\u00e1ndolo como base, es lo mismo que emplear la varible de entorno $HOME\u00a0(las variables se referencia as\u00ed, con un $ por delante). Esta informaci\u00f3n es muy util pues en cuanto que cambiemos\u00a0de directorio aqu\u00ed nos aparecer\u00e1 el nombre del directorio (sin ruta) en el que nos encontramos (que ser\u00eda lo mismo\u00a0que consultar la variable de entorno $PWD, \u00f3 Process Working Directory, o ejecutar el comando pwd que nos da esta\u00a0misma informaci\u00f3n). # = esto nos indica que tenemos la shell como root, nuevamente en entornos monousuario que s\u00f3lo tenemos root no\u00a0nos aporta nada, pero cuando tenemos varios usuarios es importante porque, con usuarios que no son UID 0\u00a0(administradores, como nuestro root) el s\u00edmbolo que veremos es un $.</p> <p>\u00bfQue diferencia hay con la shell de root y la de\u00a0otro usuario?, pensad en aquel <code>-fr</code> del comando <code>rm</code>, y ahora lo junt\u00e1is con una shell privilegiada, si... la aniquilaci\u00f3n\u00a0de todo fichero de tu instalaci\u00f3n... \u00bfA que mola tener el poder?? mu ha ha ha... Toda esta informaci\u00f3n que se nos muestra es completamente personalizable, para ello podemos modificar en nuestro\u00a0fichero de perfil de shell (<code>.profile</code>, <code>.bash_profile</code> o en los esqueletos de usuarios para hacerlo general a todos los\u00a0nuevos usuarios) el valor de las variables de entorno <code>$PS1</code> y <code>$PS2</code>, las llamadas Prompt String.</p> <p>No quiero hacer esta\u00a0gu\u00eda interminable as\u00ed que voy a omitir estas configuraciones, si alguien est\u00e1 interesado en ello que me lo pregunte,\u00a0que con mucho gusto le cuento como modificarlo.</p>"},{"location":"rpi_install_i/#nos-ponemos-al-dia","title":"Nos ponemos al d\u00eda","text":"<p>Antes de empezar a hacer m\u00e1s cosas, vamos a actualizar nuestro sistema para ponerlo a la \u00faltima. Recordad, estamos en una distribuci\u00f3n Rolling Release, as\u00ed que vamos a decirle al sistema que mire que es lo que\u00a0tiene instalado, busque en los repositosio las actualizaciones y nos las instale.</p> <pre><code>[root@alarmpi ~]# pacman -Syu\n</code></pre> <p>pacman es el comando para manejar y administrar paquetes de software, con el podr\u00e1s instalar, actualizar, eliminar y\u00a0listar el software que tienes instalado. Con los par\u00e1metros -Syu le indicamos la forma de comportarse, en este caso es S = sincroniza paquetes, y = refresca\u00a0la descarga del paquete desde el repositorio, es lo mismo que usar --refresh, y u = actualizar todos los paquetes que\u00a0est\u00e1n fuera de fecha, es lo mismo que usar el par\u00e1metro <code>--sysupgrade</code> Veremos como el sistema comprueba todos los paquetes y nos solicita confirmaci\u00f3n para realizar la actualizaci\u00f3n.\u00a0La primera vez lleva un tiempo. Finalizada la actualizaci\u00f3n debemos reiniciar la m\u00e1quina para que se carguen todos los paquetes nuevos/actualizados\u00a0correctamente.</p> <pre><code>[root@alarmpi ~]# sync\n[root@alarmpi ~]# reboot\n</code></pre> <p>El comando sync lo que hace es volcar a disco toda la informaci\u00f3n que puedan contener los buffers de memoria y que\u00a0a\u00fan no se han fijado en fichero. Es por decirlo en lenguaje m\u00e1s plano, salvar a disco lo que est\u00e1 en vuelo o en\u00a0memoria de la m\u00e1quina. El comando reboot lo que hace es un apagado y posterior inicio de nuestra m\u00e1quina. Podemos hacerlo de m\u00e1s\u00a0maneras, usando por ejemplo el comando <code>shutdown -r</code> o el propio systemd nos permite reiniciar con el comando\u00a0<code>systemctl reboot</code>.</p> <p>Alguna vez he visto diferencias entre ambos, aparte de la evidente que shutdown tiene por defecto un periodo de tiempo de gracia durante el cual puedes interrumpir la parada (con <code>shutdown -c</code>), pero son cosas\u00a0relativamente espec\u00edficas al sistema operativo, tal como esto que os dec\u00eda de sync, que pueda ser invocado por el\u00a0comando de reinicio, desconexiones y parada de servicios, etc. No quiero entretenerme demasiado.</p>"},{"location":"rpi_install_i/#un-toque-personal","title":"Un toque personal","text":"<p>Nuestra m\u00e1quina ya est\u00e1 casi lista para empezar a hacer tareas de las \"divertidas\", antes de seguir, vamos a darle un\u00a0poco de toque personal, hay unas cuantas cosas que no est\u00e1n configuradas o que si lo est\u00e1n es con los valores por\u00a0defecto y esto no me gusta.</p> <ul> <li>En primer lugar, la clave del administrador:</li> </ul> <pre><code>[root@alarmpi ~]# passwd root\nEnter new UNIX password:\nRetype new UNIX password:\npasswd: password updated successfully\n</code></pre> <p>El comando passwd nos permite cambiar la clave, se nos solicita dos veces y no se muestra en pantalla. No recuerdo bien si esta clave tiene pol\u00edtica de caracteres, en plan m\u00ednimo 8 caracteres, al menos una may\u00fascula, un\u00a0d\u00edgito num\u00e9rico, un car\u00e1cter raruno como #$%&amp; y que no se haya repetido la clave en los \u00faltimos cambios.. etc etc.. La verdad es que suelo usar una clave m\u00e1s o menos compleja que harto de estas exigencias las cumple todas y una\u00a0parte de la clave es variable para evitar repetir en futuros cambios. Lo dicho, pon\u00e9is la clave nueva que quer\u00e1is.</p> <ul> <li>Cambiamos la configuraci\u00f3n de zona horaria</li> </ul> <pre><code>[root@alarmpi etc]# echo \"Europe/Madrid\" &gt; /etc/timezone\n</code></pre> <p>Os explico. El comando echo lo que hace es imprimir en la salida estandar lo que le digamos, hace un \"eco\". \u00bfSalida estandar?, bien os amplio la informaci\u00f3n, sin nervios. Est\u00e1is tratando con un sistema operativo de verdad, no aquellos juguetes de Ms-DOS (argggg), aqu\u00ed ten\u00e9is una\u00a0entrada estandar (por defecto teclado) y DOS salidas, la estandar (\u00f3 salida 1) y la de errores (\u00f3 salida 2), ambas se\u00a0imprimen en pantalla por defecto. Con los s\u00edmbolos &gt; &lt; | pod\u00e9is manejar y redireccionar las entradas/salidas a vuestro antojo, entrada, salida y pipe o\u00a0tuber\u00eda. En este caso, el del comando echo, lo que hacemos es que la salida estandar, que es la pantalla (\u00f3 salida 1, solo que\u00a0el 1 siempre se omite) es redireccionada a algo, en este caso a un fichero, por tanto TODO lo que ese comando echo\u00a0vaya a mostrar la pantalla se va a grabar en ese fichero, salvo lo que vaya dirigido a pantalla y que est\u00e9 por la salida\u00a0de errores. Existe otro formato de redireci\u00f3n, que es &gt;&gt; , con este lo que indicamos es que si el destino de nuestra salida existe\u00a0no lo machaque, sino que a\u00f1ada contenido. \u00bfY la salida de errores?, pues bien, los comandos en Unix/Lnx muestran informaci\u00f3n por las dos salidas, por la\u00a0estandar y por la de errores, ambas por defecto aparecen en pantalla, pero nosotros podemos diferenciarlos y\u00a0reconducir una, otra o ambas a donde queramos. Por ejemplo si un comando lo tratamos para que su salida sea as\u00ed <code>&gt; /var/log/ejecucion.log 2&gt; /var/log/errores.log</code> tendremos que en pantalla no vemos nada (se puede solucionar con tee) pero se generan dos ficheros, uno,\u00a0ejecuci\u00f3n.log tiene la salida estandar, y el otro, errores.log tiene los errores del proceso.</p> <p>De esta manera podemos\u00a0consultar el fichero de errores, que puede tener pocas o ninguna l\u00ednea sin necesidad de validar un \u00fanico archivo de\u00a0miles de l\u00edneas. Tambi\u00e9n podemo decidir unificar ambas salidas, para tener tanto la salida como el error en el mismo fichero, para\u00a0esto, la redirecci\u00f3n ser\u00eda as\u00ed <code>&gt; /var/log/ejecucion.log 2&gt;&amp;1</code>, con ese &amp;1 indicamos que todo lo que vaya a la salida 2\u00a0(errores) sea enviado junto con la salida 1 (estandar), y por tanto al mismo fichero. Y otra cosa, que se suele usar mucho, en muchos casos queremos que se ejecute un proceso/programa, pero que nonos deje rastro del posible error.</p> <p>Imaginad que lanz\u00e1is un borrado de ficheros residuales, si existen el comando de\u00a0borrado los elimina, salida de errores 0, pero si no existe saca error por la salida de errores, aunque a nosotros no\u00a0nos importa, si hay borras, si no hay pues vale. Para eso, enviamos la salida de errores a un dispositivo muy especial y entra\u00f1able /dev/null, siendo el comando algo\u00a0as\u00ed <code>rm *.kk 2 &gt; /dev/null</code>\u00a0. Me borras todo lo que sea .kk y en caso de error (salida 2) me env\u00edas toda esa informaci\u00f3n al dispositivo /dev/null,\u00a0que para que os hag\u00e1is una idea es como la alfombra que se levanta para meter lo que barres del suelo y all\u00ed se\u00a0queda, desaparece s\u00f3lo.</p> <ul> <li>Continuamos con la personalizaci\u00f3n, perd\u00f3n por el tost\u00f3n, a veces me cuesta contenerme. <pre><code>[root@alarmpi ~]# rm /etc/localtime\n[root@alarmpi ~\\# ln -s /usr/share/zoneinfo/Europe/Madrid /etc/localtime\n</code></pre></li> </ul> <p>Borramos el enlace <code>/etc/localime</code> y lo volvemos a crear. \u00bfQue es un enlace?, pues un puntero a otro fichero/directorio en nuestro sistema. Si lo borramos estamos borrando solamente el enlace, no el destino del puntero, y si borramos el destino del puntero nuestro enlace se queda \"colgado\" (seg\u00fan el tipo de terminal y su configuraci\u00f3n de visualizaci\u00f3n, podr\u00e1s llegar a ver los enlaces colgados parpadeando en pantalla). Con el comando ln creamos un link o enlace, con el modificador -s le indicamos que es un enlace de los denominados suaves, damos el destino del enlace y el nombre del mismo.</p> <ul> <li>Ahora modificamos las \u201clocales\u201d</li> </ul> <p>M\u00e1s bien las generamos para poder tener soporte completo a todo nuestros juego de\u00a0caracteres, incluidas las \u00d1s y todas las vocales acentuadas. Para hacer esto, los pasos son tres: </p> <p>1.- Editar el fichero <code>/etc/locale.gen</code> para eliminar el comentario (<code>#</code>) de las l\u00edneas que contienen los juegos de caracteres en espa\u00f1ol (<code>#es_ES@euro ISO-8859-15</code> y <code>#es_ES.UTF-8 UTF-8</code>)</p> <pre><code>[root@alarmpi ~]# vi /etc/locale.gen\n(Pulsar la tecla / shift + 7, y teclear la cadena a buscar, en este caso `es_ES` no lleva a la primera l\u00ednea que lo\ncontiene)\n#es_ES.UTF-8 UTF-8\n#es_ES@euro ISO-8859-15\n(Sobre la # de estas dos l\u00edneas pulsamos la tecla x (x min\u00fascula) para eliminar ese car\u00e1cter)\nESC + :wq!\n</code></pre> <p>2.- Generar las locales, mediante el comando locale-gen <pre><code>[root@alarmpi ~]# locale-gen\nGenerating locales...\nes_ES.UTF-8\nes_ES.ISO-8859-15\nGeneration complete.\n</code></pre></p> <p>3.- Configurar nuestro sistema para usar las locales generadas, editando y/o creando el fichero /etc/locale.conf <pre><code>[root@alarmpi ~]# vi /etc/locale.conf\nLANG=es_ES.UTF-8\nLC_MESSAGES=es_ES.UTF-8\nESC + :wq!\n</code></pre></p> <p>Si queremos estar seguro que tenemos las locales y el juego de caracteres correcto, en el siguiente reinicio de  m\u00e1quina podemos emplear el comando locale para ver una salida del comando similar a esto:</p> <pre><code>[root@ alarmpi ~]# localectl status\nSystem Locale: LANG=es_ES.UTF-8\nVC Keymap: n/a\nX11 Layout: n/a\n</code></pre> <p>4.- Y configuramos la distribuci\u00f3n de las teclas para el posible uso de un teclado USB conectado a la m\u00e1quina. <pre><code>[root@alarmpi ~]# echo \u201cKEYMAP=mac-euro2\u201d &gt; /etc/vconsole.conf [root@alarmpi ~]# localectl set-keymap mac-euro2\n[root@alarmpi ~]# localectl status\nSystem Locale: LANG=es_ES.UTF-8 \n    VC Keymap: mac-euro2\n   X11 Layout: es X11 Model: pc105\n  X11 Options: terminate:ctrl_alt_bksp\n</code></pre></p> <p>... Seguimos en el siguiente mensaje ...</p>"},{"location":"rpi_install_ii/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 3) \u2013 Instalaci\u00f3n b\u00e1sica (II)","text":""},{"location":"rpi_install_ii/#continuamos-con-la-personalizacion","title":"\u2026 Continuamos con la personalizaci\u00f3n","text":"<p>Y ya, para terminar de personalizar nuestra m\u00e1quina vamos a cambiarle el nombre, \u00bfalarmpi? a quien se le ese nombre, con la de cosas bonitas y frikis que hay para usar, toda la saga de ESDLA est\u00e1 llena de nombres m\u00e1quinas, el mundo del comic, de las novelas de Sci-Fi, o puedes usar los socorridos nombres de familiares mascotas... el nombrar o bautizar m\u00e1quinas es un arte ;)</p> <pre><code>[root@alarmpi etc]# vi /etc/hostame\nJarvis\n</code></pre> <p>Con esto editamos el fichero donde est\u00e1 el nombre de nuestra m\u00e1quina. Sobre el editor VI os podr\u00eda contar mucho, pero para este caso os doy un peque\u00f1o gui\u00f3n y si os pica la dud\u00e9is consultar esta p\u00e1gina o esta otra. Despu\u00e9s de pulsar intro al final del comando <code>vi /etc/hostname</code> tendreis el editor abierto con una l\u00ednea que dice <code>_alarmpi_</code>. Borramos esta l\u00ednea, pulsando dos veces la tecla d <code>dd</code>, la l\u00ednea desaparece. Ahora insertamos el nuevo texto, pulsmos la tecla i <code>i</code>, y teclamos el nombre de nuestra m\u00e1quina. Termina la edici\u00f3n volvemos al modo de comando del editor pulsando la tecla ESC. Y ejecutamos el comando del editor que nos salva el fichero y finaliza la edici\u00f3n <code>:wq!</code></p> <p>Como hemos cambiado el nombre de la m\u00e1quina, debemos cambiar tambi\u00e9n la configuraci\u00f3n del fichero de direcciones locales, de manera que cuando hagamos referencia a nuestro nuevo nombre de m\u00e1quina, el sistema sea capaz de encontrarse a si mismo.</p> <pre><code>[root@alarmpi etc]# vi hosts\n#\n# /etc/hosts: static lookup table for host names\n#\n#&lt;ip-address&gt; &lt;hostname.domain.org&gt; &lt;hostname&gt;\n127.0.0.1 localhost.localdomain localhost Jarvis\n::1 localhost.localdomain localhost Jarvis\n# End of file\n</code></pre> <p>Nuevamente recurrimos a VI. Nos desplazamos con los cursores hasta el espacio que hay detr\u00e1s de localhost, vamos a borrar todo lo que existe en esa l\u00ednea desde ese punto hasta el final. Para eso, la combinaci\u00f3n de teclas es <code>SHIFT + d</code>. Y ahora a\u00f1adimos al final de la l\u00ednea, el comando que nos habilita la edici\u00f3n al final de l\u00ednea es <code>SHIFT + a</code>. Estando en modo edicion tecleamos el nombre nuevo de nuestra m\u00e1quina y para volver a modo de comando pulsamos ESC. Nos vamos a la otra l\u00ednea y repetimos la misma operaci\u00f3n. Y para salvar, como os he dicho antes, ESC y luego <code>:wq!</code></p> <p>Un reinicio de la m\u00e1quina para que se refresquen estos cambios y ahora entramos en palabras mayores, que vamos a tocar la tabla de particiones de la tarjeta.</p> <pre><code>[root@alarmpi ~]# sync\n[root@alarmpi ~]# reboot\n</code></pre>"},{"location":"rpi_install_ii/#particionamiento-y-redimensionamiento-de-sd","title":"Particionamiento y redimensionamiento de SD","text":"<p>Por defecto, las im\u00e1genes de las distribuciones (no se si con NOOB es igual) vienen para tarjetas de 4Gb, nosotros es muy posible que tengamos una tarjeta m\u00e1s grande, 8, 16 o 32Gb. Vamos a cambiar la tabla de particiones para que se pueda aprovechar todo es espacio, y de paso vamos a hacer una cosa muy importante que es crear una zona de Swap. Para el particionamiento yo soy muy mani\u00e1tico, me gusta crear cada file system cr\u00edtico en su lugar, para evitar que te crezcan descontroladamente si no los creas as\u00ed, como file system y los dejas como directorios. Por ejemplo, si creas un FS (file system) para el raiz de la m\u00e1quina <code>/</code> y en este existe el directorio <code>/var/log</code> (que es donde suelen ir todos los logs del sistema) no sabr\u00e1s de una manera r\u00e1pida y clara si el contenido de ese directorio crece de manera inusual, tampoco tendr\u00e1s posibilidades de maniobrar ampliando si se da el caso. En cambio, si creas un FS para <code>/</code> y otro FS para <code>/var/log</code> ambos puntos de montaje son independientes y puedes ampliar llegado el caso el de log y controlarlo de un simple vistazo. De todas maneras, todo esto es mucho, pero que mucho m\u00e1s manejable si en vez de hacerlo as\u00ed empleamos LVM (Logical Volumen Manager), el cual nos permite agrupar el almacenamiento y crear vol\u00famenes l\u00f3gicos, si veo que no me sale una gu\u00eda excesivamente grande no descarto contar algo de LVM de cara sobre todo al almacenamiento externo. Para este caso y casi todo lo que voy a contar en la guia, con un particionamiento m\u00e1s o menos rudimenatario puede valer, esto es, dando todo el espacio que nos sea posible a la raiz del sistema (<code>/</code>) y generando una peque\u00f1a \u00e1rea para la zona de swap que ahora despu\u00e9s os comentar\u00e9. La modificaci\u00f3n de la tabla de particiones es una tarea cr\u00edtica, un error y no arranc\u00e1is, as\u00ed que si has pensado en hacer un clonado de tu SD, este es el momento, recordad aquel programa, Pi Copier que os coment\u00e9.</p> <p>Vamos a particionar, para esto, conectados a nuestra Pi por SSH con el usuario root utilizamos el comando <code>fdisk</code>(Fixed Disk Setup), y tenemos que indicarle a este programa cual es el dispositivo que apunta a nuestra tarjeta SD. Con el comando <code>df -kh</code> que os indiqu\u00e9 antes podr\u00e9is ver en que dispositivo est\u00e1n montadas las particiones y sus FileSystem, ya os lo digo yo, es /dev/mmcblk0 Todo lo que os pongo a continuaci\u00f3n es espec\u00edfico de un ARCH Linux, de una imagen reciente (a partir de Septiembre de 2013).</p> <pre><code>fdisk /dev/mmcblk0\nWelcome to fdisk (util-linux 2.23.1).\nChanges will remain in memory only, until you decide to write them.\nBe careful before using the write command.\nCommand (m for help):\n</code></pre> <p>\u00bfQue? \u00bfintuitivo verdad?... En primer lugar, listamos las particiones actuales, para esto, el comando es p (de print).</p> <pre><code>Disk /dev/mmcblk0: 31.7 GB, 31674335232 bytes, 61863936 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: dos\nDisk identifier: 0x00057540\nDevice Boot Start End Blocks Id System\n/dev/mmcblk0p1 2048 186367 92160 c W95 FAT32 (LBA)\n/dev/mmcblk0p2 186368 3667967 1740800 5 Extended\n/dev/mmcblk0p5 188416 3667967 1739776 83 Linux\n</code></pre> <p>Hay que fijarse, importante, el punto de inicio de las particiones (Start). Hay tres particiones, la p1 que es donde est\u00e1 la partici\u00f3n de arranque o boot del sistema. La p2 que es extendida y la p5 que es una partici\u00f3n l\u00f3gica y est\u00e1 contenida dentro de p2. Empezamos por eliminar p2 (y por tanto p5).</p> <pre><code>Command (m for help): d\nPartition number (1,2,5, default 5): 2\nPartition 2 is deleted\n</code></pre> <p>Con el comando d (delete) le decimos que queremos borrar una partici\u00f3n y luego le damos el n\u00famero de partici\u00f3n. Si listamos las particiones que nos quedan ahora, el resultado es este:</p> <pre><code>Command (m for help): p\nDisk /dev/mmcblk0: 31.7 GB, 31674335232 bytes, 61863936 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: dos\nDisk identifier: 0x00057540\nDevice Boot Start End Blocks Id System\n/dev/mmcblk0p1 2048 186367 92160 c W95 FAT32 (LBA)\n</code></pre> <p>Nos hemos quedado con la partici\u00f3n de arranque, pero tranquilos, que no hemos perdido nada de nuestra tarjeta (todav\u00eda!! XD). A\u00f1adimos de nuevo la partici\u00f3n 2, extendida, d\u00e1ndole m\u00e1s espacio en la tarjeta pero con el mismo punto de inicio, no hace falta que nos acordemos de cual, el sistema nos va a decir cual es ese punto, importante, dejad un poco de hueco para un \u00e1rea de Swap que en breve os voy a contar.</p> <pre><code>Command (m for help): n\nPartition type:\np primary (1 primary, 0 extended, 3 free)\ne extended\nSelect (default p): e\nPartition number (2-4, default 2): 2\nFirst sector (186368-61863935, default 186368):\nUsing default value 186368\nLast sector, +sectors or +size{K,M,G} (186368-7698431, default 7698431): +28G\nPartition 2 of type Linux and of size 28 GiB is set\n</code></pre> <p>Pulsamos comando n (new) e indicamos que es una partici\u00f3n de tipo e (extendida), el n\u00famero que vamos a usar es el 2 y el n\u00famero del sector de inicio que nos marca es el 186368, que es el mismo que ten\u00edamos en el primero listado con el comando p (este dato puede variar en tu caso), y ahora le indicamos que a partir de ese sector nos cree una partici\u00f3n de 28Gb con el +28G. Ahora vamos a crear una nueva partici\u00f3n, la 5, de tipo l\u00f3gico, lo hacemos as\u00ed:</p> <pre><code>Command (m for help): n\nPartition type:\np primary (1 primary, 1 extended, 2 free)\nl logical (numbered from 5)\nSelect (default p): l\nAdding logical partition 5\nFirst sector (188416-61863935, default 188416):\nUsing default value 188416\nLast sector, +sectors or +size{K,M,G} (188416-61863935, default 61863935): +28G\nPartition 5 of type Linux and of size 28 GiB is set\n</code></pre> <p>Una vez m\u00e1s, vemos como el sector de inicio coincide con el que ten\u00edamos en el primer listado (esto es realmente lo importante, que eso no cambie). Hemos puesto el comando n para una nueva partici\u00f3n, el tipo indicado es l de logical, y el tama\u00f1o el mismo que hemos dado para la extendida (una partici\u00f3n extendida puede contener varias l\u00f3gicas). Si queremos ver si tenemos todo bien, hasta ahora, volvemos a imprimir la tabla actual de particiones:</p> <pre><code>Command (m for help): p\nDisk /dev/mmcblk0: 31.7 GB, 31674335232 bytes, 61863936 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: dos\nDisk identifier: 0x00057540\nDevice Boot Start End Blocks Id System\n/dev/mmcblk0p1 2048 186367 92160 c W95 FAT32 (LBA)\n/dev/mmcblk0p2 186368 61863935 30838784 5 Extended\n/dev/mmcblk0p5 188416 61863935 30837760 83 Linux\n</code></pre> <p>\u00bfYa hemos terminado?, pues no. Tenemos 29Gb m\u00e1s o menos particionados en nuestra tarjeta, vamos a crear la partici\u00f3n para Swap, que veremos m\u00e1s adelante como manejar, y as\u00ed dejamos esto listo para el reinicio.</p> <pre><code>Command (m for help): n\nPartition type:\np primary (2 primary, 0 extended, 2 free)\ne extended\nSelect (default p): p\nPartition number (1-4, default 3): 3\nFirst sector (6477824-7698431, default 6477824):\nUsing default value 6477824\nLast sector, +sectors or +size{K,M,G} (6477824-7698431, default 7698431):\nUsing default value 7698431\nPartition 3 of type Linux and of size 1.1 GiB is set\nCommand (m for help): t\nPartition number (1-4): 3\nHex code (type L to list codes): 82\nChanged system type of partition 3 to 82 (Linux swap / Solaris)\n</code></pre> <p>Empezamos con el comando n para a\u00f1adir una nueva partici\u00f3n de tipo p (primary), y el n\u00famero de partici\u00f3n a usar es el 3. No tenemos que preocuparnos por sectores de inicio y sectores de fin, el sistema nos ofrece el primer sector libre como sector de inicio, y el \u00faltimo sector disponible como sector de fin, d\u00e1ndonos as\u00ed todo el espacio que queda disponible en la tarjeta. Y luego damos el comando t (type), porque por defecto el tipo es el 83, una partici\u00f3n Linux, pero nosotros queremos que sea del tipo 82 Linux Swap, as\u00ed que despu\u00e9s de indicar el n\u00famero de partici\u00f3n, la 3, ponemos ese c\u00f3digo, el 82 y ya est\u00e1.</p> <p>Bien, tarjeta particionada, solo tenemos que hacer dos cosas, salvar la nueva tabla de particiones y reiniciar (y como tercera cosa, cruzad los dedos).  Para salvar:</p> <pre><code>Command (m for help): w\nThe partition table has been altered!\nCalling ioctl() to re-read partition table.\nWARNING: Re-reading the partition table failed with error 16: Device or resource busy.\nThe kernel still uses the old table. The new table will be used at\nthe next reboot or after you run partprobe(8) or kpartx(8)\nSyncing disks.\n</code></pre> <p>Y ahora reiniciamos (recordad, cruzad los dedos, es fundamental) ....</p> <pre><code>[root@Jarvis ~]# sync\n[root@Jarvis ~]# reboot\n</code></pre> <p>Cuando el sistema vuelva a ofrecernos conexi\u00f3n (y podamos volver a respirar.. XD) tendremos la nueva particiones cargada, pero los File System ocupan lo mismo, as\u00ed que debemos redimensionarlos para que se extiendan hasta ocupar todo el espacio disponible en las particiones, esto es as\u00ed:</p> <pre><code>[root@Jarvis ~]$ sudo resize2fs /dev/mmcblk0p5\nresize2fs 1.42.7 (21-Jan-2013)\nFilesystem at /dev/mmcblk0p5 is mounted on /; on-line resizing required\nold_desc_blocks = 1, new_desc_blocks = 2\nThe filesystem on /dev/mmcblk0p5 is now 7709440 blocks long.\n</code></pre> <p>El comando <code>resize2fs</code>si no le indicamos ning\u00fan par\u00e1metro adicional extiende el File System hasta la capacidad disponible en el dispositivo, en nuestro caso <code>/dev/mmcblk0p5</code>, siendo p5 la partici\u00f3n 5, esto es, nuestra partici\u00f3n l\u00f3gica.</p> <p>Este comando tambi\u00e9n se puede usar para extender parcialmente el FS y dejar as\u00ed algo de espacio no disponible a modo de reserva, y tambi\u00e9n se puede hacer para reducir el espacio disponible de un FS, siempre que no est\u00e9 en uso claro.  Ya est\u00e1, nuestra SD est\u00e1 siendo utilizada al m\u00e1ximo.</p>"},{"location":"rpi_install_ii/#area-de-swap","title":"\u00c1rea de Swap","text":"<p>\u00bfQue es esto el \u00e1rea de Swap? Pues sencillo, as\u00ed, a grosso modo es un \u00e1rea de intercambio. \u00bfComo el archivo de paginaci\u00f3n de Windows (arggg)?, si, como eso, pero BIEN hecho. La gesti\u00f3n de la memoria f\u00edsica (RAM) se hace mediante bloques, llamados p\u00e1ginas. Cuando el sistema necesita liberar p\u00e1ginas de memoria f\u00edsica las vuelca sobre esta memoria virtual. Por l\u00f3gica, el acceso a la memoria f\u00edsica es mucho m\u00e1s r\u00e1pido que a la virtual, estamos hablando de accesos a placas de memoria que se miden en nonasegundos respecto a accesos a discos duros que se miden en milisengundos. Pero tambi\u00e9n es cierto que el almacenamiento en disco es mucho m\u00e1s barato que la ram f\u00edsica, por no hablar de que la mayor\u00eda de las m\u00e1quinas tienen una cantidad de memoria RAM con la que pueden trabajar, si necesitamos m\u00e1s o bien cambiamos de m\u00e1quina o bien usamos Swap. Hay una expresi\u00f3n muy com\u00fan en esto de la inform\u00e1tica que es, la m\u00e1quina est\u00e1 paginando, esto viene a indicar que la m\u00e1quina est\u00e1 casi sin memoria f\u00edsica y empieza a volcar en la swap todo lo que puede para evitar quedarse tiesa, durante ese tiempo sigue dando servicio pero se ve claramente degradado. El encontrar ese equilibro entre la cantidad de RAM f\u00edsica, la cantidad de Swap a usar, y el momento en el que paginares uno de los \"unicornios\" en la optimizaci\u00f3n de servidores...</p> <p>Para nuestro caso, la rPi, modelo B tiene 512 Mb de RAM, yo le voy a dar 1Gb adicional para Swap. Posteriormente veremos como podemos hacer ciertos ajustes en el comportamiento de esta Swap que vamos a crear para precisamente definir eso que comentaba. Hace un momento os he dicho como crear una partici\u00f3n en nuestra SD espec\u00edfica de Swap, vamos a darle uso.</p> <pre><code>[root@Jarvis ~]# mkswap /dev/mmcblk0p3\nSetting up swapspace version 1, size = 610300 KiB\nno label, UUID=97bae743-01b0-4307-baae-fc41b40bc4c6\n</code></pre> <p>Con ese comando <code>mkswap</code>(make swap) creamos un \u00e1rea de swap en el dispositivo que le indiquemos, en este caso la partici\u00f3n p3 de nuestra SD que es la que hemos habilitado para ello. Ahora debemos configurar el sistema para que en cada arranque este \u00e1rea de swap se ponga en uso:</p> <pre><code>[root@Jarvis ~]# vi /etc/fstab\n#\n# /etc/fstab: static file system information\n#\n# &lt;file system&gt; &lt;dir&gt; &lt;type&gt; &lt;options&gt; &lt;dump&gt; &lt;pass&gt;\n/dev/mmcblk0p1 /boot vfat defaults 0 0\n/dev/mmcblk0p3 none swap defaults 0 0\n</code></pre> <p>Editamos con nuestro nuevo amigo, el editor Vi el fichero fstab (file system table), y a\u00f1adimos una l\u00ednea al final (pulsando <code>SHIFT + G</code>para ir al final, y una vez all\u00ed pulsando i de insertar).</p> <p>La l\u00ednea indica el dispositivo, el punto de montaje (que en el caso de swap no aplica), el tipo a usar y luego las opciones por defecto, default y 0 0. Sobre las opciones, usamos defaults. Estas opciones si mir\u00e1is en enlace que os he puesto, ver\u00e9is de todo, incluso una opci\u00f3n discard muy apropiada para los discos SSD tan de moda \u00faltimamente. En el caso de un FS basado en ext4 ser\u00eda similar a poner las opciones rw, suid, dev, exec, auto, nouser y async. Y los 0 0 del final, el primero es para dump, los posibles valores son 0 o 1, en caso de 1 se hace dump de este punto de montaje, si es que dump est\u00e1 instalado, que no es m\u00e1s que una herramienta que nos permite hacer volcados a un fichero de un punto de montaje, luego lo vemos en el apartado de backup.</p> <p>El segundo 0 es para el proceso fsck o File System Check, los posibles valores son 0,1 y 2. El valor 0 es que no se tiene en cuenta esta FS en caso de hacer un chequeo autom\u00e1tico, los valores 1 y 2 si se tiene en cuenta y especificas la prioridad de validaci\u00f3n, siendo siempre 1 para el punto de arranque o boot que debe tener prioridad sobre el resto, que en caso de que queramos chequearlos tendr\u00e1n que llevar un 2. Activamos la swap, con el siguiente comando <code>[root@Jarvis ~]# swapon -a</code></p> <p>Esto le dice al sistema que mire en el fichero <code>/etc/fstab</code> y ponga en marcha todos los dispositivos de tipo swap. Para ver que se est\u00e1 usando, pues utilizamos el mismo comando pero con este otro par\u00e1metro:</p> <pre><code>[root@Jarvis ~]# swapon -s\nFilename Type Size Used Priority\n/dev/mmcblk0p3 partition 610300 0 -1\n</code></pre> <p>Y si queremos asegurarnos que est\u00e1 activa, las primeras l\u00edneas del comando top nos dir\u00e1n la cantidad de swap disponible:</p> <pre><code>KiB Mem: 473124 total, 48240 used, 424884 free, 7280 buffers\nKiB Swap: 610300 total, 0 used, 610300 free, 20072 cached\n</code></pre> <p>M\u00e1s cosas sobre la swap, podemos modificar su comportamiento, en el fichero <code>/etc/sysctl.conf</code>: <pre><code># Swapping too much or not enough? Disks spinning up when you'd\n# rather they didn't? Tweak these.\n#vm.vfs_cache_pressure = 100\n#vm.laptop_mode = 0\n#vm.swappiness = 60\n</code></pre></p> <p>Modificando el par\u00e1metro swappiness le indicamos al sistema su tendencia usar o no la swap, contra m\u00e1s cerca del 99 m\u00e1s paginar\u00e1 en este \u00e1rea.</p>"},{"location":"rpi_install_ii/#y-si-quiero-usar-mi-rpi-por-wifi","title":"\u00bfY si quiero usar mi rPI por Wifi?","text":"<p>Por defecto en ARCH no tenemos soporte para los adaptares WIFI, en otras distribuciones si que bien integrado pero en esta debemos instalarlo y configurarlo, no es muy dif\u00edcil, estos son los pasos. En primer lugar instalamos el paquete necesario:</p> <pre><code>[root@Jarvis ~]# pacman -S wireless_tools\nresolving dependencies...\nlooking for inter-conflicts...\nPackages (1): wireless_tools-29-8\nTotal Download Size: 0.08 MiB\nTotal Installed Size: 0.24 MiB\n:: Proceed with installation? [Y/n] Y\n:: Retrieving packages ...\nwireless_tools-29-8-armv6h 82.4 KiB 231K/s 00:00\n[#############################################] 100%\n(1/1) checking keys in keyring\n[#############################################] 100%\n(1/1) checking package integrity\n[#############################################] 100%\n(1/1) loading package files\n[#############################################] 100%\n(1/1) checking for file conflicts\n[#############################################] 100%\n(1/1) checking available disk space\n[#############################################] 100%\n(1/1) installing wireless_tools\n[#############################################] 100%\n</code></pre> <p>Ahora conectamos nuestro adaptador WIFI al puerto USB libre y reinicarmos el sistema para que se carguen los drivers del mismo <code>[root@Jarvis ~]# sync; reboot</code></p> <p>Una vez que ha arrancado debemos mirar si nuestro adaptador USB aparece listado, para esto:</p> <pre><code>[root@Jarvis ~]# lsusb\nBus 001 Device 004: ID 148f:5370 Ralink Technology, Corp. RT5370 Wireless Adapter\nBus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. SMSC9512/9514 Fast Ethernet Adapter\nBus 001 Device 002: ID 0424:9512 Standard Microsystems Corp. SMC9512/9514 USB Hub\nBus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub\n</code></pre> <p>En el bus 001, el dispositivo 4 se correspondea nuestro adaptador Wifi. Y ahora lo vamos a configurar, para despu\u00e9s activarlo. El comando de configuraci\u00f3n es este, y os aparece un menu realtivamente intuitivo <code>[root@Jarvis ~]# wifi-menu</code></p> <p>En este men\u00fa debemos ver nuestra BSSID listada, esto es, nuestra red Wifi, podremos introducir un nombre que le vamos a dar a la conexi\u00f3n y teclear la clave de la Wifi, ojo, que esta clave se muestra en plano en pantalla, no aparecen los * para taparla. Ahora vamos a comprobar que se ha activado bien el interfaz de red. El comando con el que manejamos los interfaces de red es ifconfig, con el par\u00e1metro -a que nos los lista todos. En la salida de este comando deberemos localizar algo as\u00ed:</p> <pre><code>[root@Jarvis ~]# ifconfig -a\neth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500\ninet 192.168.1.20 netmask 255.255.255.0 broadcast 192.168.1.255\nether b8:27:eb:30:f0:8f txqueuelen 1000 (Ethernet)\nRX packets 440 bytes 37247 (36.3 KiB)\nRX errors 0 dropped 1 overruns 0 frame 0\nTX packets 264 bytes 43962 (42.9 KiB)\nTX errors 0 dropped 0 overruns 0 carrier 0 collisions 0\n...\nwlan0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500\ninet 192.168.1.23 netmask 255.255.255.0 broadcast 192.168.1.255\nether 00:87:32:91:02:39 txqueuelen 1000 (Ethernet)\nRX packets 7 bytes 1346 (1.3 KiB)\nRX errors 0 dropped 0 overruns 0 frame 0\nTX packets 26 bytes 5325 (5.2 KiB)\nTX errors 0 dropped 0 overruns 0 carrier 0 collisions 0\n</code></pre> <p>Ese eth0 se corresponde con nuestra tarjeta de red por Ethernet, y el wlan0 se corresponde con nuestro adaptador Wifi. En ambos casos vemos las Ips asigandas a esas direcciones MAC por nuestro DHCP en el router. Para esta configuraci\u00f3n de wlan0 se ha generado un fichero de perfil en la m\u00e1quina. El fichero de perfil est\u00e1 guardado aqu\u00ed: <code>/etc/netctl/wlan0-JAZZTEL_B1B9</code></p> <p>Tenemos que hacer dos cosas, la primera es activarlo para ver que todo marcha bien:</p> <pre><code>[root@Jarvis netctl]# netctl start wlan0-JAZZTEL_B1B9\n</code></pre> <p>Si ejecutamos un <code>ifconfig -a</code>a continuaci\u00f3n veremos como nuestro interfaz de red wlan0 ya tiene direcci\u00f3n IP asignada:</p> <pre><code>wlan0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500\ninet 192.168.1.23 netmask 255.255.255.0 broadcast 192.168.1.255\n</code></pre> <p>Y ahora lo dejamos habilitado para que se cargue en el arranque de m\u00e1quina.</p> <pre><code>[root@Jarvis netctl]# netctl enable wlan0-JAZZTEL_B1B9\nln -s '/etc/systemd/system/netctl@wlan0\\x2dJAZZTEL_B1B9.service' '/etc/systemd/system/multiuser.\ntarget.wants/netctl@wlan0\\x2dJAZZTEL_B1B9.service'\n</code></pre> <p>Con esto, en los sucesivos arranques se activar\u00e1 el dispositivo Wifi. </p> <p>Y listo, ya tenemos nuestra Pi para poder empezar a darle ca\u00f1a.</p>"},{"location":"rpi_intro/","title":"Instalando una RaspberryPI todo uso... en 2014","text":"<p>Pues s\u00ed, en 2014, en el momento de escribir este mensaje son algo m\u00e1s de 6 a\u00f1os, pero claro, 6 a\u00f1os en tecnolog\u00eda son mucho tiempo.</p> <p>Por aquella \u00e9poca ten\u00eda una RPi modelo B de 512Mb con la que trasteaba bastante, y tambi\u00e9n formaba parte del GUM de la Comunidad de Madrid (Grupo de usuarios MAC), una cosa lleva a la otra y termin\u00e9 ofreciendo un taller donde contar el uso que pod\u00edamos darles a estas placas, haciendo una instalaci\u00f3n y alguno de sus usos orientados al usuario de MAC.</p> <p>Y... se me fue un poco de las manos... all\u00ed me plant\u00e9 con la intenci\u00f3n contar como montar casi de todo, un servidor web, un servidor de archivos, un servidor para copias de seguridad, un servidor de AirPrint/Cups, un media center con XBMC y AirPlay, gesti\u00f3n dom\u00f3tica... todo con lo que hab\u00eda estado trasteando meses atr\u00e1s</p> <p>As\u00ed que cargu\u00e9 con mi Pi, mi viejo MacBook, impresora multifunci\u00f3n, enchufes dom\u00f3ticos Z-Wave, un router, c\u00e1maras IP, etc. y mont\u00e9 el \"tenderete\".</p> <p>A los 5 minutos de empezar la charla ya me di cuenta que aquel foro no se estaba enterando de nada y que en el fondo lo que no fuesen pantallas gr\u00e1ficas no ten\u00edan cabida all\u00ed, por mucho que algunos se pusieran el t\u00edtulo de \"cacharreros\" (geek que queda mejor... fontanero-geek, chapucero-geek, telepizzero-geek...), pocos eran los que cazaba algo, y muchos los que ya estaban sacando sus iPads y empezaban a garabatear dibujos...</p> <p>Est\u00e1 claro que lo hice todo mal desde el principio, y lo \u00fanico con lo que hacerte fu\u00e9 con la publicaci\u00f3n durante la noche anterior en el foro privado de la asociaci\u00f3n una serie de mensajes con todo lo que pretend\u00eda contar.</p> <p>L\u00f3gicamente esto a d\u00eda de hoy no vale para mucho, en 6 a\u00f1os hay nuevas versiones de todo (XBMC ya es Kodi, y de AirPlay te puedes despedir...), pero recordad que el motivo de existir de este blog es que pueda guardar mis cosas.</p> <p>Aqu\u00ed ir\u00e9 actualizando un \u00edndice de las distintas partes de este grupo de mensajes por si quer\u00e9is ir saltando a alguna parte que os interese m\u00e1s.</p> <ul> <li>Introducci\u00f3n</li> <li>Instalaci\u00f3n b\u00e1sica (I)</li> <li>Instalaci\u00f3n b\u00e1sica (II)</li> <li>Securizaci\u00f3n</li> <li>Copias de Seguridad</li> <li>Pr\u00e1ctico 1 - Servidor de WordPress (I)</li> <li>Pr\u00e1ctico 1 - Servidor de WordPress (II)</li> <li>Pr\u00e1ctico 2 - Gestor de Descargas</li> <li>Pr\u00e1ctico 3 - Servidor Impresi\u00f3n/AirPrint</li> <li>Pr\u00e1ctico 4 - Servidor Copias de Seguridad</li> <li>Pr\u00e1ctico 5 - Dom\u00f3tica, C\u00e1maras IP y RaZberry</li> <li>Pr\u00e1ctico 6 - Media Center</li> <li>Pr\u00e1ctico 7 - Emulaci\u00f3n de juegos</li> <li>Alternativas a RPi</li> <li>Ap\u00e9ndices (I) - Reinicio de router</li> <li>Ap\u00e9ndices (II) - XBMC con MariaDB para BBDD distribuida</li> <li>Ap\u00e9ndices (III) - Administraci\u00f3n con Webmin</li> </ul>"},{"location":"rpi_mediacenter/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 12) \u2013 pr\u00e1ctico 6 - Media Center","text":""},{"location":"rpi_mediacenter/#media-center-xbmc","title":"Media Center - XBMC","text":"<p>Este uso sea quiz\u00e1s el m\u00e1s extendido para las Rpi.</p> <p>Es raro el blog/foro en el que no se cuenta como montar un servidor de medios empleando XBMC</p> <p>As\u00ed que, aqu\u00ed no vamos a ser menos y os cuento las cuatro cosas que hay que hacer para tener el media center funcionando.</p> <p>De cara a la infraestructura necesaria para poder hacer funcionar Rpi con XBMC, pues la Pi, la SD y un disco duro conectado por USB es m\u00e1s que suficiente.</p> <p>Yo trabajo con un disco de 1Tb y por ahora no tengo problemas ni de espacio ni de rendimiento, claro que yo borro cosas, no soy ning\u00fan Di\u00f3genes digital.</p> <p>Vamos a instalar entonces..</p>"},{"location":"rpi_mediacenter/#instalacion-paquete-xmbc","title":"Instalaci\u00f3n paquete XMBC","text":"<p>La instalaci\u00f3n es\u2026 seg\u00fan algunos blogs superdif\u00edcil y le tienes que dar opciones y paquetes adicionales y las opciones de la cpu y\u2026 es un comando de una l\u00ednea y tres palabras\u2026</p> <p>[root@Jarvis ~]# pacman -S xbmc :: Existen 2 proveedores disponibles para xbmc: :: Repositorio alarm</p> <p>1) xbmc-rbp 2) xbmc-rbp-git Introduzca un n\u00famero (por defecto=1): 1 resolviendo dependencias... verificando conflictos... Paquetes (49): afpfs-ng-0.8.1-8 alsa-lib-1.0.27.2-1 bluez-libs-5.16-1 compositeproto-0.4.2-2 dmxproto-2.3.1-2 enca-1.15-1 flac-1.3.0-1 fribidi-0.19.6-1 inputproto-2.3-1 libao-1.2.0-1 libass-0.11.1-1 libbluray-0.5.0-1 libcddb-1.3.2-4 libcdio-0.92-1 libcec-2.1.4-1.1 libdmx-1.1.3-1 libmad-0.15.1b-7 libmicrohttpd-0.9.33-1 libmodplug-0.8.8.5-1 libmpeg2-0.5.1-4 libnfs-1.9.3-1 libogg-1.3.1-2 libplist-1.10-1 libsamplerate-0.1.8-3 libshairport-1.2.1.20121215-3 libsndfile-1.0.25-2 libssh-0.5.5-3 libva-1.3.0-1 libvorbis-1.3.4-1 libxcomposite-0.4.4-1 libxi-1.7.2-1 libxinerama-1.1.3-2 libxtst-1.2.2-1 libxxf86dga-1.1.4-1 lockdev-1.0.3_1.5-4 raspberrypi-firmware-20140324-1 raspberrypifirmware-examples-20140324-1 recode-3.6-8 recordproto-1.14.2-1 rtmpdump-20131205-1 sdl-1.2.15-5 sdl_image-1.2.12-3 swig-3.0.0-1 taglib-1.9.1-1 tinyxml-2.6.2-3 xf86dgaproto-2.1-2 xineramaproto-1.2.1-2 xorg-xdpyinfo-1.3.1-1 xbmc-rbp-12.3-1</p> <p>Tama\u00f1o Total de Descarga: 59,24 MiB Tama\u00f1o Total Instalado: 118,71 MiB</p> <p>Y ya\u2026 le decimos a pacman que nos instale el paquete xbmc y ya est\u00e1, no tiene m\u00e1s, el valida las dependencias e instala lo que falte.</p> <p>Como veis, hay dos paquetes xbmc, que son 1) xbmc-rbp y 2) xbmc-rbp-git, el primero es el paquete ESTABLE, el probado y liberado en condiciones para nuestra plataforma, el otro, el GIT es el paquete en desarrollo y como tal podemos dar con BETAS muy avanzadas (como la Beta 3 de Gotham) y con otras que sean un desastre.</p> <p>As\u00ed que, a no ser que sufras de insomnio por las noches pensando en esta o aquella nueva funcionalidad que con la Beta podr\u00edas estar disfrutando\u2026 yo pondr\u00eda la estable\u2026 en tu mano lo dejo.</p> <p>Otra curiosidad, si mir\u00e1is la lista de paquetes de los que depende xbmc, tenemos en primer lugar afpfs-ng, que es un protocolo para poder conectarnos a una unidad Mac OSX exportada por AFP\u00a0 sobre nuestra red TCP.</p> <p>Termina la instalaci\u00f3n y esto es importante, nos aparece este mensaje:</p> <p>If xbmc systemd service does not start, try adding a udev rule: echo 'SUBSYSTEM==\"vchiq\",GROUP=\"video\",MODE=\"0660\"' &gt; /etc/udev/rules.d/10-vchiq-permissions.rules</p> <p>Dependencias opcionales para xbmc-rbp</p> <p>lirc: remote controller support udisks: automount external drives upower: used to trigger power management functionality unrar: access compressed files without unpacking them</p> <p>La primera parte nos dice que si nos encontramos problemas para arrancar con systemd, que ejecutemos ese comando (ese echo...)</p> <p>Pues mira, como que no hay que esperar a tener problemas para arrancar para ejecutar eso, que s\u00f3lo modifica permisos\u2026</p> <p>[root@Jarvis ~]# echo 'SUBSYSTEM==\"vchiq\",GROUP=\"video\",MODE=\"0660\"' &gt; /etc/udev/rules.d/10-vchiq-permissions.rules</p> <p>Las otras dependencias opcionales que nos marca, pues a gusto del consumidor\u2026 yo no he tenido que instalarlas para hacer funcionar mi XBMC.</p>"},{"location":"rpi_mediacenter/#configuracion-de-cpu","title":"Configuraci\u00f3n de CPU","text":"<p>Aunque parezca un poco incre\u00edble a nuestra placa le podemos alterar ligeramente los par\u00e1metros de frecuencia del procesador y alguna que otra cosilla.</p> <p>Con esto \u00bfconseguiremos que vaya todo mejor, m\u00e1s fluido y pueda correr m\u00e1s cosas a la vez?, pues no.</p> <p>Va a ir un poco m\u00e1s ligera, puede que no se enganche tanto, pero de ah\u00ed a que se note\u2026 ya os digo.. no\u2026</p> <p>Estos cambios los podemos hacer editando el fichero <code>config.txt</code>\u00a0que est\u00e1 en el directorio /boot, ojo con tocar ah\u00ed que es el arranque de la m\u00e1quina\u2026</p> <p>[root@Jarvis ~]# vi /boot/config.txt</p> <p>En la parte final del fichero encontr\u00e1is grupos de configuraci\u00f3n seg\u00fan la frecuencia del procesador.</p> <p>Por defecto, este procesador arm v6 funciona a 700Mhz, el l\u00edmite te\u00f3rico estar\u00eda en 1000Mhz (1Ghz), que por lo visto degrada bastante el componente y le acorta bastante su vida \u00fatil.</p> <p>As\u00ed que, nuevamente, a gusto del consumidor, eso s\u00ed, si optas por las frecuencias m\u00e1s altas no estar\u00eda de m\u00e1s que comprases un kit de disipadores pasivos para refrigerar un poco esa placa, por lo que pueda pasar.</p> <p>Si os sirve de gu\u00eda, yo uso la recomendaci\u00f3n Medium, y para esto, tan s\u00f3lo tenemos que eliminar el car\u00e1cter # del principio de la l\u00ednea, movi\u00e9ndonos con los cursores en VI y pulsando la tecla x (x min\u00fascula) cuando estemos sobre ello.</p>"},{"location":"rpi_mediacenter/#medium","title":"Medium","text":""},{"location":"rpi_mediacenter/#arm_freq900","title":"arm_freq=900","text":""},{"location":"rpi_mediacenter/#core_freq333","title":"core_freq=333","text":""},{"location":"rpi_mediacenter/#sdram_freq450","title":"sdram_freq=450","text":""},{"location":"rpi_mediacenter/#over_voltage2","title":"over_voltage=2","text":"<p>Quedar\u00eda as\u00ed</p>"},{"location":"rpi_mediacenter/#medium_1","title":"Medium","text":"<p>arm_freq=900 core_freq=333 sdram_freq=450 over_voltage=2</p> <p>Del resto de par\u00e1metros, he visto ajuste de memoria de la gpu (cuanta ram le damos a la gr\u00e1fica, as\u00ed en palabras m\u00e1s llanas), pero a mi no me han supuesto gran cambio.</p> <p>Reiniciamos la m\u00e1quina despu\u00e9s de estos cambios.</p> <p>[root@Jarvis ~]# sync; reboot</p> <p>Y ahora, cuando haya terminado vamos a arrancar XBMC de manera manual para luego fijarlo y dejarlo en arranque autom\u00e1tico.</p> <p>[root@Jarvis ~]# systemctl start xbmc [root@Jarvis ~]# systemctl enable xbmc</p> <p>Si todo sale bien veremos en nuestra televisi\u00f3n por HDMI el logotipo y posteriormente el men\u00fa de nuestro Media Center.</p> <p>Y una \u00faltima cosa, para la unidad USB a conectar, por ejemplo, en mi caso un pendrive USB, tenemos que saber que dispositivo es, que tipo de partici\u00f3n y debemos montarlo.</p> <p>Para un pendrive con formato Fat32 en el dispositivo<code>/dev/sdb</code> la l\u00ednea a incluir en <code>/etc/fstab</code>\u00a0es la siguiente:</p> <p>/dev/sdb1 /media vfat defaults 0 0</p> <p>Y una vez ejecutado el comando de montaje tendr\u00edamos el contenido del Pendrive:</p> <p>[root@Jarvis /]# mount -a [root@Jarvis /]# cd media [root@Jarvis media]# ls</p> <p>Documentales Peliculas Series</p>"},{"location":"rpi_mediacenter/#multimedia-y-configuracion-scrapers","title":"Multimedia y Configuraci\u00f3n Scrapers","text":"<p>Para manejar el Media Center, se puede usar el mando de la televisi\u00f3n si esta es m\u00e1s o menos moderna y dispone de HDMI CEC, pero lo mejor, con diferencia\u2026 instalar la aplicaci\u00f3n disponible para iOS, la de iPad es una maravilla, se manera todo perfectamente y sincroniza datos con la Rpi en un instante, aport\u00e1ndonos informaci\u00f3n acerca de lo que estamos viendo procedente de los repositorios de pel\u00edculas/series/documentales en la red, en m\u00faltiples idiomas.</p> <p>Antes de poder usar esta aplicaci\u00f3n para manejar nuestro equipo, debemos habilitar el acceso por servicio web que viene desactivado, son 2 minutos.</p> <p>[root@Jarvis ~]# vi /var/lib/xbmc/.xbmc/userdata/guisettings.xml</p> <p>false</p> <p>Por</p> <p>true</p> <p>Salvamos el fichero y reincidamos XBMC</p> <p>[root@Jarvis ~]# systemctl restart xbmc</p> <p>Los ajustes de configuraci\u00f3n de la App para iOS (en este caso para iPhone) son muy sencillos, y una vez que conecte, el icono cambie a verde en vez de rojo, podremos movernos por los men\u00fas libremente usado la opci\u00f3n de control remoto.</p> <p>Ahora vamos a a\u00f1adir una fuente de contenido multimedia de tipo pel\u00edcula, basada en un directorio de nuestra unidad externa.</p> <p>(*Nota en 2020... las capturas de pantalla, se han perdido, obvio, es lo que pasa con los enlaces ef\u00edmeros en los foros.)</p> <p>En el men\u00fa principal nos vamos a Videos, y pulsando flecha abajo entramos a Files.</p> <p>(http://i59.tinypic.com/r8tfdt.jpg)</p> <p>En esta nueva p\u00e1gina bajamos hasta donde dice Add Videos\u2026</p> <p>(http://i59.tinypic.com/2w3z7r9.jpg)</p> <p>En esta pantalla vamos a elegir el directorio a partir del cual se van a buscar los elementos, pulsamos flecha a la derecha hasta que estamos sobre el bot\u00f3n de Browse, pulsamos bot\u00f3n central y se nos abre un navegador de carpetas.</p> <p>Tendremos que ir hasta la carpeta donde est\u00e1n nuestras pel\u00edculas (/media/Peliculas en mi caso), as\u00ed que pulsamos sobre Root Filesystem, luego buscamos media y luego buscamos Peliculas, aqu\u00ed pulsamos bot\u00f3n central y para poder aceptar y que se nos active el bot\u00f3n de OK otra vez tendremos que pulsar la flecha hacia la izquierda.</p> <p>(http://i62.tinypic.com/24qnxg7.jpg)</p> <p>Ahora, bajamos con las flechas hasta que se nos vuelva a activar el bot\u00f3n de OK y pulsamos en el centro.</p> <p>En esta nueva ventana es donde se configura el llamado Scraper, que se escoge en funci\u00f3n del contenido para que se nos complete la informaci\u00f3n del \u201cmedio\u201d con la que existe en los diferentes repositorios.</p> <p>Con las flechitas de la pantalla, pulsando bot\u00f3n central iremos pasando entre los scrapers disponibles hasta que nos aparezca themoviedb.org.</p> <p>Una vez que nos sale, no tenemos que tocar nada m\u00e1s en esta pantalla, tan s\u00f3lo ir con las flechas (las del remote, lo mejor es ponerte sobre The Movie Database y pulsar bot\u00f3n central, y luego flecha abajo) hasta el bot\u00f3n que dice Settings.</p> <p>(http://i57.tinypic.com/28b8nsy.jpg)</p> <p>Y en la pantalla de setting hay que bajar hasta los valores de lenguaje, que fijaremos en ES, as\u00ed como el posible bloqueo por calificaci\u00f3n de edad, que marcaremos tambi\u00e9n como ES.</p> <p>(http://i59.tinypic.com/2ufudfo.jpg)</p> <p>Finalizamos con OK, que nos devuelve a la pantalla anterior, bot\u00f3n a la derecha y de nuevo OK.</p> <p>Nos aparece una pantalla en la que se nos pregunta si queremos actualizar con al informaci\u00f3n del Path, y le decimos que si (yes) y nos aparecer\u00e1n nuestras pel\u00edculas ya en condiciones. Por si acaso, si no os reconoce alguna vez una pel\u00edcula, revisad que el nombre del fichero est\u00e1 bien escrito, siempre es eso\u2026</p> <p>(http://i62.tinypic.com/b9hqp4.jpg)</p> <p>En la app de iOs, si entramos en \u201cMovies\u201d y refrescamos (desplazar hacia abajo) veremos como esta informaci\u00f3n tambi\u00e9n nos aparece.</p> <p>Ahora vamos con el Scraper de Series y tambi\u00e9n para documentales.</p> <p>El alta del scrapper es el mismo, a\u00f1adir v\u00eddeos, elegir ruta, elegir el scrapper, que es lo que cambia, y el resto todo igual, el idioma.. etc.</p> <p>Este es el scrapper para las series y documentales.</p> <p>En mi caso, he a\u00f1adido dos carpetas a este scraper /media/Series y /media/Documentales.</p> <p>Esta es la pantalla de elecci\u00f3n del scrapper para series.</p> <p>(http://i61.tinypic.com/50nlud.jpg)</p> <p>Estos son los settings de ese scrapper</p> <p>(http://i59.tinypic.com/f3dw0i.jpg)</p> <p>Y este es el resultado final</p> <p>(http://i58.tinypic.com/x0obic.jpg)</p>"},{"location":"rpi_mediacenter/#configuracion-airplay","title":"Configuraci\u00f3n AirPlay","text":"<p>La configuraci\u00f3n es la m\u00e1s sencilla de todas.</p> <p>En el men\u00fa principal vamos a sistema SYSTEM.</p> <p>En este men\u00fa vamos a servicios SERVICE.</p> <p>Bajamos hasta AirPlay, pulsamos bot\u00f3n a la derecha y se nos ilumina \u201cAllow XBMC to receive AirPlay content\u201d, pulsamos con el bot\u00f3n central, se ilumina en azul la \u201cbolita\u201d y listo, podemos salir al men\u00fa principal con el bot\u00f3n de salir/volver de nuestro mando remoto.</p> <p>Tan s\u00f3lo tendremos que reiniciar para que se activen los cambios.</p> <p>Para usar Airplay, pues por ejemplo, desde el iPhone / iPad en la App de fotos, pulsamos sobre el bot\u00f3n de compartir (el cuadradito con la flecha hacia arriba) y aqu\u00ed escogemos \u201cAirPlay\u201d, y nos saldr\u00e1 un listado de m\u00e1quinas que hacen de servidores de AirPlay, entre ellas esta nuestra.</p> <p>Y en el caso del v\u00eddeo es igual, compartir por airplay y seleccionar nuestra m\u00e1quina, no deber\u00eda dar ning\u00fan problema, ni con video ni con audio.</p>"},{"location":"rpi_mediacenter/#plug-ins","title":"Plug-INS","text":"<p>Sobre plugins para XBMC se puede hablar mucho, bueno, no tanto, hay cosas que no se pueden decir en p\u00fablico e imagino que todos sab\u00e9is de \u201cque\u201d y el \u201cporqu\u00e9\u201d.</p> <p>Os cuento como instalar un plugin bastante interesante, el de b\u00fasqueda autom\u00e1tica de subt\u00edtulos\u00a0.</p> <p>El fichero a descargar es este , y una vez descargado el zip en nuestro equipo, lo pasamos a la RPI, el m\u00e9todo a utilizar el que queramos, podemos usar Samba que m\u00e1s atr\u00e1s hemos configurado, una conexi\u00f3n Sftp, la cuesti\u00f3n es hacer llegar ese fichero zip.</p> <p>Hal9000:Downloads admin$ sftp operador@192.168.1.20 Connected to 192.168.1.20. sftp&gt; put script.xbmc.subtitles.zip Uploading script.xbmc.subtitles.zip to /home/operador/script.xbmc.subtitles.zip script.xbmc.subtitles.zip 100% 1519KB 1.5MB/s 00:01 sftp&gt; bye</p> <p>Ahora, con nuestra app de gesti\u00f3n de XBMC vamos a \u201cRemote Control\u201d y nos movemos con las flechas por el men\u00fa hasta que aparece SYSTEM, pulsamos el centro y en el nuevo men\u00fa que se nos abre bajamos hasta Add-ons.</p> <p>Pulsamos de nuevo en el centro, y en la nueva pantalla escogemos Install from zip file.</p> <p>Termina sin decirnos gran cosa\u2026 parece que incluso no ha ido bien por que no haya hecho nada pero si, est\u00e1 ah\u00ed.</p> <p>Entramos en la opci\u00f3n (seguimos dentro de System -&gt; Add-ons) Enable Add-ons.</p> <p>Buscamos nuestro \u201cSubtitles\u201d y entramos.</p> <p>Nuevamente pulsamos para entrar a configurar este add-on.</p> <p>(http://i58.tinypic.com/2rrxg28.jpg)</p> <p>Y ahora si, por fin lo vamos a configurar, entramos en \u201cConfigure\u201d y ya podemos escoger los idiomas por orden, salimos como \u201cSpanish\u201d.</p> <p>(http://i57.tinypic.com/2mmxnr4.jpg)</p> <p>Terminado esto, bot\u00f3n a la derecha para marchar los servicios de subt\u00edtulos que emplearemos, yo tengo puestos subtitulos.es, subdivx.es y openSubtitles.</p> <p>Volvemos a pulsar a la derecha para ir a la tercera pesta\u00f1a de opciones, donde podemos da preferencia a un motor de b\u00fasqueda de subt\u00edtulos en concreto para pel\u00edculas y para series.</p> <p>(http://i58.tinypic.com/2h4f728.jpg)</p> <p>Y ya est\u00e1, salimos pulsando OK y a partir de ese momento, cuando estemos reproduciendo contenido, si pulsamos sobre la opci\u00f3n de subt\u00edtulos veremos si est\u00e1n disponibles y el PlugIn directamente lo descarga.</p> <p>(http://i57.tinypic.com/x52sdk.jpg)</p> <p>Y aqu\u00ed podremos escoger entre todos los subt\u00edtulos disponibles cual es que mejor se adapta a nuestras necesidades</p> <p>(http://i61.tinypic.com/30m62kh.jpg)</p> <p>Y por \u00faltimo, as\u00ed se ver\u00e1</p> <p>(http://i61.tinypic.com/3521ana.jpg)</p> <p>Listo, no tiene mucho m\u00e1s.</p> <p>Tampoco os romp\u00e1is mucho la cabeza con este plug-in, por que para la versi\u00f3n 13 de XBMC cambia totalmente la gesti\u00f3n de los subt\u00edtulos y con ello este plug-in.</p>"},{"location":"rpi_securizacion/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 4) \u2013 Securizaci\u00f3n","text":""},{"location":"rpi_securizacion/#es-necesario-securizar-mi-maquina","title":"\u00bfEs necesario securizar mi m\u00e1quina?","text":"<p>Esto lo tienes que decidir tu.</p> <p>Si vas a tener t\u00fa m\u00e1quina en el sal\u00f3n de casa y s\u00f3lo la usas para XBMC o para emular juegos y poco m\u00e1s lo mismo no\u00a0te merece ni molestarte en hacerlo.</p> <p>Ahora bien, si vas a tener tu m\u00e1quina en la wifi de tu piso de estudiantes compartido, si la vas a conectar al exterior y\u00a0vas a querer conectarte desde fuera por conexi\u00f3n SSH, o si vas a poner esta m\u00e1quina en el colegio donde das clases\u00a0lleno de j\u00f3venes hiperhormonados que desean pasar a la historia del centro educativo como el que formate\u00f3 el\u00a0servidor del profesor... pues s\u00ed, debes securizarla.</p> <p>Esto es como dejar una bicicleta en la puerta de una biblioteca, contra m\u00e1s medidas de seguridad m\u00e1s costar\u00e1 que te\u00a0la roben, pero ten por seguro que si quieren ir a por ella y rob\u00e1rtela, les costar\u00e1 m\u00e1s o menos pero te la robar\u00e1n.</p>"},{"location":"rpi_securizacion/#vale-entonces-securizamos-creamos-usuario","title":"Vale, entonces securizamos, creamos usuario","text":"<p>Lo primero que vamos a hacer es dejar de usar nuestro apreciado usuario root o administrador para todas las tareas\u00a0habituales. Con esto consigues dos cosas, por un lado dejas de exponer tu conexi\u00f3n segura con estas credenciales y\u00a0consigues usar otro usuario con muchos menos privilegios que puede que a la hora de que alg\u00fan comando de los\u00a0\"cr\u00edticos\" se te escape de los dedos, la cosa no vaya a mayores.</p> <p>Por tanto, vamos a crear un nuevo usuario.</p> <p>En Linux/Unix los usuarios residen en un fichero de configuraci\u00f3n <code>/etc/passwd</code>, este fichero tiene estructura de\u00a0campos separados por el caracter : y hay datos tales como su UID o identificador de usuario, su GID o identificador\u00a0de grupo PRIMARIO (por que podemos tener varios grupos secundarios), datos como nombre, ruta del directorio\u00a0HOME y el ejecutable de nuestra Shell de usuarios, esto es, nuestro int\u00e9rprete de comandos.</p> <p>En ning\u00fan caso aparecen claves, ni cifradas ni sin cifrar, estas claves est\u00e1n en otro fichero <code>/etc/shadow</code> donde\u00a0aparecen cifradas y este fichero a su vez no es accesible salvo para los administradores del sistema.</p> <p>Como os he dicho los usuarios tienen un grupo primario y pueden tener grupos secundarios, los grupos se guardan en\u00a0el fichero <code>/etc/passwd</code> que tambi\u00e9n tiene esa estructura de campos separados por el car\u00e1cter :, apareciendo en primer\u00a0lugar el nombre del grupo, a continuaci\u00f3n el GID o identificador de grupo y por \u00faltimo, una lista separada por , con\u00a0todos los usuarios que forman parte del grupo a nivel secundario.</p> <p>Creamos el grupo y el usuario con esta secuencia de comandos: <pre><code>[root@Jarvis etc]# groupadd -g 1001 operadores\n[root@Jarvis etc]# useradd -m -g 1001 -u 1001 -s /bin/bash -d /home/operador operador\n[root@Jarvis ~]# passwd operador\n\nEnter new UNIX password: ***\nRetype new UNIX password: ***\n\npasswd: password updated successfully\n</code></pre> El comando <code>groupadd</code> a\u00f1ade un nuevo grupo al fichero <code>/etc/group</code>, con el par\u00e1metro -g indicamos el n\u00famero  identificador de grupo que queremos utilizar, y en \u00faltimo lugar el argumento que se corresponde al nombre del grupo.</p> <p>El comando <code>useradd</code>a\u00f1ade un nuevo usuario al fichero <code>/etc/passwd</code>, con el par\u00e1metro -g indicamos el n\u00famero de\u00a0identificador de su grupo primario, con el par\u00e1metro -u indicamos el n\u00famero de identificador del usuario, con el\u00a0par\u00e1metro -s el ejecutable de nuestro int\u00e9rprete de comando o shell, con el par\u00e1metro -d la ruta del home del usuario\u00a0y por \u00faltimo el argumento que da nombre a nuestro usuario.</p> <p>Con estos dos comandos creamos por tanto grupo y usuario, se rellenan los ficheros passwd y group y se coloca a\u00a0dicho usuario dentro del grupo creado como grupo primario.</p> <p>\u00bfY la clave?, la clave se la damos despu\u00e9s, con el comando <code>passwd</code>, en este caso, el comando recibe un argumento\u00a0que es el nombre del usuario que hemos creado. Por defecto si no indicamos nada el cambio de clave se hace sobre el\u00a0usuario con el que estamos conectado, y por definici\u00f3n un usuario no puede cambiar m\u00e1s que su propia clave, as\u00ed que\u00a0ejecutar el comando <code>passwd &lt;usuario&gt;</code>s\u00f3lo lo podremos hacer con el usuario administrador o root.</p>"},{"location":"rpi_securizacion/#instalamos-sudo","title":"Instalamos sudo","text":"<p>Ahora vamos a instalar <code>sudo</code>, esto os suena de cuando lo hemos usado para instalar la imagen Iso en nuestra tarjeta SD, es ese programa que nos permite ejecutar otros programas como si fu\u00e9semos otro usuario, esto se hace as\u00ed: <pre><code>[root@Jarvis ~]# pacman -S sudo\nresolving dependencies...\nlooking for inter-conflicts...\nPackages (1): sudo-1.8.6.p8-1\nTotal Download Size: 0.55 MiB\nTotal Installed Size: 2.48 MiB\n:: Proceed with installation? [Y/n] Y\n:: Retrieving packages ...\nsudo-1.8.6.p8-1-armv6h 566.1 KiB 717K/s 00:01 [#################################] 100%\n(1/1) checking keys in keyring                [#################################] 100%\n(1/1) checking package integrity              [#################################] 100%\n(1/1) loading package files                   [#################################] 100%\n(1/1) checking for file conflicts             [#################################] 100%\n(1/1) checking available disk space           [#################################] 100%\n(1/1) installing sudo                         [#################################] 100%\n</code></pre> Utilizamos nuestro gestor de paquetes pacman con el par\u00e1metro -S y el argumento sudo, esto es, instalame ese paquete.</p> <p>Y una vez instalado tenemos que configurarlo, la configuraci\u00f3n no es m\u00e1s que la edici\u00f3n de un fichero, <code>/etc/sudoers</code>, y\u00a0para tal fin tenemos un programa espec\u00edfico, visudo, y claro, al llevar VI en el nombre ya os pod\u00e9is imaginar como seusa.</p> <p>Por supuesto que tambi\u00e9n podremos modificar el fichero libremente con VI, pero cualquier error de sint\u00e1xis dejar\u00e1 el sistema hecho unos zorros, visudo, adem\u00e1s de bloquear el fichero (nadie m\u00e1s podr\u00e1 editarlo a la vez) y hacer copia previa, verifica la sintaxis antes de salvarlo, as\u00ed pues, uso m\u00e1s que recomendado. <pre><code>[root@Jarvis etc]# visudo\n\n## Uncomment to allow members of group wheel to execute any command\n\n# %wheel ALL=(ALL) ALL\n\n%operadores ALL=(ALL) ALL\n</code></pre> A\u00f1adimos la l\u00ednea arriba indicada, \u00bfqu\u00e9 significa esa l\u00ednea?</p> <p>El pimero ALL= indica desde donde nos pueden ejecutar, en este caso desde cualquier m\u00e1quina.</p> <p>El segundo (ALL) indica los usuarios que podr\u00e1n hacer sudo, dentro del grupo que vemos ahora.</p> <p>El tercer ALL indica los comandos que ese usuario podr\u00e1 ejecutar, en este caso todos.</p> <p>\u00bfY ese %operadores? pues con eso indicamos que todo esto que hemos explicado arriba de los ALL s\u00f3lo lo van a\u00a0poder hacer los usuarios que por perfilado (passwd y group) tengran el grupo operadores como grupo PRIMARIO, esto\u00a0es, como grupo dentro de passwd, si el usuario tiene el grupo como SECUNDARIO a trav\u00e9s del fichero de grupos no\u00a0cumplir\u00e1 esta configuraci\u00f3n y no podr\u00e1 ejecutar sudo.</p> <p>Cuando ejecutemos por tanto sudo con nuestro usuario operador nos solicitar\u00e1 una clave, que es la nuestra, la del\u00a0usuario operador.</p> <p>Ahora con esto instalado ya no necesitamos el acceso directo a la m\u00e1quina con el usuario root, por tanto, lo mejor es\u00a0cerrarlo, que no se pueda conectar nadie directamente con un usuario privilegiado.</p> <p>Esta operaci\u00f3n es algo m\u00e1s delicada pues hay que tocar algunos ficheros de configuraci\u00f3n que de hacerlo mal nos\u00a0quedamos sin conexi\u00f3n... as\u00ed que cuidado, y ante la duda ESC + :q! para salir de VI sin hacer cambios.</p>"},{"location":"rpi_securizacion/#cortamos-la-conexion-directa-de-root","title":"Cortamos la conexi\u00f3n directa de root","text":"<p>Para esto, en primer lugar editamos el fichero <code>/etc/ssh/sshd_config</code></p> <p><code>[root@Jarvis etc]# vi /etc/ssh/sshd_config</code></p> <p>Debemos buscar la l\u00ednea que tiene:</p> <p><code>#PermitRootLogin yes</code></p> <p>Y cambiarla por esta otra:</p> <p><code>PermitRootLogin no</code></p> <p>Para esto bajamos con los cursores por el fichero y una vez puestos sobre el s\u00edmbolo <code>#</code> de la l\u00ednea pulsamos la tecla\u00a0<code>x</code>, que nos borra ese car\u00e1cter. Ahora nos movemos con las flechas a la derecha hasta ponernos encima de la y de yes\u00a0y pulsamos el comando cw (Change Word), nos aparecer\u00e1 un s\u00edmbolo <code>$</code> sobre la <code>s</code> que nos marca el final de la palabra\u00a0que estamos sustituyendo, y tecleamos no.</p> <p>Salimos salvando el fichero con <code>ESC :wq!</code></p> <p>Tenemos que reiniciar el demonio de ssh, \u00bfdemonio?, si, los procesos residentes en el sistema, que se quedan a la\u00a0espera de hacer su trabajo ante eventos espec\u00edficos se llaman demonios (Daemon), en el caso de los procesos de ssh\u00a0su demonio se llaman sshd.</p> <p><code>[root@Jarvis etc]# systemctl restart sshd</code></p> <p>El comando <code>systemctl</code> es nuestro comando para controlar el sistema de arranque/ejecuci\u00f3n de servicios en la m\u00e1quina\u00a0bajo systemd</p> <p>En este caso le estamos diciendo que reinicie ese servicio/demonio concreto.</p> <p>En cuanto termine el reinicio del demonio podremos probar a abrir una nueva conexi\u00f3n ssh con root y veremos como\u00a0nos da un acceso denegado, as\u00ed pues, a partir de este momento todas las conexiones con el usuario operador y las\u00a0ejecuciones privilegiadas o bien con sudo o bien haciendo <code>su -</code> para cambiar a una shell de usuario root.</p>"},{"location":"rpi_securizacion/#y-podemos-usar-autenticacion-en-dos-pasos-pues-claro","title":"\u00bfY podemos usar autenticaci\u00f3n en dos pasos?, pues claro","text":"<p>Primero tenemos que instalarnos en nuestro tel\u00e9fono el programa de Google que nos genera los \"tokens\" por tiempo,\u00a0para iOs este es el enlace</p> <p>Tenemos que descargarnos los fuentes de este librer\u00eda PAM de la propia Google, y lo tenemos que hacer desde\u00a0nuestra m\u00e1quina, vamos a utilizar el comando <code>wget</code></p> <p>PAM es el acr\u00f3nimo de Linux Pluggable Authentication Modules, esto es, m\u00f3dulo conectables de autenticaci\u00f3n, vamos a darle a nuestro sistema por tanto un m\u00f3dulo de autenticaci\u00f3n en dos pasos de Google en formato librer\u00eda. <pre><code>[operador@Jarvis ~]$ su - \n  Password: &lt;aqu\u00ed la clave de root&gt; \n\n[root@Jarvis ~]# mkdir /Descargas; cd /Descargas \n[root@Jarvis Descargas]# wget https://google-authenticator.googlecode.com/files/libpam-google-authenticator-1.0-source.tar.bz2\n</code></pre> Nos conectamos con operador, hacemos un <code>su -</code> para cambiar al usuario root (la clave que se nos pide es la de ese usuario, root).</p> <p>Creamos un directorio con el comando <code>mkdir</code> (Make Directory), y nos posicionamos en el con <code>cd</code>. Como veis los dos\u00a0comandos est\u00e1n en la misma l\u00ednea separados por un <code>;</code> ,esto es por que la shell ejecuta un comando y\u00a0ejecuta el otro.</p> <p>Si miramos la \"doble extensi\u00f3n\" del fichero que nos descargamos vemos que por un lado se trata de un fichero\u00a0comprimido con Bzip2\u00a0dada la extensi\u00f3n <code>bz2</code> y que adem\u00e1s\u00a0se trata de un conjunto de archivos y directorios empaquetados con tar</p> <p>Para desempaquetar el tar no tenemos problemas pues es algo que siempre vamos a encontrar en la distribuci\u00f3n,\u00a0pr\u00e1cticamente sea la que sea.</p> <p>En cuanto a bzip2 ya es otra cosa y la tendremos que instalar, para esto, ya sab\u00e9is recurrimos a nuestro gestor de\u00a0paquetes (seguimos teniendo nuestra conexi\u00f3n y nuestra sesi\u00f3n de operador con la que hemos cambiado a root):</p> <pre><code>[root@Jarvis Descargas]# pacman -S bzip2\n\nresolving dependencies...\n</code></pre> <p>Tenemos que descomprimir y desempaquetar el fichero de los fuentes de esta librer\u00eda, con algunas versiones\u00a0recientes de tar es posible que este haga las dos operaciones, que primero descomprima y luego desempaquete, pero\u00a0con esta que os pongo yo a continuaci\u00f3n os funcionar\u00e1 siempre, sea cual sea la versi\u00f3n de tar y el formato de\u00a0compresi\u00f3n:</p> <pre><code>[root@Jarvis Descargas]# bzip2 -dc libpam-google-authenticator-1.0-source.tar.bz2 | tar -xv\n</code></pre> <p>\u00bfOs acord\u00e1is que antes os he contado lo de <code>&gt; &lt;</code> y <code>|</code>?, pues aqu\u00ed vemos el uso de | (pipe o tuber\u00eda), esto lo que hace\u00a0es convertir la salida estandar de un comando en la entrada est\u00e1ndar del siguiente, por tanto toma la descompresi\u00f3n\u00a0del fichero y se lo entrega al comando tar para que lo desempaquete.</p> <p>S\u00f3lo nos queda compilar, y para esto necesitamos entorno de desarrollo, lo que implica instalar al menos los\u00a0siguientes paquetes:</p> <pre><code>[root@Jarvis Descargas]# pacman -S make gcc\n\nresolving dependencies...\n</code></pre> <p>Y estas son las \u00f3rdenes para poder compilar:</p> <pre><code>[root@Jarvis Descargas]# cd libpam-google-authenticator-1.0\n[root@Jarvis libpam-google-authenticator-1.0]# make\n\ngcc --std=gnu99 -Wall -O2 -g -fPIC -c -fvisibility=hidden -o google-authenticator.o google-authenticator.c\ngcc --std=gnu99 -Wall -O2 -g -fPIC -c -fvisibility=hidden -o base32.o base32.c\ngcc --std=gnu99 -Wall -O2 -g -fPIC -c -fvisibility=hidden -o hmac.o hmac.c\ngcc --std=gnu99 -Wall -O2 -g -fPIC -c -fvisibility=hidden -o sha1.o sha1.c\ngcc -g -o google-authenticator google-authenticator.o base32.o hmac.o sha1.o -ldl\ngcc --std=gnu99 -Wall -O2 -g -fPIC -c -fvisibility=hidden -o pam_google_authenticator.o pam_google_authenticator.c\ngcc -shared -g -o pam_google_authenticator.so pam_google_authenticator.o base32.o hmac.o sha1.o -lpam\ngcc --std=gnu99 -Wall -O2 -g -fPIC -c -fvisibility=hidden -o demo.o demo.c\ngcc -DDEMO --std=gnu99 -Wall -O2 -g -fPIC -c -fvisibility=hidden -o pam_google_authenticator_demo.o pam_google_authenticator.c\ngcc -g -rdynamic -o demo demo.o pam_google_authenticator_demo.o base32.o hmac.o sha1.o -ldl\ngcc -DTESTING --std=gnu99 -Wall -O2 -g -fPIC -c -fvisibility=hidden -o pam_google_authenticator_testing.o pam_google_authenticator.c\ngcc -shared -g -o pam_google_authenticator_testing.so pam_google_authenticator_testing.o base32.o hmac.o sha1.o -lpam\ngcc --std=gnu99 -Wall -O2 -g -fPIC -c -fvisibility=hidden -o pam_google_authenticator_unittest.o pam_google_authenticator_unittest.c\ngcc -g -rdynamic -o pam_google_authenticator_unittest pam_google_authenticator_unittest.o base32.o hmac.o sha1.o -lc -ldl\n</code></pre> <p>Y si la compilaci\u00f3n no nos da ning\u00fan error, procedemos a instalarlo: <pre><code>[root@Jarvis libpam-google-authenticator-1.0]# make install\n\ncp pam_google_authenticator.so /lib/security\ncp google-authenticator /usr/local/bin\n</code></pre></p> <p>Esto nos deja por un lado instalada la librer\u00eda de seguridad, en <code>/lib/security</code>, y el programa <code>google-authenticator</code> que\u00a0nos va a servir para genera la entrada en el programa de autenticaci\u00f3n de nuestro terminal m\u00f3vil.</p> <p>Antes de activar la librer\u00eda debemos tener generados los c\u00f3digos de acceso con la aplicaci\u00f3n, \u00bfcon que usuario?, puescon el \u00fanico con el que nos podemos conectar a la m\u00e1quina, operador, as\u00ed que necesitamos tener la conexi\u00f3n a\u00a0nuestra m\u00e1quina abierta con dicho usuario o abrir una nueva.</p> <p>Ejectamos el siguiente comando. <pre><code>[operador@Jarvis ~]$ /usr/local/bin/google-authenticator\n\nDo you want authentication tokens to be time-based (y/n) y\n\nhttps://www.google.com/chart?chs=200x200&amp;chld=M|0&amp;cht=qr&amp;chl=otpauth://totp/root@DomePi%3Fsecret%3DYYMTXZ56APYLY6CE\n\nYour new secret key is: DYYMTXZ56APYLY6CE\nYour verification code is 636744\n\nYour emergency scratch codes are:\n\n31868847\n79023148\n93855998\n42788591\n48617175\n\nDo you want me to update your \"~/.google_authenticator\" file (y/n) y\n\nDo you want to disallow multiple uses of the same authentication\ntoken? This restricts you to one login about every 30s, but it increases\nyour chances to notice or even prevent man-in-the-middle attacks (y/n) y\n\nBy default, tokens are good for 30 seconds and in order to compensate for\npossible time-skew between the client and the server, we allow an extra\ntoken before and after the current time. If you experience problems with poor\ntime synchronization, you can increase the window from its default\nsize of 1:30min to about 4min. Do you want to do so (y/n) n\n\nIf the computer that you are logging into isn't hardened against brute-force\nlogin attempts, you can enable rate-limiting for the authentication module.\nBy default, this limits attackers to no more than 3 login attempts every 30s.\nDo you want to enable rate-limiting (y/n) y\n</code></pre></p> <p>Como v\u00e9is, se dice a todo que s\u00ed salvo a la compensaci\u00f3n extra de tiempo.</p> <p>Se nos genera una URL y un conjunto de c\u00f3digos adicionales.</p> <p>Si copi\u00e1is esa URL en un navegador os mostrar\u00e1 un QR que se puede escasear con la aplicaci\u00f3n de Google y que\u00a0directamente os arrancar\u00e1 la aplicaci\u00f3n con la generaci\u00f3n de c\u00f3digos para vuestro dispositivo.</p> <p>As\u00ed de f\u00e1cil, iniciar la app en el m\u00f3vil, pulsar sobre a\u00f1adir y escanear ese c\u00f3digo QR.</p> <p>Los otros c\u00f3digos, pues son c\u00f3digo \"quemables\", esto es, si alguna vez no puedes acceder a la aplicaci\u00f3n y te tienes\u00a0que conectar puedes usar uno de esos c\u00f3digos, una vez que lo has usado ya no es v\u00e1lido y por tanto decimos que se\u00a0ha quemado.</p> <p>Si los usas todos, pues no pasa nada, podr\u00edas volver a usar el ejecutable de <code>google-authenticator</code> y generar un nuevo\u00a0conjunto de c\u00f3digos y una nueva URL de acceso.</p> <p>Ya tenemos nuestro generador de c\u00f3digos en sincron\u00eda con nuestra m\u00e1quina, as\u00ed que vamos a activarlo, para esto en\u00a0primer lugar tenemos que editar el fichero <code>/etc/ssh/sshd_config</code> y modificar lo que se indica a continuaci\u00f3n (con el\u00a0usuario root, si est\u00e1s con operador deber\u00e1s hacer el <code>su -</code>):</p> <pre><code>[root@Jarvis ~]# vi /etc/ssh/sshd_config\n\n# Change to no to disable s/key passwords\n\nChallengeResponseAuthentication no\n</code></pre> <p>Cambiamos esa l\u00ednea, y donde dice no ponemos yes</p> <p>Ahora editamos el fichero <code>/etc/pam.d/sshd</code>, a\u00f1adiendo una l\u00ednea al principio del fichero (pulsando la combinaci\u00f3n de\u00a0teclas SHIFT + o, que nos a\u00f1ade una linea por encima de la actual):</p> <pre><code>[root@Jarvis ~]# vi /etc/pam.d/sshd\n\n#%PAM-1.0\n\n#auth required pam_securetty.so #disable remote root\n\nauth required pam_google_authenticator.so\n\nY ya s\u00f3lo nos queda reiniciar sshd\n\n[root@Jarvis ~]# systemctl restart sshd\n</code></pre> <p>Ahora, si hacemos una conexi\u00f3n veremos que no nos pide usuario/clave, sino que nos pide un c\u00f3digo de verificaci\u00f3n,\u00a0que es el que nos genera nuestra aplicaci\u00f3n m\u00f3vil (\u00f3 alguno de aquellos c\u00f3digos quemables que hab\u00edamos generado)</p> <pre><code>Verification code:\nPassword:\n\nLast login: Mon Apr 15 19:16:10 2013 from 192.168.1.10\n\n[operador@Jarvis ~]$\n</code></pre>"},{"location":"rpi_securizacion/#y-ya-estamos-seguros","title":"\u00bfY ya estamos seguros?","text":"<p>Pues no, con esto s\u00f3lo lo has puesto un poco m\u00e1s dif\u00edcil, pero no es una m\u00e1quina segura 100%, para tener unam\u00e1quina as\u00ed, segura al 100% lo \u00fanico que puedes hacer es apagarla y desconectarla de la red...</p>"},{"location":"rpi_securizacion/#que-mas-se-puede-hacer","title":"\u00bfQue m\u00e1s se puede hacer?","text":"<p>Pues podemos activar el firewall de nuestra m\u00e1quina, para restringir las conexiones, que s\u00f3lo nos lo permita desde las\u00a0direcciones IP de nuestros equipos (p.e. desde nuestro equipo MAC de sobremesa o port\u00e1til), o activar la apertura del\u00a0puerto de conexi\u00f3n s\u00f3lo ante un evento denominado PortKnocking.</p> <p>Pero esto son cuestiones algo extensas que ya tratar\u00e9 m\u00e1s adelante.</p>"},{"location":"rpi_wordpress1/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 6) \u2013 pr\u00e1ctico 1 - Wordpress I","text":""},{"location":"rpi_wordpress1/#nuestro-propio-servidor-de-wordpress","title":"Nuestro propio servidor de WordPress","text":"<p>En este, el primer caso pr\u00e1ctico de uso real de la Rpi vamos a ver como instalar un servidor completo de WordPress, exactamente igual al que tendr\u00edamos si contratamos un hosting en internet.</p> <p>La utilidad de esto\u2026 que cada uno busque su justificaci\u00f3n\u2026 si est\u00e1is intentando montar un blog y no sab\u00e9is muy bien como os va a salir la cosa pues\u2026 es una estupenda plataforma para las diversas pruebas, y sobre todo barata porqu\u00e9 no os costar\u00e1 nada.</p> <p>Tambi\u00e9n lo pod\u00e9is enfocar desde el \u00e1mbito lectivo, un servidor de WordPress en local, que cuesta poco (y hoy en d\u00eda hay que justificar muy mucho los gastos en educaci\u00f3n), que no necesita salida a internet por lo tanto no hay esos posibles \u201cpeligros\u201d de la chiquiller\u00eda en clase\u2026 etc.</p> <p>WordPress no es m\u00e1s que un software escrito en php que necesita para poderse ejecutar de una base de datos, un int\u00e9rprete de php y un servidor web.</p> <p>Para la base de datos, tradicionalmente se ha empleado MySQL, un motor de base de datos bastante ligero a la par que robusto, si bien, este software no es todo lo \u201clibre\u201d que deber\u00eda pues pertenece desde hace un tiempo al todopoderoso Oracle.</p> <p>As\u00ed que en su lugar, en vez de emplear MySQL vamos a utilizar el motor de base de datos MariaDB, este software est\u00e1 desarrollado por la propia gente que en su momento realiz\u00f3 MySQL, as\u00ed que no existen muchas diferencias\u2026</p> <p>En cuanto al servidor web, lo normal es encontrarse con Apache, si bien este servidor web en las Raspberry presenta un comportamiento un tanto \u201cgast\u00f3n\u201d con los recursos, as\u00ed que en su lugar emplearemos NginX el cual se desenvuelve bastante mejor para estos menesteres.</p>"},{"location":"rpi_wordpress1/#necesidades-de-disco-previas","title":"Necesidades de disco previas","text":"<p>Para generar los directorios donde se guardar\u00e1n muchos de los ficheros de esta instalaci\u00f3n necesitamos m\u00e1s disco del que dispone la tarjeta SD de nuestra m\u00e1quina.</p> <p>Puesto que tenemos instalada un pendrive USB vamos a emplearlo para montar sobre el un nuevo FS (FileSystem) que se corresponda con <code>/srv</code>\u00a0.</p> <p>Por defecto en nuestra instalaci\u00f3n ese directorio ya existe y est\u00e1 montado sobre el FS ra\u00edz del sistema:</p> <pre><code>[root@Jarvis srv]# df -kh .\nS.ficheros Tama\u00f1o Usados Disp Uso% Montado en\n/dev/root 3,0G 676M 2,2G 24% /\n\n[root@Jarvis srv]# ls -lR\n.: total 8\ndr-xr-xr-x 2 root ftp 4096 jun 4 2013 ftp\ndrwxr-xr-x 2 root root 4096 jun 4 2013 http\n</code></pre> <p>Vamos a crear un nuevo sistema de ficheros en la partici\u00f3n que tenemos libre en el USB, movemos el actual directorio a otro nombre, montamos la unidad y devolvemos el directorio, f\u00e1cil\u2026</p> <p>Creamos el sistema de ficheros:</p> <pre><code>[root@Jarvis srv]# mkfs -t ext4 /dev/sdb2\n\nmke2fs 1.42.9 (28-Dec-2013)\nEtiqueta del sistema de ficheros=\nOS type: Linux\nTama\u00f1o del bloque=4096 (bit\u00e1cora=2)\nTama\u00f1o del fragmento=4096 (bit\u00e1cora=2)\nStride=0 blocks, Stripe width=0 blocks\n293184 inodes, 1170688 blocks\n58534 blocks (5.00%) reserved for the super user\nPrimer bloque de datos=0\nN\u00famero m\u00e1ximo de bloques del sistema de ficheros=1199570944\n36 bloque de grupos\n32768 bloques por grupo, 32768 fragmentos por grupo\n8144 nodos-i por grupo\nRespaldo del superbloque guardado en los bloques:\n32768, 98304, 163840, 229376, 294912, 819200, 884736\nAllocating group tables: hecho\nEscribiendo las tablas de nodos-i: hecho\nCreating journal (32768 blocks):hecho\nEscribiendo superbloques y la informaci\u00f3n contable del sistema de ficheros: hecho\n</code></pre> <p>Editamos el fichero <code>/etc/fstab</code> para configurar el punto de montaje</p> <pre><code>[root@Jarvis srv]# vi /etc/fstab\n/dev/sdb1 /BCK ext4 defaults 0 0\n/dev/sdb2 /srv ext4 defaults 0 0\n</code></pre> <p>A\u00f1adimos la segunda l\u00ednea que vemos.</p> <p>Salvamos el fichero pero a\u00fan no montamos la unidad pues el directorio existe y tiene contenido.</p> <p>Copiamos el directorio srv con otro nombre y lo volvemos a crear para poder hacer el montaje de la unidad USB</p> <pre><code>[root@Jarvis ]# cd /\n[root@Jarvis ]# mv /srv /srv2\n[root@Jarvis ]# mkdir /srv\n</code></pre> <p>Ahora podemos montar la partici\u00f3n sin problemas y volver a mover el directorio donde estaba</p> <pre><code>[root@GumPI ]# mount -a\n[root@GumPI ]# mv /srv2/* /srv\n[root@GumPI ]# rmdir srv2\n</code></pre> <p>Y para comprobar que lo hemos hecho bien <pre><code>[root@Jarvis ~]# cd /srv\n[root@Jarvis srv]# df -kh .\nS.ficheros Tama\u00f1o Usados Disp Uso% Montado en\n/dev/sdb2 4,3G 9,0M 4,1G 1% /srv\n\n[root@Jarvis srv]# ls -lR\n.:\ntotal 24\ndr-xr-xr-x 2 root ftp 4096 jun 4 2013 ftp\ndrwxr-xr-x 2 root root 4096 jun 4 2013 http\ndrwx------ 2 root root 16384 mar 25 19:03 lost+found\n</code></pre></p>"},{"location":"rpi_wordpress1/#instalamos-el-servidor-web","title":"Instalamos el servidor WEB","text":"<p>Con nuestro gestor de paquetes, <code>pacman</code> vamos a instalar el servidor web</p> <pre><code>[root@Jarvis ~]# pacman -S nginx\nresolviendo dependencias...\nverificando conflictos...\nPaquetes (1): nginx-1.4.7-1\nTama\u00f1o Total de Descarga: 0,25 MiB\nTama\u00f1o Total Instalado: 0,71 MiB\n:: \u00bfContinuar con la instalaci\u00f3n? [S/n] S\n:: Recuperando paquetes ...\nnginx-1.4.7-1-armv6h 251,9 KiB 913K/s 00:00      [##################################################] 100%\n(1/1) verificando llaves en el llavero           [##################################################] 100%\n(1/1) verificando la integridad de los paquetes  [##################################################] 100%\n(1/1) cargando los archivos del paquete...       [##################################################] 100%\n(1/1) verificando conflictos entre archivos      [##################################################] 100%\n(1/1) verificando el espacio disponible en disco [##################################################] 100%\n(1/1) instalando nginx                           [##################################################] 100%\n</code></pre> <p>Lo arrancamos para ver si todo funciona correctamente</p> <p><code>[root@Jarvis ~]# systemctl start nginx</code></p> <p>Y comprobamos que se puede acceder al servidor por el puerto web por defecto que es el 80.</p> <p>Nos conectamos a nuestra Raspberry 192.168.1.20 (por aqu\u00ed tu IP) (http://192.168.1.20) y debemos ver un mensaje tal que as\u00ed:</p> <pre><code>Welcome to nginx!\nIf you see this page, the nginx web server is successfully installed and working. Further configuration is required.\n\nFor online documentation and support please refer to nginx.org.\n\nCommercial support is available at nginx.com.\n\nThank you for using nginx.\n</code></pre> <p>Perfecto, ya tenemos el servidor web instalado, ahora instalamos PHP y PHP-FPM (es el FastCGI para PHP) y terminamos de configurarlo.</p>"},{"location":"rpi_wordpress1/#instalamos-php-y-php-fpm","title":"Instalamos PHP y PHP-FPM","text":"<p>Como siempre, con <code>pacman</code>\u00a0, solicitamos a los repositorios los paquetes oficiales.</p> <pre><code>[root@Jasrvis ~]# pacman -S php php-fpm\nresolviendo dependencias...\nverificando conflictos...\nPaquetes (3): libxml2-2.9.1-5 php-5.5.10-1 php-fpm-5.5.10-1\nTama\u00f1o Total de Descarga: 5,46 MiB\nTama\u00f1o Total Instalado: 29,19 MiB\n:: \u00bfContinuar con la instalaci\u00f3n? [S/n] S\n:: Recuperando paquetes ...\nlibxml2-2.9.1-5-armv6h 1090,4 KiB 2030K/s 00:01      [##################################################] 100%\nphp-5.5.10-1-armv6h 2,8 MiB 3,16M/s 00:01            [##################################################] 100%\nphp-fpm-5.5.10-1-armv6h 1675,1 KiB 4,21M/s 00:00     [##################################################] 100%\n(3/3) verificando llaves en el llavero               [##################################################] 100%\n(3/3) verificando la integridad de los paquetes      [##################################################] 100%\n(3/3) cargando los archivos del paquete...           [##################################################] 100%\n(3/3) verificando conflictos entre archivos          [##################################################] 100%\n(3/3) verificando el espacio disponible en disco     [##################################################] 100%\n(1/3) instalando libxml2                             [##################################################] 100%\n(2/3) instalando php                                 [##################################################] 100%\n(3/3) instalando php-fpm                             [##################################################] 100%\n</code></pre> <p>Arrancamos PHP-FPM (FastGCI Process Manager, donde FastCGI es un Gateway para la conexi\u00f3n de procesos web\u2026) <pre><code>[root@Jarvis ~]# systemctl start php-fpm\n</code></pre></p> <p>Y configuramos el conjunto NginX PHP y PHP-FPM</p> <p>Por defecto NginX busca los ficheros en <code>/usr/share/nginx/html</code> , vamos a modificar su configuraci\u00f3n b\u00e1sica para que los busque en <code>/srv/http</code>, ajustamos tambi\u00e9n algunos par\u00e1metros para la gesti\u00f3n de los lobs de errores, compresi\u00f3n de mensajes\u2026 etc.</p> <p>Editamos <code>/etc/nginx/nginx.conf</code> , borramos todo su contenido y lo reemplazamos con este</p> <pre><code>#user html;\nworker_processes 1;\nerror_log /var/log/error_nginx.log;\nevents {\n        worker_connections 1024;\n       }\nhttp {\n      include mime.types;\n      default_type application/octet-stream;\n      sendfile on;\n      keepalive_timeout 15;\n      gzip on;\n      gzip_comp_level 1;\n      server {\n            listen 80;\n            server_name localhost;\n            location ~ \\.php {\n                              root /srv/http;\n                              fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock;\n                              fastcgi_index index.php;\n                              fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n                              include /etc/nginx/fastcgi_params;\n                              }\n            location / {\n                        root /srv/http;\n                        index index.php;\n                        }\n            error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n                                  root /usr/share/nginx/html;\n                                  }\n      }\n}\n</code></pre> <p>Ahora creamos un fichero de prueban en php para ver si nuestra instalaci\u00f3n y configuraci\u00f3n son correctas, as\u00ed que editamos el fichero <code>/srv/http/index.php</code>\u00a0y usamos este contenido:</p> <pre><code>&lt;?php\necho \"&lt;p&gt;Prueba&lt;/p&gt;\";\n?&gt;\n</code></pre> <p>Reiniciamos tanto NginX como PHP-FPM y probamos a ver si se ve esta prueba</p> <pre><code>[root@Jarvis ~]# systemctl restart nginx php-fpm\n</code></pre> <p>Probamos el acceso nuevamente a nuestro servidor web en la url http://192.168.1.20 (por aqu\u00ed tu IP) (http://192.168.1.20)</p> <p>Y tendremos que ver como el navegador web nos muestra en texto \u201cPrueba\u201d que se genera con ese sencillo <code>.php</code> de \u00edndice que hemos creado.</p> <p>S\u00f3lo nos falta dejar estos dos servicios activos en los futuros inicios de m\u00e1quina mediante los comandos:</p> <pre><code>[root@Jarvis ~]# systemctl enable nginx\n[root@Jarvis ~]# systemctl enable php-fpm\n</code></pre>"},{"location":"rpi_wordpress1/#instalacion-y-configuracion-de-mariadb","title":"Instalaci\u00f3n y configuraci\u00f3n de MariaDB","text":"<p>Vamos con la base de datos.</p> <p>Nuestro amigo pacman, lo volvemos a emplear para la descarga del software, como vemos las posibles dependencias del mismo, librer\u00edas, clientes, etc, se instalan junto con el software.</p> <p>Prestad especial atenci\u00f3n al final de la instalaci\u00f3n por que este paquete ofrece una documentaci\u00f3n \u201cpost-instalaci\u00f3n\u201d muy buena, de los pocos\u2026</p> <pre><code>[root@ Jarvis ~]# pacman -S mariadb\nresolviendo dependencias...\nverificando conflictos...\nPaquetes (4): libaio-0.3.109-7 libmariadbclient-5.5.36-1 mariadb-clients-5.5.36-1 mariadb-5.5.36-1\nTama\u00f1o Total de Descarga: 16,32 MiB\nTama\u00f1o Total Instalado: 141,79 MiB\n:: \u00bfContinuar con la instalaci\u00f3n? [S/n] S\n:: Recuperando paquetes ...\nlibaio-0.3.109-7-armv6h 4,1 KiB 4,03M/s 00:00            [##################################################] 100%\nlibmariadbclient-5.5.36-1-armv6h 6,6 MiB 2,46M/s 00:03   [##################################################] 100%\nmariadb-clients-5.5.36-1-armv6h 799,6 KiB 1221K/s 00:01  [##################################################] 100%\nmariadb-5.5.36-1-armv6h 8,9 MiB 2,04M/s 00:04            [##################################################] 100%\n(4/4) verificando llaves en el llavero                   [##################################################] 100%\n(4/4) verificando la integridad de los paquetes          [##################################################] 100%\n(4/4) cargando los archivos del paquete...               [##################################################] 100%\n(4/4) verificando conflictos entre archivos              [##################################################] 100%\n(4/4) verificando el espacio disponible en disco         [##################################################] 100%\n(1/4) instalando libaio                                  [##################################################] 100%\n(2/4) instalando libmariadbclient                        [##################################################] 100%\n(3/4) instalando mariadb-clients                         [##################################################] 100%\n(4/4) instalando mariadb                                 [##################################################] 100%\nInstalling MariaDB/MySQL system tables in '/var/lib/mysql' ... OK\nFilling help tables... OK\nTo start mysqld at boot time you have to copy support-files/mysql.server to the right place for your system\nPLEASE REMEMBER TO SET A PASSWORD FOR THE MariaDB root USER !\nTo do so, start the server, then issue the following commands:\n'/usr/bin/mysqladmin' -u root password 'new-password'\n'/usr/bin/mysqladmin' -u root -h Jarvis password 'new-password'\nAlternatively you can run:\n'/usr/bin/mysql_secure_installation'\nwhich will also give you the option of removing the test\ndatabases and anonymous user created by default. This is\nstrongly recommended for production servers.\n\nSee the MariaDB Knowledgebase at http://mariadb.com/kb or the\nMySQL manual for more instructions.\nYou can start the MariaDB daemon with:\ncd '/usr' ; /usr/bin/mysqld_safe --datadir='/var/lib/mysql'\nYou can test the MariaDB daemon with mysql-test-run.pl\ncd '/usr/mysql-test' ; perl mysql-test-run.pl\nPlease report any problems at http://mariadb.org/jira\nThe latest information about MariaDB is available at http://mariadb.org/.\nYou can find additional information about the MySQL part at:\nhttp://dev.mysql.com\nSupport MariaDB development by buying support/new features from\nSkySQL Ab. You can contact us about this at sales@skysql.com.\n\nAlternatively consider joining our community based development effort:\nhttp://mariadb.com/kb/en/contributing-to-the-mariadb-project/\n\n&gt;&gt; If you are migrating from MySQL, don't forget to run 'mysql_upgrade'\nafter mysqld.service restart.\n</code></pre> <p>Iniciamos el gestor de base de datos, para poder configurarlo, este inicio tarda un poquito, no asustarse y correr a reiniciar el servidor</p> <p><code>[root@Jarvis ~]# systemctl start mysqld</code></p> <p>Y ahora realizamos la configuraci\u00f3n inicial de MariaDB empleando el script que esta documentaci\u00f3n del paquete nos indica (hay un error en el script pero no afecta a su funcionalidad, lleva ah\u00ed desde hace varios meses\u2026):</p> <pre><code>[root@Jarvis ~]# /usr/bin/mysql_secure_installation\n/usr/bin/mysql_secure_installation: l\u00ednea 379: find_mysql_client: no se encontr\u00f3 la orden\nNOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB\nSERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY!\n\nIn order to log into MariaDB to secure it, we'll need the current\npassword for the root user. If you've just installed MariaDB, and\nyou haven't set the root password yet, the password will be blank,\nso you should just press enter here.\nEnter current password for root (enter for none): &lt;pulsamos intro&gt;\nOK, successfully used password, moving on...\n\nSetting the root password ensures that nobody can log into the MariaDB\nroot user without the proper authorisation.\nSet root password? [Y/n] Y\nNew password: &lt;ponemos clave&gt;\nRe-enter new password: &lt;repetimos clave&gt;\nPassword updated successfully!\nReloading privilege tables..\n... Success!\n\nBy default, a MariaDB installation has an anonymous user, allowing anyone\nto log into MariaDB without having to have a user account created for\nthem. This is intended only for testing, and to make the installation\ngo a bit smoother. You should remove them before moving into a\nproduction environment.\nRemove anonymous users? [Y/n] Y\n... Success!\n\nNormally, root should only be allowed to connect from 'localhost'. This\nensures that someone cannot guess at the root password from the network.\nDisallow root login remotely? [Y/n] Y\n... Success!\n\nBy default, MariaDB comes with a database named 'test' that anyone can\naccess. This is also intended only for testing, and should be removed\nbefore moving into a production environment.\nRemove test database and access to it? [Y/n] Y\n- Dropping test database...\n... Success!\n\n- Removing privileges on test database...\n... Success!\n\nReloading the privilege tables will ensure that all changes made so far\nwill take effect immediately.\nReload privilege tables now? [Y/n] Y\n... Success!\n\nCleaning up...\nAll done! If you've completed all of the above steps, your MariaDB\ninstallation should now be secure.\nThanks for using MariaDB!\n</code></pre> <p>Y una vez configurado todo, reincidamos el gestor de base de datos y lo habilitamos en el arranque de m\u00e1quina</p> <pre><code>[root@Jarvis ~]# systemctl restart mysqld\n[root@Jarvis ~]# systemctl enable mysqld\n</code></pre>"},{"location":"rpi_wordpress1/#administracion-de-mariadb-con-phpmyadmin","title":"Administraci\u00f3n de MariaDB con PHPMyAdmin","text":"<p>Para hacer la vida un poco m\u00e1s f\u00e1cil, y poder administrar la base de datos de una manera algo m\u00e1s gr\u00e1fica, instalamos el paquete de administraci\u00f3n basado en Php.</p> <p>M\u00e1s que nada por que en cualquier Hosting de pago es el paquete que con casi toda seguridad os encontrar\u00e9is, as\u00ed que vamos a tratar de poner aqu\u00ed todo igual.</p> <p>Recurrimos a pacman una vez m\u00e1s:</p> <pre><code>[root@Jarvis ~]# pacman -S phpmyadmin php-mcrypt\nresolviendo dependencias...\nverificando conflictos...\nPaquetes (3): libmcrypt-2.5.8-3 php-mcrypt-5.5.10-1 phpmyadmin-4.1.11-1\nTama\u00f1o Total de Descarga: 4,78 MiB\nTama\u00f1o Total Instalado: 26,21 MiB\n:: \u00bfContinuar con la instalaci\u00f3n? [S/n] S\n:: Recuperando paquetes ...\nlibmcrypt-2.5.8-3-armv6h 64,9 KiB 319K/s 00:00       [##################################################] 100%\nphp-mcrypt-5.5.10-1-armv6h 9,9 KiB 236K/s 00:00      [##################################################] 100%\nphpmyadmin-4.1.11-1-any 4,7 MiB 2,52M/s 00:02        [##################################################] 100%\n(3/3) verificando llaves en el llavero               [##################################################] 100%\n(3/3) verificando la integridad de los paquetes      [##################################################] 100%\n(3/3) cargando los archivos del paquete...           [##################################################] 100%\n(3/3) verificando conflictos entre archivos          [##################################################] 100%\n(3/3) verificando el espacio disponible en disco     [##################################################] 100%\n(1/3) instalando phpmyadmin                          [##################################################] 100%\nCheck http://wiki.archlinux.org/index.php/Phpmyadmin for details.\nDependencias opcionales para phpmyadmin\nphp-mcrypt: to use phpMyAdmin internal authentication [pendiente]\n(2/3) instalando libmcrypt                           [##################################################] 100%\n(3/3) instalando php-mcrypt                          [##################################################] 100%\n</code></pre> <p>Por defecto la instalaci\u00f3n se realiza dentro de la ruta <code>/usr/share/webapps/phpMyAdmin</code>\u00a0y nuestro servidor web no est\u00e1 configurado para arrancar nada all\u00ed.</p> <p>La soluci\u00f3n, pues f\u00e1cil, creamos un enlace de es ruta en nuestra ruta de servidor http y as\u00ed podremos ejecutarlo.</p> <p>Se podr\u00eda mover/copiar el contenido de esa webapps a la carpeta, pero de cara a actualizaciones del paquete es m\u00e1s recomendable hacerlo por enlace.</p> <pre><code>[root@Jarvis ~]# ln -s /usr/share/webapps/phpMyAdmin /srv/http/phpMyAdmin\n</code></pre> <p>Y ahora tenemos que volver a modificar el fichero de configuraci\u00f3n del servidor web <code>/etc/nginx/nginx.conf</code>\u00a0, este ser\u00eda el contenido del fichero que debemos tener:</p> <pre><code>#user html;\nworker_processes 1;\nerror_log /var/log/error_nginx.log;\nevents {\n    worker_connections 1024;\n    }\nhttp {\n    include mime.types;\n    default_type application/octet-stream;\n    sendfile on;\n    keepalive_timeout 15;\n    gzip on;\n    gzip_comp_level 1;\n    server {\n        listen 80;\n    server_name localhost;\n    location ~ \\.php {\n            root /srv/http;\n            fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock;\n            fastcgi_index index.php;\n            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n            include /etc/nginx/fastcgi_params;\n            }\n    location /phpmyadmin {\n            rewrite ^/* /phpMyAdmin last;\n            }\n    location / {\n            root /srv/http;\n            index index.php;\n            }\n    error_page 500 502 503 504 /50x.html;\n    location = /50x.html {\n    root /usr/share/nginx/html;\n            }\n    }\n}\n</code></pre> <p>Tambi\u00e9n debemos modificar el fichero <code>/etc/php/php.ini</code> realizando estos cambios que a continuaci\u00f3n se detallan:</p> <p>Localizamos la l\u00ednea que dice <code>open_basedir=</code>\u00a0y ponemos esto:</p> <p><code>open_basedir= /srv/http/:/home/:/tmp/:/usr/share/pear/:/usr/share/webapps/:/etc/webapps/</code></p> <p>Localizamos estas l\u00edneas, y las descomentamos, esto es, quitamos el ; del principio de la l\u00ednea (pulsando la letra x)</p> <pre><code>extension=mysqli.so\nextension=mysql.so\nextension=mcrypt.so\nmysqli.allow_local_infile = On\n</code></pre> <p>Como hemos realizado modificaciones que afectan a la configuraci\u00f3n del servidor web y del FastCGI de PHP, vamos a reiniciar ambos procesos</p> <pre><code>[root@Jarvis nginx]# systemctl restart nginx php-fpm\n</code></pre> <p>Y probamos para ver si hemos conseguido instalar todo bien.</p> <p>Para esto, entramos a la url http://192.168.1.20/phpmyadmin (por aqu\u00ed tu IP) (http://192.168.1.20/phpmyadmin)</p> <p>... Continuar\u00e1 ...</p>"},{"location":"rpi_wordpress2/","title":"Instalando una RaspberryPI todo uso\u2026 en 2014 (parte 7) \u2013 pr\u00e1ctico 1 \u2013 WordPress II","text":""},{"location":"rpi_wordpress2/#y-ahora-si-por-fin-instalamos-wordpress","title":"Y ahora si, por fin, instalamos WordPress!!","text":"<p>Ha costado un poquito pero ya est\u00e1, ahora lo m\u00e1s r\u00e1pido, montar WordPress, as\u00ed que descargamos el paquete directamente de wordpress.org y los descomprimimos:</p> <pre><code>[root@Jarvis http]# cd /srv\n[root@Jarvis http]# wget http://wordpress.org/latest.tar.gz\n--2014-03-25 22:55:41-- http://wordpress.org/latest.tar.gz\nResolviendo wordpress.org (wordpress.org)... 66.155.40.249, 66.155.40.250\nConectando con wordpress.org (wordpress.org)[66.155.40.249]:80... conectado.\nPetici\u00f3n HTTP enviada, esperando respuesta... 200 OK\nLongitud: 5869727 (5,6M) [application/x-gzip]\nGrabando a: \u201clatest.tar.gz\u201d\n100%[======================================================================================================&gt;] 5.869.727\n1,49MB/s en 4,4s\n2014-03-25 22:55:46 (1,28 MB/s) - \u201clatest.tar.gz\u201d guardado [5869727/5869727]\n[root@Jarvis srv]# tar -xvf latest.tar.gz\n</code></pre> <p>Solo nos resta hacer la configuraci\u00f3n de WordPress, podemos echar mano de esta gu\u00eda relativa a la instalaci\u00f3n de un WP en 5 minutos.</p> <p>Los pasos son estos:</p> <p>1.- Creamos una base de datos para nuestro WordPress, f\u00e1cil, tenemos phpMyAdmin, nos conectamos y creamos.</p> <p>2.- Creamos un usuario para esta base de datos con permisos para crear/modificar objetos (nos aparece como \u201cOtorgar todos los privilegios para la base de datos \"WordPress\u201d)</p> <p>Estos dos primeros pasos se pueden realizar, por supuesto, por l\u00ednea de comando, las sentencias ser\u00edan estas:</p> <pre><code>[root@Jarvis http]# mysql -u root -p\nEnter password:\nWelcome to the MariaDB monitor. Commands end with ; or \\\\g.\nYour MariaDB connection id is 8\nServer version: 5.5.36-MariaDB-log MariaDB Server\nCopyright (c) 2000, 2014, Oracle, Monty Program Ab and others.\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\nMariaDB [(none)]&gt; CREATE DATABASE blog;\nQuery OK, 1 row affected (0.01 sec)\nMariaDB [(none)]&gt; CREATE USER wordpressuser@localhost;\nQuery OK, 0 rows affected (0.00 sec)\nMariaDB [(none)]&gt; SET PASSWORD FOR wordpressuser@localhost=PASSWORD('clave');\nQuery OK, 0 rows affected (0.01 sec)\nMariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON blog.* TO wordpressuser@localhost IDENTIFIED BY 'clave';\nQuery OK, 0 rows affected (0.00 sec)\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\nQuery OK, 0 rows affected (0.01 sec)\nMariaDB [(none)]&gt; exit\nBye\n[root@Jarvis http]#\n</code></pre> <p>3.- Creamos el fichero wp-config.php a partir del fichero de ejemplos <pre><code>[root@Jarvis wordpress]# cp /srv/wordpress/wp-config-sample.php /srv/wordpress/wp-config.php\n</code></pre></p> <p>4.- Editar este fichero <code>/srv/wordpress/wp-config.php</code> para modificar la informaci\u00f3n de la conexi\u00f3n a la base de datos que hemos creado en el punto 1, nombre de la base de datos, usuario y clave. <pre><code>define('DB_NAME', 'blog');\n/** MySQL database username */\ndefine('DB_USER', 'wordpressuser');\n/** MySQL database password */\ndefine('DB_PASSWORD', 'clave');\n</code></pre></p> <p>5.- Copiamos la instalaci\u00f3n/configuraci\u00f3n a su lugar bajo <code>/srv/http</code> <pre><code>[root@Jarvis srv]# cd /srv/wordpress\n[root@Jarvis wordpress]# cp -pr * /srv/http\n````\n\nPor \u00faltimo, la url para arrancar la configuraci\u00f3n final de WordPress es esta: [http://192.168.1.20/wp-admin/install.php](http://192.168.1.20/wp-admin/install.php)\n\nPor si lo quieres tener en castellano, puedes hacerlo de dos maneras, bajando el paquete completo de instalaci\u00f3n en castellano, que siempre va un poco por detr\u00e1s en las nuevas versiones que las americanas, e instalando tal y como hemos hecho pero a partir de ese fichero, y la otra opci\u00f3n es poner tan s\u00f3lo el fichero de lenguaje, que es lo que te cuento a continuaci\u00f3n y que hasta ahora no he conseguido que funcione al 100% y siempre termina apareciendo alg\u00fan que otro literal en otro idioma\u2026\n\nDebes bajar la traducci\u00f3n de WordPress para la versi\u00f3n en concreto que tienes, ahora mismo es la 3.8.1.\n\nLa descarga la hacemos as\u00ed\n</code></pre> [root@Jarvis srv]# cd /srv [root@Jarvis srv]# wget http://es.wordpress.org/wordpress-3.8.1-es_ES.zip ``</p> <p>Debemos extraer de ese zip el fichero wordpress/wp-content/languages/es_ES.mo para copiarlo dentro de nuestra instalaci\u00f3n en la misma ruta.</p> <pre><code>[root@Jarvis srv]# unzip -jqq wordpress-3.8.1-es_ES.zip wordpress/wp-content/languages/es_ES.mo\n[root@Jarvis srv]# mkdir /srv/http/wp-content/languages\n[root@Jarvis srv]# mv /srv/es_ES.mo /srv/http/wp-content/languages\n</code></pre> <p>En \u00faltimo lugar debemos modificar el fichero de configuraci\u00f3n de WordPress para que indicar el lenguaje que vamos a emplear, editando el fichero /srv/http/wp-config.php y modificando esta l\u00ednea para que quede as\u00ed:</p> <p><code>define('WPLANG', 'es_ES');</code></p>"},{"location":"rpi_wordpress2/#acceso-desde-el-exterior-de-nuestra-red","title":"Acceso desde el exterior de nuestra red","text":"<p>Si queremos acceder a nuestro servidor desde fuera de nuestra red debemos habilitar el acceso a el en nuestro router.</p> <p>Pero claro, a no ser que tengas direcci\u00f3n IP fija tendremos problemas cuando el router obtenga una nueva direcci\u00f3n IP.</p> <p>Para solucionar esto podemos emplear un servicio de DDNS , que en algunos router incluso podremos configurar y activar all\u00ed.</p> <p>En cualquier caso, aqu\u00ed os pongo las sencillas l\u00edneas para poder instalar el cliente de DDNS de www.no-ip.com</p> <p>Primero necesitamos tener un registro en ese servicio antes de continuar.</p> <p>Luego tendremos que a\u00f1adir un host (nombre con el que queremos que se conozca nuestro servicio en la red) con un dominio de los gratuitos que nos ofrece.</p> <p>En este caso hemos registrado gumcampi.no-ip.org</p> <p>Ahora tenemos que abrir en nuestro router el acceso a nuestra m\u00e1quina por el puerto que vamos a emplear, en este caso la Ip de la red local 192.168.1.20 que ser\u00e1 accedido por el puerto 80. As\u00ed que sencillo, entramos a Nat-VirtualServers y a\u00f1adimos para esta IP y este puerto la entrada correspondiente.</p> <p>Una nota al margen, los router ya emplean ese puerto, el 80 para la web de administraci\u00f3n, normalmente cuando indicamos que vamos a emplear ese puerto para algo el router suele modificar su propio puerto y se lo lleva al 8080.</p> <p>Y ahora instalamos el cliente de no-ip.</p> <pre><code>[root@Jarvis ~]# pacman -S noip\n\nresolviendo dependencias...\nverificando conflictos...\nPaquetes (1): noip-2.1.9-5\nTama\u00f1o Total de Descarga: 0,02 MiB\nTama\u00f1o Total Instalado: 0,07 MiB\n:: \u00bfContinuar con la instalaci\u00f3n? [S/n] S\n:: Recuperando paquetes ...\nnoip-2.1.9-5-armv6h 15,6 KiB 129K/s 00:00        [################################################] 100%\n(1/1) verificando llaves en el llavero           [################################################] 100%\n(1/1) verificando la integridad de los paquetes  [################################################] 100%\n(1/1) cargando los archivos del paquete...       [################################################] 100%\n(1/1) verificando conflictos entre archivos      [################################################] 100%\n(1/1) verificando el espacio disponible en disco [################################################] 100%\n(1/1) instalando noip                            [################################################] 100%\n\nBefore running noip2 you must configure it.\nTo configure noip2 run the command \"noip2 -C -Y\"\n</code></pre> <p>Como vemos el propio instalador nos indica la forma de realizar la configuraci\u00f3n as\u00ed que le hacemos caso:</p> <pre><code>[root@Jarvis ~]# noip2 -C -Y\nAuto configuration for Linux client of no-ip.com.\nPlease enter the login/email string for no-ip.com antonioXXXX@gmail.com\nPlease enter the password for user 'antonioXXXX@gmail.com' ******\nOnly one host [gumcampi.no-ip.org] is registered to this account.\nIt will be used.\nPlease enter an update interval:[30] 30\nDo you wish to run something at successful update?[N] (y/N) N\nNew configuration file '/etc/no-ip2.conf' created.\n</code></pre> <p>Y estando instalado y configurado tan s\u00f3lo nos falta ejecutarlo y dejarlo activo para posteriores arranques autom\u00e1ticos del sistema</p> <pre><code>[root@Jarvis ~]# systemctl start noip2\n[root@Jarvis ~]# systemctl enable noip2\nln -s '/usr/lib/systemd/system/noip2.service' '/etc/systemd/system/multi-user.target.wants/noip2.service'\n</code></pre> <p>Ahora podr\u00e9is conectar desde el exterior siempre bajo esa direcci\u00f3n.</p> <p>Eso si, os aviso, si prob\u00e1is esto desde vuestra casa es posible que os falle, ya que la mayor\u00eda de los router no os dejar\u00e1n salir al exterior para volver a entrar a la red local, es lo que se denomina NAT Loopback y son pocos los routers que lo soportan.</p> <p>Y una \u00faltima cosa, de cara a la configuraci\u00f3n de WordPress, si acced\u00e9is as\u00ed, recordad que ten\u00e9is que indicar en la p\u00e1gina de configuraci\u00f3n del site (http://192.168.1.20/wp-admin/options-general.php) el nombre del dominio por DDNS en vez de la direcci\u00f3n ip Local.</p>"},{"location":"tec_actionsec2/","title":"Env\u00eda ficheros desde Github a EC2 con actions","text":"<p>En la \u00faltima entrada comentaba lo que Github nos permite hacer con sus actions, pod\u00e9is leerlo aqu\u00ed Github Actions</p> <p>Hoy os traigo un caso de uso pr\u00e1ctico y real para estas actions, que d\u00edas atr\u00e1s nos surgi\u00f3 cuando quer\u00edamos subir a una m\u00e1quia EC2 un fichero que se genera y almacena en nuestro repositorio en Github, de manera que cuando ese proceso/action de publicaci\u00f3n terminase, ante el evento push en el repo se enviase al servidor EC2.</p> <p>El diagrama m\u00e1s o menos ser\u00eda esto:</p> <p></p> <p>Ante el evento push del fichero (a parte de las acciones de SAST, auditor\u00edas, etc) se va a levantar un runner el cual realizar\u00e1 los siguientes pasos:</p> <p>1.- Instala y configura AWS Cli Para esto emplea los secretos que contienen los valores para Access Key y Secret Access Key de una identidad IAM creada con el fin de poder habilitar y revokar \u00fanicamente accesos en el security group de la instancia EC2. En el repositorio github pod\u00e9is ver un ejemplo de la pol\u00edtica necesaria para realizar estas labores.</p> <p>2.- Obtiene la direcci\u00f3n publica del runner Cada vez que se ejecute la action ser\u00e1 en una m\u00e1quina distinta dentro del pool de m\u00e1quinas que pueda tener Github.com, y se presentar\u00e1 a internet con una Ip diferente. Con este sencillo comando sacamos la direcci\u00f3n p\u00fablica de la m\u00e1quina runner con la que llegaremos a nuestra instancia EC2</p> <p><code>wget -qO- https://ipecho.net/plain</code></p> <p>El valor obtenido lo pasamos a una variable de entorno para poder utilizarlo m\u00e1s adelante.</p> <p>3.- Autorizamos el acceso por el puerto ssh tcp/22 en nuestra instancia EC2 Puesto que la copia del fichero desde nuestro repositorio ser\u00e1 por scp debemos poder llegar a la m\u00e1quina desde el runner (que no tiene ip fija pero ya tenemos su ip p\u00faiblica en el paso anterior) y para esto tenemos que permitir el tr\u00e1fico en el security group de esa instancia, que de otra manera est\u00e1 por defecto no permitido. <pre><code>aws ec2 authorize-security-group-ingress --group-id \"${{ secrets.AWS_SGWEB }}\" --protocol tcp --port \"${{ secrets.AWS_VMPORT }}\" --cidr \"${{ env.IP_RUNNER }}/32\"\n</code></pre></p> <p>4.- Preparamos el runner Para poder lanzar la conexi\u00f3n scp hacia nuestra instancia EC2 debemos tener la clave ssh en el runner, y configurarla donde corresponde, y todo de manera que no quede rastro en los logs de actividad de la action, as\u00ed que recurrimos a los secrets de las actions para que aparezca en el log como  \"***\". El c\u00f3digo es este, creamos los directorios necesarios, permisos en directorios y ficheros y volcamos el pem. <pre><code>config_ssh=~/.ssh/config\nkeyfile=~/.ssh/Key.pem\nmkdir ~/.ssh &amp;&amp; echo -e \"ExitOnForwardFailure=yes\\\\nStrictHostKeyChecking=no\" &gt; ${config_ssh} &amp;&amp; chmod 600 ${config_ssh}\necho \"${AWSKEY}\" &gt; ${keyfile} &amp;&amp; chmod 600 ${keyfile}\n</code></pre></p> <p>5.- Descargamos el repositorio sobre el runner Con esta action (estamos usando la action de checkout propia de github) descargamos en el runner el contenido de nuestro repo, de manera que tendremos el fichero/os a copiar sobre nuestra instancia EC2. Es como hacer un git clone reponame de toda la vida <pre><code>uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8\n</code></pre></p> <p>6.- Copiamos los ficheros de local (runner, repo clonado) hacia la instancia EC2 Un simple scp recursivo hacia un directorio de despliegues, con un usuario en el servidor no privilegiado. Todos los datos que no queramos que se pinten en los logs es mejor pasarlos como secretos, ya que as\u00ed s\u00f3lo veremos \"***\" en el log. <pre><code>scp -r -i ${keyfile} $GITHUB_WORKSPACE/data/* ${AWSVMUSERNAME}@${AWSVMFQDN}:/${AWSDESTINATION} 2&gt;/dev/null\n</code></pre> 7.- Y por \u00faltimo, si o si, sea cual sea el resultado, cerramos el security group Y as\u00ed cerramos el acceso del runner evitando dejar accesos permitidos que con el tiempo pueden ser dif\u00edciles de manejar. La clave de este paso es ese <code>if: always()</code>que har\u00e1 que se ejecute siempre sea cual sea el estado de los pasos anteriores de nuestra action. <pre><code>if: always()\nrun: aws ec2 revoke-security-group-ingress --group-id \"${{ secrets.AWS_SGWEB }}\" --protocol tcp --port \"${{ secrets.AWS_VMPORT }}\" --cidr \"${{ env.IP_RUNNER }}/32\"\n</code></pre> Hasta aqu\u00ed ser\u00eda la parte github, pero claro, el fichero/os se quedan en un directorio aislado, con un usuario no privilegiado y hay que moverlo de alguna manera a su ruta definitiva. En mi caso era moverlo al documentroot de un webserver, y emple\u00e9 el siguiente script que se encarga de monitorizar la actividad sobre el directorio de deployments y mover los ficheros, cambios de usuarios/groups y permisos:</p> <pre><code>#!/usr/bin/env bash\n\nuser=www-data\ngroup=www-data\norigin=/Deployments\ntarget=/var/www/&lt;virtualhost_documentroot&gt;/\n\n# Check if another instance of script is running\n[[ $(lsof -t $0| wc -l) &gt; 1 ]] &amp;&amp; echo \"At least one of $0 is running\" &amp;&amp; exit\n\nwhile true\ndo\n  #Inotify Trigger\n  inotifywait -r --exclude \"(swp|swx)\"  -e close_write -t 300 ${origin}\n  cp -pr ${origin}/* ${target}\n  chown -R ${user}:${group} ${target}\n  sleep 30\ndone\n</code></pre> <p>Espero os guste y os sea de utilidad.</p> <p>Todo el c\u00f3digo y documentaci\u00f3n de esta entrada la encontr\u00e1is en: https://github.com/antoniohernan/putfiles2ec2</p>","tags":["aws","command-line","ec2","github"]}]}